System.register(["jimu-core","jimu-arcgis","jimu-for-builder","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/basic/list-tree","jimu-theme","jimu-for-builder/service","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/utility-selector","jimu-ui/advanced/style-setting-components","jimu-ui/basic/color-picker"],(function(e,t){var o={},l={},i={},n={},a={},r={},s={},u={},c={},p={},d={},m={};return{setters:[function(e){o.AllDataSourceTypes=e.AllDataSourceTypes,o.ArcGISDataSourceTypes=e.ArcGISDataSourceTypes,o.DataSourceManager=e.DataSourceManager,o.Immutable=e.Immutable,o.LayoutType=e.LayoutType,o.React=e.React,o.ReactRedux=e.ReactRedux,o.ServiceManager=e.ServiceManager,o.SessionManager=e.SessionManager,o.SupportedUtilityType=e.SupportedUtilityType,o.UtilityManager=e.UtilityManager,o.classNames=e.classNames,o.css=e.css,o.defaultMessages=e.defaultMessages,o.esri=e.esri,o.getAppStore=e.getAppStore,o.hooks=e.hooks,o.jsx=e.jsx,o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,o.moduleLoader=e.moduleLoader,o.polished=e.polished},function(e){l.JimuMapViewComponent=e.JimuMapViewComponent},function(e){i.getAppConfigAction=e.getAppConfigAction},function(e){n.Alert=e.Alert,n.AlertPopup=e.AlertPopup,n.Button=e.Button,n.Checkbox=e.Checkbox,n.CollapsablePanel=e.CollapsablePanel,n.Dropdown=e.Dropdown,n.DropdownButton=e.DropdownButton,n.DropdownItem=e.DropdownItem,n.DropdownMenu=e.DropdownMenu,n.Icon=e.Icon,n.Loading=e.Loading,n.LoadingType=e.LoadingType,n.MultiSelect=e.MultiSelect,n.NumericInput=e.NumericInput,n.Option=e.Option,n.Radio=e.Radio,n.Select=e.Select,n.Switch=e.Switch,n.TextInput=e.TextInput,n.Tooltip=e.Tooltip,n.defaultMessages=e.defaultMessages},function(e){a.MapWidgetSelector=e.MapWidgetSelector,a.SettingRow=e.SettingRow,a.SettingSection=e.SettingSection,a.SidePopper=e.SidePopper},function(e){r.List=e.List,r.TreeItemActionType=e.TreeItemActionType},function(e){s.getTheme2=e.getTheme2,s.registerStyles=e.registerStyles,s.styled=e.styled,s.withStyles=e.withStyles},function(e){u.appServices=e.appServices},function(e){c.DataSourceSelector=e.DataSourceSelector},function(e){p.UtilitySelector=e.UtilitySelector},function(e){d.SizeColorSetting=e.SizeColorSetting},function(e){m.ThemeColorPicker=e.ThemeColorPicker}],execute:function(){e((()=>{var e={748:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.501 3.501 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},95369:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 7a1 1 0 1 0 0 2 1 1 0 0 0 0-2m5 1a1 1 0 1 1 2 0 1 1 0 0 1-2 0m6 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0" clip-rule="evenodd"></path></svg>'},59216:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.227 1.312c-.404-.404-1.045-.417-1.432-.03L2.49 8.587l-.48 2.674a.637.637 0 0 0 .73.73l2.673-.48 7.305-7.306c.387-.387.374-1.028-.03-1.431zm-8.114 9.575.32-1.781 4.991-4.992 1.462 1.462-4.992 4.991zm7.473-6.012 1.402-1.4-1.462-1.463-1.401 1.402z" clip-rule="evenodd"></path><path fill="#000" d="M1.5 14a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1z"></path></svg>'},34750:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},27218:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M14.938 8A7 7 0 0 1 1.01 9H0a8.001 8.001 0 0 0 15.938-1A8 8 0 0 0 1.02 3.98L1 .702a.5.5 0 1 0-1 .006L.031 5.9l5.128-.826a.5.5 0 0 0-.16-.987L1.819 4.6A7 7 0 0 1 14.938 8"></path></svg>'},30224:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},88866:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},79964:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},69797:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODciIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA4NyA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxyZWN0IHdpZHRoPSI4NyIgaGVpZ2h0PSI2NCIgZmlsbD0iIzI4MjgyOCIvPg0KPHJlY3QgeD0iMyIgeT0iNTIiIHdpZHRoPSI4MSIgaGVpZ2h0PSI4IiByeD0iMSIgZmlsbD0iIzZBNkE2QSIvPg0KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik04NCAyNUgzVjI5SDg0VjI1Wk00MyAzN0gzVjQxSDQzVjM3WiIgZmlsbD0iIzQ0NDQ0NCIvPg0KPHJlY3QgeD0iMTQiIHk9IjUiIHdpZHRoPSIyMCIgaGVpZ2h0PSI2IiBmaWxsPSIjNkE2QTZBIi8+DQo8cmVjdCB4PSI1MyIgeT0iNSIgd2lkdGg9IjIwIiBoZWlnaHQ9IjYiIGZpbGw9IiMzNjM2MzYiLz4NCjxyZWN0IHg9IjMiIHk9IjE2IiB3aWR0aD0iODEiIGhlaWdodD0iMSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMyIgeT0iMTYiIHdpZHRoPSI0MCIgaGVpZ2h0PSIxIiBmaWxsPSIjNkE2QTZBIi8+DQo8L3N2Zz4NCg=="},80941:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODciIGhlaWdodD0iNDYiIHZpZXdCb3g9IjAgMCA4NyA0NiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxyZWN0IHk9IjE2IiB3aWR0aD0iODciIGhlaWdodD0iMzAiIGZpbGw9IiMyODI4MjgiLz4NCjxyZWN0IHg9IjQiIHk9IjIzIiB3aWR0aD0iNzkiIGhlaWdodD0iNiIgZmlsbD0iIzQ0NDQ0NCIvPg0KPHJlY3QgeD0iNCIgeT0iMzgiIHdpZHRoPSI0MCIgaGVpZ2h0PSIzIiBmaWxsPSIjNDQ0NDQ0Ii8+DQo8cmVjdCB4PSI2MyIgeT0iMzYiIHdpZHRoPSIyMCIgaGVpZ2h0PSI3IiByeD0iMSIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3Qgd2lkdGg9IjEyIiBoZWlnaHQ9IjEyIiByeD0iMiIgZmlsbD0iIzUyNTI1MiIvPg0KPC9zdmc+DQo="},26826:e=>{"use strict";e.exports=l},48891:e=>{"use strict";e.exports=o},23137:e=>{"use strict";e.exports=i},66325:e=>{"use strict";e.exports=u},34796:e=>{"use strict";e.exports=s},30726:e=>{"use strict";e.exports=n},338:e=>{"use strict";e.exports=c},77756:e=>{"use strict";e.exports=a},55505:e=>{"use strict";e.exports=d},52785:e=>{"use strict";e.exports=p},41362:e=>{"use strict";e.exports=m},59587:e=>{"use strict";e.exports=r}},t={};function v(o){var l=t[o];if(void 0!==l)return l.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,v),i.exports}v.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return v.d(t,{a:t}),t},v.d=(e,t)=>{for(var o in t)v.o(t,o)&&!v.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},v.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),v.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},v.p="";var g={};return v.p=window.jimuConfig.baseUrl,(()=>{"use strict";v.r(g),v.d(g,{__set_webpack_public_path__:()=>Lt,default:()=>Pt});var e={};v.r(e),v.d(e,{AppItemSelector:()=>Ne});var t=v(48891),o=v(26826),l=v(23137),i=v(30726),n=v(77756);const a="CIMMarkerNorthArrow",r="Untitled template",s={color:"#000",size:"4px"};var u,c;!function(e){e.CurrentMapExtent="CURRENT MAP EXTENT",e.CurrentMapScale="CURRENT MAP SCALE",e.SetMapScale="SET MAP SCALE"}(u||(u={})),function(e){e.Point="POINT",e.Inch="INCH",e.Centimeter="CENTIMETER",e.Millimeter="MILLIMETER"}(c||(c={}));const p={layoutOptions:{customTextElements:[],hasAuthorText:!0,hasCopyrightText:!0,hasLegend:!0,hasTitleText:!0},mapSurroundInfos:[],pageSize:null,pageUnits:null,webMapFrameSize:null},d={scalePreserved:!1,outScale:36978595.474472,layoutOptions:{titleText:"ArcGIS Web Map"},exportOptions:{dpi:96},printExtentType:u.CurrentMapExtent,attributionVisible:!1,forceFeatureAttributes:!0,wkid:102100,wkidLabel:"WGS_1984_Web_Mercator_Auxiliary_Sphere",enableTitle:!0,legendEnabled:!0,enableMapPrintExtents:!0,enableOutputSpatialReference:!0,enableQuality:!0,enableFeatureAttribution:!0,enableMapSize:!0,overrideCommonSetting:!1,enableAuthor:!0,enableCopyright:!0,enableLegend:!0,enableScalebarUnit:!0,enableCustomTextElements:!0};var m,h,y,f,b,x,T,S,w;!function(e){e.LayoutTemplate="Layout Template",e.ReportTemplate="Report Template"}(m||(m={})),function(e){e.Classic="CLASSIC",e.Compact="COMPACT"}(h||(h={})),function(e){e.OrganizationService="ORGANIZATION SERVICE",e.Customize="CUSTOMIZE"}(y||(y={})),function(e){e.OrganizationTemplate="ORGANIZATION TEMPLATE",e.Customize="CUSTOMIZE"}(f||(f={})),function(e){e.Loading="LOADING",e.Success="SUCCESS",e.Error="ERROR"}(b||(b={})),function(e){e.PrintTemplate="PRINT TEMPLATE",e.PrintResult="PRINT RESULT"}(x||(x={})),function(e){e.ServiceLayout="Service Layout",e.CustomLayout="Custom Layout"}(T||(T={})),function(e){e.RPTT="RPTT",e.RPTX="RPTX"}(S||(S={})),function(e){e.ServiceReport="Service Report",e.CustomReport="Custom Report"}(w||(w={}));const I={printSource:"Source",selectMap:"Select a map widget with 2D data",printMode:"Mode",printClassic:"Classic",printCompact:"Compact",configurePrintTemplate:"Print template",printService:"Print service",useOrganizationDervice:"Use organization service",printCustomize:"Customize",printTemplate:"Print template",useOrganizationTemplate:"Use organization template",newPrintTemplate:"New print template",newTemplate:"New template",templateCommonSettings:"Template common settings",setDefaults:"Set defaults",printTitle:"Title",mapPrintingExtents:"Map printing extents",outputSpatialReference:"Output spatial reference",printQuality:"Print quality",featureAttribution:"Feature attribution",selectEditableSettings:"Select editable settings",currentMapExtent:"Current map extent",currentMapScale:"Current map scale",setMapScale:"Set map scale",useCurrentScale:"Use current scale",allowEditing:"Select settings that allow editing at runtime",wellKnownId:"Enter a well-known ID ({wkid})",includeAttribution:"Include attribution",includeLegend:"Include legend",templateConfiguration:"Template configuration",templateName:"Template name",fileFormat:"File format",printLayout:"Layout",MapOnlyOptions:"Map-only options",LayoutOptions:"Layout options",mapSize:"Map size",overrideCommonSettings:"Override common settings",overrideSettingsTitle:"Are you sure you want to disable override settings?",overrideSettingsRemind:"You will lose the settings configured.",printTemplateAuthor:"Author",copyright:"Copyright",legend:"Legend",scaleBarUnit:"Scalebar unit",miles:"Miles",kilometers:"Kilometers",meters:"Meters",feet:"Feet",mapAttribution:"Map attribution",utilityPlaceholder:"Click the “Select utility” button to add utilities for further configurations.",featureAttributes:"Feature attributes",includeAttributes:"Include attributes",northArrow:"North arrow",includeNorthArrow:"Include north arrow",serviceIsNotAvailable:"Service is not available.",printPreviewStyle:"Print preview style",enablePrintPreview:"Enable print preview",useServiceLayout:"Use service layout",useCustomLayout:"Use layout from layout item",useServiceReport:"Use service report",useCustomReport:"Use report from report item",report:"Report",reportRemind:"The report can only be generated in PDF format. If you want to print the report only, please choose the MAP_ONLY layout option.",reportNotConfigured:"The report is not configured with any data.",selectLayoutItemPlaceholder:"Select an layout item",selectReportItemPlaceholder:"Select a report item",checkingReport:"Checking report",notSupportReport:"Report template is not supported."};var C=function(e,t,o,l){return new(o||(o=Promise))((function(i,n){function a(e){try{s(l.next(e))}catch(e){n(e)}}function r(e){try{s(l.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,r)}s((l=l.apply(e,t||[])).next())}))};const j=e=>C(void 0,void 0,void 0,(function*(){return Z(e).then((e=>t.ServiceManager.getInstance().fetchArcGISServerInfo(e).then((e=>Promise.resolve(null==e?void 0:e.owningSystemUrl)),(e=>Promise.reject(e)))))})),R=(e,t,o)=>C(void 0,void 0,void 0,(function*(){return Z(t).then((t=>H(t,o,e)))}));const O=(e,o,l)=>C(void 0,void 0,void 0,(function*(){const i=z(null==o?void 0:o.utilityId);return function(e){const o={query:{f:"json"},responseType:"json"};return(0,t.loadArcGISJSAPIModules)(["esri/request"]).then((t=>{const[l]=t;return l(e,o).then((e=>function(e){return U(this,void 0,void 0,(function*(){let t=!1,o=!1;const l=(null==e?void 0:e.parameters)||[];let i=[],n=[],a="pdf",r=!1,s=!1,u=!1,c="",p="",d="",m="";return null==l||l.forEach((e=>{var t,o;if("Format"===e.name){const l=(null===(t=null==e?void 0:e.choiceList)||void 0===t?void 0:t.map((e=>null==e?void 0:e.toLowerCase())))||[];if(e.defaultValue)a=null===(o=e.defaultValue)||void 0===o?void 0:o.toLowerCase();else if((null==l?void 0:l.length)>0){const e=[];null==l||l.forEach((t=>{(t.include("pdf")||t.include("png"))&&e.push(t)})),a=(null==e?void 0:e[0])||l[0]}n=l}})),null==l||l.forEach((e=>{if("Layout_Template"===e.name){const t=e.choiceList,o=e.defaultValue;t?i=null==t?void 0:t.map((e=>le(e,n,a))):i.push(le(o,n,a))}"layout_template"===e.name.toLowerCase()&&(c=(null==e?void 0:e.defaultValue)||""),"layout_item_id"===e.name.toLowerCase()&&(r=!0,p=null==e?void 0:e.defaultValue),"report_template"===e.name.toLowerCase()&&(u=!0,d=(null==e?void 0:e.defaultValue)||""),"report_item_id"===e.name.toLowerCase()&&(s=!0,m=null==e?void 0:e.defaultValue),"string"==typeof e.name&&"web_map_as_json"===e.name.toLowerCase()&&(t=!0),"string"==typeof e.name&&"output_file"===e.name.toLowerCase()&&(o=!0)})),Promise.resolve({templates:i,formatList:n,defaultFormat:a,defaultReportTemplate:d,defaultCustomReportItem:m,hasWebmapParam:t,hasOutputParam:o,supportCustomLayout:r,supportReport:u,supportCustomReport:s,defaultLayout:c,defaultCustomLayoutItem:p})}))}(null==e?void 0:e.data)))}))}(e).then((t=>{let n=l;return H(e,m.LayoutTemplate).then((a=>C(void 0,void 0,void 0,(function*(){let r;if(t.supportCustomReport||t.supportReport){const l=(yield H(e,m.ReportTemplate))||[],i=M(l);n=n.set("reportTemplateChoiceList",i).set("defaultReportTemplate",null==t?void 0:t.defaultReportTemplate).set("defaultCustomReportItem",null==t?void 0:t.defaultCustomReportItem),r=yield k(l,t,o)}const s=yield N(t,o),u={templateTaskInfo:a,templatesInTask:null==t?void 0:t.templates,reportOption:r,defaultLayoutOptionInfo:s,printTemplateType:null==l?void 0:l.printTemplateType,printServiceType:i},c=L(u),p=E(null==t?void 0:t.templates,c);return n=n.set("printCustomTemplate",c).set("useUtility",o).set("formatList",null==t?void 0:t.formatList).set("defaultFormat",null==t?void 0:t.defaultFormat).set("layoutChoiceList",p).set("supportCustomLayout",t.supportCustomLayout||!1).set("supportReport",t.supportReport||!1).set("supportCustomReport",t.supportCustomReport||!1).setIn(["commonSetting","forceFeatureAttributes"],t.supportReport||t.supportCustomReport||!1),Promise.resolve(n)}))))}))})),N=(e,t)=>C(void 0,void 0,void 0,(function*(){var o;const l={layoutTypes:T.ServiceLayout};if((null==e?void 0:e.supportCustomLayout)&&(null==e?void 0:e.defaultCustomLayoutItem)){const i=yield R(null===(o=null==e?void 0:e.defaultCustomLayoutItem)||void 0===o?void 0:o.id,t,m.ReportTemplate),n=null==i?void 0:i[0];l.customLayoutItem=null==e?void 0:e.defaultCustomLayoutItem,l.templateInfo=n}return Promise.resolve(l)})),k=(e,t,o)=>C(void 0,void 0,void 0,(function*(){var l,i,n,a,r;if(!(null==t?void 0:t.supportCustomReport)||!(null==t?void 0:t.supportReport))return null;const s={reportTypes:w.ServiceReport};if((null==t?void 0:t.supportReport)&&(null==t?void 0:t.defaultReportTemplate)){let o;null==e||e.forEach((e=>{(null==e?void 0:e.reportTemplate)===(null==t?void 0:t.defaultReportTemplate)&&(o=null==e?void 0:e.reportOptions)})),s.report=null==t?void 0:t.defaultReportTemplate,s.reportOptions=o}if((null==t?void 0:t.supportCustomReport)&&(null==t?void 0:t.defaultCustomReportItem)){const e=yield R(null===(l=null==t?void 0:t.defaultCustomReportItem)||void 0===l?void 0:l.id,o,m.ReportTemplate),u=null===(i=null==e?void 0:e[0])||void 0===i?void 0:i.reportOptions;s.customReportItem={id:null===(n=null==t?void 0:t.defaultCustomReportItem)||void 0===n?void 0:n.id,title:(null===(a=null==e?void 0:e[0])||void 0===a?void 0:a.reportTemplate)||(null===(r=null==t?void 0:t.defaultCustomReportItem)||void 0===r?void 0:r.id)},s.reportOptions=u,s.reportTypes=w.CustomReport}return Promise.resolve(s)})),M=e=>e?e.filter((e=>J(null==e?void 0:e.reportOptions)===S.RPTX)):[],P=(e,t)=>{var o;if(!t)return e;const l=null===(o=null==t?void 0:t.customTextElements)||void 0===o?void 0:o.map((e=>{const t={};for(const o in e)t[o]=!0;return t})),i=A(t);return e.hasAuthorText=null==t?void 0:t.hasAuthorText,e.hasCopyrightText=null==t?void 0:t.hasCopyrightText,e.hasLegend=null==t?void 0:t.hasLegend,e.hasTitleText=null==t?void 0:t.hasTitleText,e.layoutOptions.customTextElements=(null==t?void 0:t.customTextElements)||[],e.layoutOptions.elementOverrides=i,e.customTextElementEnableList=l||[],e.enableNorthArrow=!!Q(i),e.enableLegend=e.hasLegend,e.enableAuthor=e.hasAuthorText,e.enableCopyright=e.hasCopyrightText,e.enableScalebarUnit=!0,e.hasLegend&&(null==e?void 0:e.layoutOptions)&&(e.layoutOptions.legendLayers=[]),e},L=e=>{const{templateTaskInfo:t,templatesInTask:o,reportOption:l,defaultLayoutOptionInfo:i,printServiceType:n,printTemplateType:a}=e,r=o?te(o,n,a):[],s=null==r?void 0:r.map((e=>{var o;let n;if(t&&0!==(null==t?void 0:t.length)?t.forEach((t=>{e.label===t.layoutTemplate&&(n=t)})):n=p,(null==e?void 0:e.layout)&&(e.layout=F(null==e?void 0:e.layout)),(null==e?void 0:e.format)&&(e.format=null===(o=null==e?void 0:e.format)||void 0===o?void 0:o.toLowerCase()),(null==n?void 0:n.webMapFrameSize)&&(e.mapFrameSize=null==n?void 0:n.webMapFrameSize,e.mapFrameUnit=null==n?void 0:n.pageUnits),(e=P(e,null==n?void 0:n.layoutOptions)).mapFrameUnit=null==n?void 0:n.pageUnits,e.selectedFormatList=[null==e?void 0:e.format],l&&((null==l?void 0:l.customReportItem)&&(e.customReportItem=null==l?void 0:l.customReportItem),(null==l?void 0:l.report)&&(e.report=null==l?void 0:l.report),(null==l?void 0:l.reportOptions)&&(e.reportOptions=null==l?void 0:l.reportOptions),(null==l?void 0:l.reportTypes)&&(e.reportTypes=null==l?void 0:l.reportTypes)),i){(null==i?void 0:i.layoutTypes)&&(e.layoutTypes=null==i?void 0:i.layoutTypes),(null==i?void 0:i.customLayoutItem)&&(e.customLayoutItem=null==i?void 0:i.customLayoutItem);const t=null==i?void 0:i.templateInfo;t&&((null==t?void 0:t.layoutOptions)&&(e.layoutOptions=null==t?void 0:t.layoutOptions),(null==t?void 0:t.pageUnits)&&(e.mapFrameUnit=null==t?void 0:t.pageUnits),(null==t?void 0:t.webMapFrameSize)&&(e.mapFrameSize=null==t?void 0:t.webMapFrameSize))}return e}));return s},A=e=>{const t=(null==e?void 0:e.mapSurroundInfos)||[],o={};return null==t||t.forEach((e=>{e.type===`${a}`&&(e.visible=!0),o[e.name]=e})),o},E=(e,t)=>{const o=(null==e?void 0:e.map((e=>{e.layoutTemplate=F(null==e?void 0:e.layout);const o=V(null==e?void 0:e.layout);return null==t||t.forEach((t=>{(null==e?void 0:e.layout)===(null==t?void 0:t.layout)&&(e.mapFrameSize=null==t?void 0:t.mapFrameSize,e.mapFrameUnit=null==t?void 0:t.mapFrameUnit,e.hasAuthorText=null==t?void 0:t.hasAuthorText,e.hasCopyrightText=null==t?void 0:t.hasCopyrightText,e.hasLegend=null==t?void 0:t.hasLegend,e.hasTitleText=null==t?void 0:t.hasTitleText,!o&&(e.layoutOptions=null==t?void 0:t.layoutOptions),e.customTextElementEnableList=null==t?void 0:t.customTextElementEnableList,e.enableNorthArrow=t.enableNorthArrow,e.enableLegend=t.hasLegend,e.enableAuthor=t.hasAuthorText,e.enableCopyright=t.hasCopyrightText,e.enableScalebarUnit=!0,e.enableNorthArrow=null==t?void 0:t.enableNorthArrow)})),e})))||[];return o},z=e=>{const o=t.UtilityManager.getInstance().getUtilityJson(e);return"org"===(null==o?void 0:o.source)?y.OrganizationService:y.Customize};var D,U=function(e,t,o,l){return new(o||(o=Promise))((function(i,n){function a(e){try{s(l.next(e))}catch(e){n(e)}}function r(e){try{s(l.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,r)}s((l=l.apply(e,t||[])).next())}))};!function(e){e.AsynchronousSubmit="esriExecutionTypeAsynchronous",e.SynchronousExecute="esriExecutionTypeSynchronous"}(D||(D={}));const $=(e,t)=>e===y.Customize||t===f.Customize?"custom":"org",B=(e,o)=>{let l=o;return(null==e?void 0:e.exportOptions)&&(l=l.set("exportOptions",Object.assign(Object.assign({},e.exportOptions||{}),(null==o?void 0:o.exportOptions)||{}))),(null==e?void 0:e.layoutOptions)&&(null==o?void 0:o.layoutOptions)&&(l=l.set("layoutOptions",Object.assign(Object.assign({},(null==e?void 0:e.layoutOptions)||{}),(null==o?void 0:o.layoutOptions)||{}))),(0,t.Immutable)(Object.assign(Object.assign({},e),l))},q=(e,t)=>{let o;return null==e||e.forEach(((e,l)=>{(null==e?void 0:e.templateId)===t&&(o=l)})),o},G=(e,t)=>e===y.Customize||t===f.Customize,F=e=>e,V=e=>"map-only"===(e=>{var t,o;return null===(o=null===(t=null==e?void 0:e.replace(/\_/gi,"-"))||void 0===t?void 0:t.replace(/\s+/gi,"-"))||void 0===o?void 0:o.toLowerCase()})(e),Z=e=>U(void 0,void 0,void 0,(function*(){return t.UtilityManager.getInstance().getUrlOfUseUtility(e).then((e=>Promise.resolve(e)))}));function H(e,o,l){return U(this,void 0,void 0,(function*(){const i={query:{"env:outSR":"","env:processSR":"",returnZ:!1,returnM:!1,returnTrueCurves:!1,returnFeatureCollection:!1,context:"",f:"json"},responseType:"json"},n=yield(a=e,C(void 0,void 0,void 0,(function*(){return t.ServiceManager.getInstance().fetchArcGISServerInfo(a).then((e=>Promise.resolve(null==e?void 0:e.owningSystemUrl)),(e=>Promise.reject(e)))})));var a;const r=n?t.SessionManager.getInstance().getSessionByUrl(n):null;if(l){const e={id:l};r&&(e.token=r.token),o===m.LayoutTemplate&&(r&&(i.query.token=r.token),i.query.Layout_Item_ID=JSON.stringify(e)),o===m.ReportTemplate&&(i.query.Report_Item_ID=JSON.stringify(e))}return function(e){var o;if(!e)return Promise.resolve(null);const l=`${null===(o=e.split("/GPServer"))||void 0===o?void 0:o[0]}/GPServer`,i={query:{f:"json"},responseType:"json"};return(0,t.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[t]=e;return t(l,i).then((e=>{var t,o;const i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.tasks,n=null===(o=null==e?void 0:e.data)||void 0===o?void 0:o.executionType,a=n===D.SynchronousExecute?"execute":"submitJob";let r=null,s=null,u=null,c=null;return null==i||i.forEach((e=>{((null==e?void 0:e.includes("Layout"))||(null==e?void 0:e.includes("Layout")))&&(r=`${l}/${e}`,s=`${l}/${e}/${a}`),((null==e?void 0:e.includes("Report"))||(null==e?void 0:e.includes("report")))&&(u=`${l}/${e}`,c=`${l}/${e}/${a}`)})),Promise.resolve({layoutTemplatesInfoTaskUrl:r,layoutTemplatesInfoRequestUrl:s,reportTemplatesInfoTaskUrl:u,reportTemplatesInfoRequestUrl:c,executionType:n})}))}))}(e).then((e=>{const{layoutTemplatesInfoRequestUrl:l,reportTemplatesInfoRequestUrl:n,reportTemplatesInfoTaskUrl:a,executionType:r,layoutTemplatesInfoTaskUrl:s}=e,u=o===m.ReportTemplate?n:l;return u?(0,t.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[t]=e;return t(u,i).then((e=>U(this,void 0,void 0,(function*(){var l,n,u;if(r===D.AsynchronousSubmit){const n=null===(l=null==e?void 0:e.data)||void 0===l?void 0:l.jobId;return function(e,t,o,l){return U(this,void 0,void 0,(function*(){const i=`${e}/jobs/${t}/results/Output_JSON`;return new Promise(((e,t)=>{let n=0;const a=()=>{l(i,o).then((t=>{var o;(null===(o=null==t?void 0:t.data)||void 0===o?void 0:o.value)?e(t.data.value):(n++,n<10?setTimeout(a,3e3):e([]))})).catch((e=>{t(e)}))};a()}))}))}(o===m.ReportTemplate?a:s,n,i,t)}return Promise.resolve((null===(u=null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.results[0])||void 0===u?void 0:u.value)||[])}))),(e=>Promise.reject(e))).catch((e=>Promise.reject(e)))})):Promise.resolve(null)}))}))}function _(e){return U(this,void 0,void 0,(function*(){return(0,t.loadArcGISJSAPIModules)(["esri/rest/support/LegendLayer"]).then((t=>{var o,l,i;const[n]=t,a=W((null===(i=null===(l=null===(o=null==e?void 0:e.view)||void 0===o?void 0:o.map)||void 0===l?void 0:l.layers)||void 0===i?void 0:i.toArray())||[],n);return Promise.resolve(a)}))}))}function W(e,t){if(!e)return[];let o=[];return null==e||e.forEach((e=>{var l;const i=(null==e?void 0:e.effect)&&(null==e?void 0:e.effect.length)>0;if("graphics"!==e.type&&e.visible&&(null==e?void 0:e.legendEnabled)&&!i){const i=(null==e?void 0:e.subLayerIds)||null;if("group"===(null==e?void 0:e.type)){const i=W((null===(l=null==e?void 0:e.layers)||void 0===l?void 0:l._items)||[],t)||[];o=o.concat(i)}const n=new t({layerId:null==e?void 0:e.id,title:null==e?void 0:e.title,subLayerIds:i});o.push(n)}})),o}function Q(e={}){var t;let o=null;for(const l in e)(null===(t=null==e?void 0:e[l])||void 0===t?void 0:t.type)===a&&(o=l);return o}function J(e){if(!e)return null;let t=S.RPTX;const o=(null==e?void 0:e.reportSectionOverrides)||{};return Object.keys(o).forEach((e=>{const l=o[e];((null==l?void 0:l.fieldElements)||(null==l?void 0:l.fieldLabelElements))&&(t=S.RPTT)})),t}function K(e,t,o){var l,i;const n=(null==e?void 0:e.printTemplateType)===f.Customize?null===(l=e.printCustomTemplate)||void 0===l?void 0:l.asMutable({deep:!0}):null===(i=e.printOrgTemplate)||void 0===i?void 0:i.asMutable({deep:!0});return n[t]=o,(null==e?void 0:e.printTemplateType)===f.Customize?e.set("printCustomTemplate",n):e.set("printOrgTemplate",n)}function Y(e){const{reportOptions:t,defaultCustomReportItem:o,defaultReportTemplate:l,supportCustomReport:i,supportReport:n,reportTypes:a}=e;if(!i&&!n)return!0;switch(a){case w.CustomReport:return t?X(t):!o&&!l;case w.ServiceReport:return t?X(t):!l}}function X(e){if(!(null==e?void 0:e.reportSectionOverrides))return!1;const t=(null==e?void 0:e.reportSectionOverrides)||{};let o=!0;return Object.keys(t).forEach(((e,l)=>{var i,n;const a=t[e];if((null==a?void 0:a.exbDatasource)&&0!==(null===(i=null==a?void 0:a.exbDatasource)||void 0===i?void 0:i.length)){const e=ee()||[],t=null===(n=null==a?void 0:a.exbDatasource)||void 0===n?void 0:n[0],l=(null==t?void 0:t.rootDataSourceId)||(null==t?void 0:t.mainDataSourceId);(null==e?void 0:e.includes(l))||(o=!1)}else o=!1})),o}const ee=()=>{var e;const o=(0,t.getAppStore)().getState(),l=(null==o?void 0:o.appStateInBuilder)?null===(e=null==o?void 0:o.appStateInBuilder)||void 0===e?void 0:e.appConfig:null==o?void 0:o.appConfig,i=null==l?void 0:l.dataSources,n=[];return Object.keys(i).forEach((e=>{const o=i[e];(null==o?void 0:o.type)!==t.ArcGISDataSourceTypes.WebScene&&n.push(o.id)})),n.length>0?(0,t.Immutable)(n):void 0},te=(e,o,l)=>{const i=e.map((e=>{var o;let l=(0,t.Immutable)(e);return l=l.set("layout",F(null==e?void 0:e.layout)),l=l.setIn(["layoutOptions","scalebarUnit"],"Miles").setIn(["layoutOptions","legendLayers"],null),l=l.set("reportTypes",w.ServiceReport).set("layoutTypes",T.ServiceLayout),V(null==l?void 0:l.layout)&&(l=l.set("exportOptions",Object.assign({width:800,height:1100},null==e?void 0:e.exportOptions))),null===(o=B((0,t.Immutable)(d),(0,t.Immutable)(l)))||void 0===o?void 0:o.asMutable({deep:!0})}));return oe(i,o,l)},oe=(e,t,o)=>{const l=$(t,o);return e.map(((e,t)=>(e.templateId=`config_${l}_${t}`,e)))};function le(e,t,o){const l=V(e)?{}:{layoutOptions:{legend:!1}},i=o||t[0]||"PNG32";return Object.assign({label:e,layout:e,format:i},l)}var ie=v(59587);const ne=(e,t,o)=>{const l=e.map((e=>e.templateId)),i=$(t,o);return l&&0!==(null==l?void 0:l.length)?`config_${i}_${ae(l)+1}`:`config_${i}_0`},ae=e=>{var t;const o=null==e?void 0:e.map((e=>{var t;const o=null===(t=null==e?void 0:e.split("_"))||void 0===t?void 0:t.pop();return o?Number(o):0}));return null===(t=null==o?void 0:o.sort(((e,t)=>t-e)))||void 0===t?void 0:t[0]},re=(e,o,l)=>{var i,n;const a=null===(i=null==l?void 0:l.filter((e=>(null==e?void 0:e.layout)===o)))||void 0===i?void 0:i[0];let r=Object.assign(Object.assign(Object.assign({},e),a),{layoutTypes:T.ServiceLayout});return V(null==a?void 0:a.layout)&&(r=null===(n=(0,t.Immutable)(r).setIn(["exportOptions","width"],800).setIn(["exportOptions","height"],1100))||void 0===n?void 0:n.asMutable({deep:!0})),r};function se(e,t){if(t){const t={reportTemplate:"None"};e.unshift(t)}return e}var ue=v(95369),ce=v.n(ue);const pe=e=>{const o=window.SVG,{className:l}=e,i=function(e,t){var o={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(o[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(l=Object.getOwnPropertySymbols(e);i<l.length;i++)t.indexOf(l[i])<0&&Object.prototype.propertyIsEnumerable.call(e,l[i])&&(o[l[i]]=e[l[i]])}return o}(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",l);return o?t.React.createElement(o,Object.assign({className:n,src:ce()},i)):t.React.createElement("svg",Object.assign({className:n},i))},de=t.css`
  .report-remind-alert .jimu-icon-component {
    color: var(--warning-400) !important;
  }
`,me=e=>{const o=t.hooks.useTranslation(i.defaultMessages),{config:l,templateList:n,itemStateDetailContent:a,activeTemplateId:r,handelActiveTemplateIdChange:s,handelTemplateListChange:u}=e,[c,p]=t.React.useState(!1),d=t.hooks.useEventCallback((e=>{let t=0;const o=l=>(e=>n.some((t=>t.label===e)))(l)?(t+=1,o(l=`${e} ${t}`)):l;return o(e)})),m=e=>{p(!c),e.stopPropagation()};return(0,t.jsx)("div",{className:"d-flex align-items-center",css:de},!(e=>{const{defaultCustomReportItem:t,defaultReportTemplate:o,supportCustomReport:i,supportReport:n}=l;return Y({defaultCustomReportItem:t,defaultReportTemplate:o,supportCustomReport:i,supportReport:n,reportOptions:null==e?void 0:e.reportOptions,reportTypes:null==e?void 0:e.reportTypes})})(a)&&(0,t.jsx)(i.Alert,{className:"report-remind-alert",buttonType:"tertiary",form:"tooltip",size:"small",type:"warning",text:o("reportTemplateRemind")}),(0,t.jsx)(i.Dropdown,{direction:"down",size:"sm",useKeyUpEvent:!0,toggle:m,isOpen:c},(0,t.jsx)(i.DropdownButton,{size:"sm",arrow:!1,icon:!0,onClick:m,type:"tertiary",title:o("more")},(0,t.jsx)(pe,{size:"s"})),(0,t.jsx)(i.DropdownMenu,null,(0,t.jsx)(i.DropdownItem,{title:o("duplicate"),onClick:e=>{e.stopPropagation();const t=q(n,r),o=ne(n,l.printServiceType,l.printTemplateType),i=n,a=d(n[t].label),c=Object.assign(Object.assign({},n[t]),{templateId:o,label:a});i.push(c),u(i),setTimeout((()=>{s(o)}),200)}},o("duplicate")),(0,t.jsx)(i.DropdownItem,{title:o("deleteOption"),onClick:()=>{const e=q(n,r),t=n;null==t||t.splice(e,1),u(t),s(null)}},o("deleteOption")))))},ve=t.css`
  .report-remind-alert {
    .jimu-icon-component {
      color: var(--warning-400) !important;
    }
    &.jimu-btn {
      padding: 0 !important;
    }
  }
`,ge=e=>{const{className:o,config:l,activeTemplateId:i,showNewTemplateItem:n,handelActiveTemplateIdChange:a,handelTemplateListChange:r}=e,s={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:ie.TreeItemActionType.RenderOverrideItem,children:[{name:ie.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:ie.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:ie.TreeItemActionType.RenderOverrideItemBody,children:[{name:ie.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:ie.TreeItemActionType.RenderOverrideItemDragHandle},{name:ie.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:ie.TreeItemActionType.RenderOverrideItemTitle},{name:ie.TreeItemActionType.RenderOverrideItemDetailToggle},{name:ie.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};t.React.useEffect((()=>{c((null==l?void 0:l.printTemplateType)===f.Customize||(null==l?void 0:l.printServiceType)===y.Customize),m()}),[l]);const[u,c]=t.React.useState((null==l?void 0:l.printTemplateType)===f.Customize||(null==l?void 0:l.printServiceType)===y.Customize),[p,d]=t.React.useState([]),m=()=>{var e,t;(null==l?void 0:l.printServiceType)===y.Customize||(null==l?void 0:l.printTemplateType)===f.Customize?d((null===(e=null==l?void 0:l.printCustomTemplate)||void 0===e?void 0:e.asMutable({deep:!0}))||[]):d((null===(t=null==l?void 0:l.printOrgTemplate)||void 0===t?void 0:t.asMutable({deep:!0}))||[])};return(0,t.jsx)("div",{className:`w-100 mt-2 ${o||""}`,css:ve},(0,t.jsx)(ie.List,Object.assign({className:"w-100",itemsJson:Array.from(p).map(((e,t)=>({itemStateDetailContent:e,itemKey:`${null==e?void 0:e.templateId}`,itemStateChecked:i&&(null==e?void 0:e.templateId)===i,itemStateTitle:null==e?void 0:e.label,itemStateIcon:null,itemStateCommands:[]}))),dndEnabled:u,renderOverrideItemDetailToggle:(e,o)=>{const{itemJsons:i}=o.props,[n]=i,s=null==n?void 0:n.itemStateDetailContent,u=null==n?void 0:n.itemKey;return(0,t.jsx)(me,{activeTemplateId:u,itemStateDetailContent:s,templateList:p,config:l,handelActiveTemplateIdChange:a,handelTemplateListChange:r})},onUpdateItem:(e,t)=>{const{itemJsons:o}=t.props,[,l]=o;if(e.updateType===ie.TreeItemActionType.HandleDidDrop){const e=l.map((e=>e.itemStateDetailContent));a(null),r(e)}},onClickItemBody:(e,t)=>{const{itemJsons:o}=t.props,l=o[0],i=o[1];a(l.itemKey,i.indexOf(l))}},s)),n&&(0,t.jsx)(ie.List,Object.assign({className:"setting-ui-unit-list-new",itemsJson:[{name:"......"}].map(((e,t)=>({itemStateDetailContent:"item",itemKey:"index",itemStateChecked:!0,itemStateTitle:"......",itemStateCommands:[]}))),dndEnabled:!1,renderOverrideItemDetailToggle:()=>""},s)))};var he=v(34750),ye=v.n(he);const fe=e=>{const o=window.SVG,{className:l}=e,i=function(e,t){var o={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(o[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(l=Object.getOwnPropertySymbols(e);i<l.length;i++)t.indexOf(l[i])<0&&Object.prototype.propertyIsEnumerable.call(e,l[i])&&(o[l[i]]=e[l[i]])}return o}(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",l);return o?t.React.createElement(o,Object.assign({className:n,src:ye()},i)):t.React.createElement("svg",Object.assign({className:n},i))};var be=v(27218),xe=v.n(be);const Te=e=>{const o=window.SVG,{className:l}=e,i=function(e,t){var o={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(o[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(l=Object.getOwnPropertySymbols(e);i<l.length;i++)t.indexOf(l[i])<0&&Object.prototype.propertyIsEnumerable.call(e,l[i])&&(o[l[i]]=e[l[i]])}return o}(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",l);return o?t.React.createElement(o,Object.assign({className:n,src:xe()},i)):t.React.createElement("svg",Object.assign({className:n},i))};var Se=function(e,t,o,l){return new(o||(o=Promise))((function(i,n){function a(e){try{s(l.next(e))}catch(e){n(e)}}function r(e){try{s(l.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,r)}s((l=l.apply(e,t||[])).next())}))};const we=v(59216),Ie=new(0,t.esri.Sanitizer),{useRef:Ce}=t.React;var je;!function(e){e.Title="TITLE",e.Extents="EXTENTS",e.SpatialReference="SPATIAL REFERENCE",e.Feature="FEATURE ATTRIBUTION",e.Quality="QUALITY"}(je||(je={}));const Re=e=>{var o,l;const a=t.hooks.useTranslation(I,t.defaultMessages,i.defaultMessages),r=t.React.useRef(null),s=Ce(null),c=Ce(!1),p=t.css`
    .dpi-input .input-wrapper{
      padding-right: 0;
    }
    .radio-con {
      cursor: ponter;
    }
    .use-current-map-scale svg{
      margin: 0 auto;
    }
    .enable-setting-con .jimu-widget-setting--row-label{
      margin-bottom: 0;
    }
    .wkid-describtion {
      font-size: ${t.polished.rem(12)};
      color: var(--dark-400);
    }
    .wkid-describtion-invalid {
      color: var(--danger-700)
    }
    .check-box-con, .radio-con {
      color: var(--dark-400);
      font-size: ${t.polished.rem(14)};
      line-height: ${t.polished.rem(22)};
      margin: ${t.polished.rem(4)} 0 ${t.polished.rem(8)} 0;
    }
  `,{printTemplateProperties:d,modeType:m,jimuMapView:v,handleTemplatePropertyChange:g}=e,[y,f]=t.React.useState(null),[b,x]=t.React.useState((null===(o=d.layoutOptions)||void 0===o?void 0:o.titleText)||""),[T,S]=t.React.useState(null==d?void 0:d.wkid),[w,C]=t.React.useState(null===(l=null==d?void 0:d.exportOptions)||void 0===l?void 0:l.dpi),[j,R]=t.React.useState(null==d?void 0:d.outScale),[O,N]=t.React.useState(null);t.React.useEffect((()=>{var e,t;x((null===(e=d.layoutOptions)||void 0===e?void 0:e.titleText)||""),S(null==d?void 0:d.wkid),r.current=null==d?void 0:d.wkid,C(null===(t=null==d?void 0:d.exportOptions)||void 0===t?void 0:t.dpi),R(null==d?void 0:d.outScale),(null==d?void 0:d.wkidLabel)?N(null==d?void 0:d.wkidLabel):s.current&&k(null==d?void 0:d.wkid).then((e=>{N(e)}))}),[d]);const k=e=>Se(void 0,void 0,void 0,(function*(){if(c.current){const{getSRLabel:t}=s.current;return Promise.resolve(t(e))}return t.moduleLoader.loadModule("jimu-core/wkid").then((t=>{s.current=t,c.current=!0;const{getSRLabel:o}=s.current;return Promise.resolve(o(e))}))})),M=e=>Se(void 0,void 0,void 0,(function*(){if(c.current){const{isValidWkid:t}=s.current;return Promise.resolve(t(e))}return t.moduleLoader.loadModule("jimu-core/wkid").then((t=>{s.current=t,c.current=!0;const{isValidWkid:o}=s.current;return Promise.resolve(o(e))}))})),P=e=>Se(void 0,void 0,void 0,(function*(){if(e===je.SpatialReference&&!(null==d?void 0:d.wkidLabel)){const e=yield k(null==d?void 0:d.wkid);N(e)}f(e)})),L=()=>{f(null)},A=e=>{var t;let o=d.setIn(["printExtentType"],e);const l=v?null===(t=null==v?void 0:v.view)||void 0===t?void 0:t.scale:36978595.474472;switch(e){case u.CurrentMapExtent:o=o.setIn(["scalePreserved"],!1);break;case u.CurrentMapScale:o=o.setIn(["scalePreserved"],!0);break;case u.SetMapScale:o=o.setIn(["scalePreserved"],!0),o=o.setIn(["outScale"],l)}g(o)},E=e=>{const t=d.setIn([e],!(null==d?void 0:d[e]));g(t)};return(0,t.jsx)("div",{css:p},(0,t.jsx)("div",{role:"group","aria-label":a("setDefaults")},(0,t.jsx)(n.SettingRow,{label:a("setDefaults"),flow:"wrap"}),(0,t.jsx)(i.CollapsablePanel,{label:a("printTitle"),isOpen:y===je.Title,onRequestOpen:()=>{P(je.Title)},onRequestClose:L,role:"group","aria-label":a("printTitle"),rightIcon:we,type:"primary",className:y===je.Title&&"active-collapse"},(0,t.jsx)(n.SettingRow,{className:"mt-2"},(0,t.jsx)(i.TextInput,{size:"sm",className:"search-placeholder w-100",placeholder:a("printTitle"),value:b,onAcceptValue:e=>{const t=d.setIn(["layoutOptions","titleText"],e);g(t)},onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;x(o)},"aria-label":a("printTitle")}))),(0,t.jsx)(i.CollapsablePanel,{label:a("mapPrintingExtents"),isOpen:y===je.Extents,onRequestOpen:()=>{P(je.Extents)},onRequestClose:L,role:"group","aria-label":a("mapPrintingExtents"),rightIcon:we,type:"primary",className:y===je.Extents&&"active-collapse"},(0,t.jsx)(n.SettingRow,{className:"mt-2"},(0,t.jsx)("div",{className:"w-100"},(0,t.jsx)("div",{title:a("currentMapExtent"),"aria-label":a("currentMapExtent"),className:"d-flex align-items-center radio-con",onClick:()=>{A(u.CurrentMapExtent)}},(0,t.jsx)(i.Radio,{title:a("currentMapExtent"),checked:(null==d?void 0:d.printExtentType)===u.CurrentMapExtent,className:"mr-2"})," ",a("currentMapExtent")),(0,t.jsx)("div",{title:a("currentMapScale"),"aria-label":a("currentMapScale"),className:"d-flex align-items-center radio-con",onClick:()=>{A(u.CurrentMapScale)}},(0,t.jsx)(i.Radio,{title:a("currentMapScale"),checked:(null==d?void 0:d.printExtentType)===u.CurrentMapScale,className:"mr-2"})," ",a("currentMapScale")),(0,t.jsx)("div",{title:a("setMapScale"),"aria-label":a("setMapScale"),className:"d-flex align-items-center radio-con",onClick:()=>{A(u.SetMapScale)}},(0,t.jsx)(i.Radio,{title:a("setMapScale"),checked:(null==d?void 0:d.printExtentType)===u.SetMapScale,className:"mr-2"})," ",a("setMapScale")),(null==d?void 0:d.printExtentType)===u.SetMapScale&&(0,t.jsx)("div",{className:"d-flex mt-1 align-items-center"},(0,t.jsx)(i.NumericInput,{size:"sm",className:"search-placeholder flex-grow-1 dpi-input",value:j,onAcceptValue:e=>{const t=d.setIn(["outScale"],e);g(t)},onChange:e=>{R(e)},showHandlers:!1}),(0,t.jsx)(i.Button,{className:"use-current-map-scale",size:"sm",title:a("useCurrentScale"),disabled:!v,onClick:()=>{var e;if(!v)return;const t=null===(e=null==v?void 0:v.view)||void 0===e?void 0:e.scale,o=d.setIn(["outScale"],t);g(o)}},(0,t.jsx)(Te,null)))))),(0,t.jsx)(i.CollapsablePanel,{label:a("outputSpatialReference"),isOpen:y===je.SpatialReference,onRequestOpen:()=>{P(je.SpatialReference)},onRequestClose:L,role:"group",type:"primary","aria-label":a("outputSpatialReference"),rightIcon:we,className:y===je.SpatialReference&&"active-collapse"},(0,t.jsx)(n.SettingRow,{flow:"wrap",label:(0,t.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:Ie.sanitize(a("wellKnownId",{wkid:'<a target="_blank" href="https://developers.arcgis.com/rest/services-reference/enterprise/using-spatial-references.htm">WKID</a>'}))}}),className:"mt-2"},(0,t.jsx)(i.NumericInput,{size:"sm",className:"search-placeholder w-100",value:T,onAcceptValue:e=>Se(void 0,void 0,void 0,(function*(){if(!(yield M(e))){S(r.current);const t=yield k(e);return N(t),!1}r.current=e;const t=d.setIn(["wkid"],e).set("wkidLabel",O);g(t);const o=yield k(e);N(o)})),onChange:e=>Se(void 0,void 0,void 0,(function*(){if(S(e),yield M(e)){const t=yield k(e);N(t)}else N(a("invalidWKID"))})),showHandlers:!1,"aria-label":a("wellKnownId",{wkid:"WKID"}),"aria-describedby":"print-wkid-describtion"}),(0,t.jsx)("div",{id:"print-wkid-describtion",className:(0,t.classNames)("text-truncate mt-1 wkid-describtion",{"wkid-describtion-invalid":!(e=>{if(s.current){const{isValidWkid:t}=s.current;return t(e)}return!0})(Number(T))}),title:O,"aria-label":O},O))),(0,t.jsx)(i.CollapsablePanel,{label:a("printQuality"),isOpen:y===je.Quality,onRequestOpen:()=>{P(je.Quality)},onRequestClose:L,role:"group","aria-label":a("printQuality"),type:"primary",rightIcon:we,className:y===je.Quality&&"active-collapse"},(0,t.jsx)(n.SettingRow,{className:"mt-2"},(0,t.jsx)("div",{className:"d-flex align-items-center w-100"},(0,t.jsx)(i.NumericInput,{size:"sm",className:"search-placeholder flex-grow-1 dpi-input",placeholder:a("printQuality"),value:w,onAcceptValue:e=>{if(e<1)return!1;const t=d.setIn(["exportOptions","dpi"],parseInt(e));g(t)},onChange:e=>{if(e<1)return!1;C(parseInt(e))},showHandlers:!1,"aria-label":a("printQuality")}),(0,t.jsx)(i.Button,{disabled:!0,size:"sm",title:"DPI"},"DPI")))),(0,t.jsx)(i.CollapsablePanel,{label:a("featureAttributes"),isOpen:y===je.Feature,onRequestOpen:()=>{P(je.Feature)},onRequestClose:L,role:"group",type:"primary","aria-label":a("featureAttributes"),rightIcon:we,className:y===je.Feature&&"active-collapse"},(0,t.jsx)(n.SettingRow,{className:"mt-2"},(0,t.jsx)("div",{title:a("includeAttributes"),className:"d-flex w-100 align-items-center check-box-con","aria-label":a("includeAttributes"),onClick:()=>{E("forceFeatureAttributes")}},(0,t.jsx)(i.Checkbox,{title:a("includeAttributes"),className:"lock-item-ratio","data-field":"forceFeatureAttributes",checked:(null==d?void 0:d.forceFeatureAttributes)||!1}),(0,t.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},a("includeAttributes")))))),m===h.Classic&&(0,t.jsx)(n.SettingRow,{className:"mt-4 enable-setting-con",flow:"wrap",role:"group","aria-label":a("selectEditableSettings"),label:a("selectEditableSettings")},(0,t.jsx)("div",{className:"w-100"},(0,t.jsx)("div",{title:a("printTitle"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{(()=>{let e=d.setIn(["showLabels"],!(null==d?void 0:d.showLabels));e=e.setIn(["enableTitle"],!(null==d?void 0:d.enableTitle)),g(e)})()}},(0,t.jsx)(i.Checkbox,{title:a("printTitle"),className:"lock-item-ratio","data-field":"enableTitle",checked:(null==d?void 0:d.enableTitle)||!1}),(0,t.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},a("printTitle"))),(0,t.jsx)("div",{title:a("mapPrintingExtents"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{E("enableMapPrintExtents")}},(0,t.jsx)(i.Checkbox,{title:a("mapPrintingExtents"),className:"lock-item-ratio","data-field":"enableMapPrintExtents",checked:(null==d?void 0:d.enableMapPrintExtents)||!1}),(0,t.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},a("mapPrintingExtents"))),(0,t.jsx)("div",{title:a("outputSpatialReference"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{E("enableOutputSpatialReference")}},(0,t.jsx)(i.Checkbox,{title:a("outputSpatialReference"),className:"lock-item-ratio","data-field":"enableOutputSpatialReference",checked:(null==d?void 0:d.enableOutputSpatialReference)||!1}),(0,t.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},a("outputSpatialReference"))),(0,t.jsx)("div",{title:a("printQuality"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{E("enableQuality")}},(0,t.jsx)(i.Checkbox,{title:a("printQuality"),className:"lock-item-ratio","data-field":"enableQuality",checked:(null==d?void 0:d.enableQuality)||!1}),(0,t.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},a("printQuality"))),(0,t.jsx)("div",{title:a("featureAttributes"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{E("enableFeatureAttribution")}},(0,t.jsx)(i.Checkbox,{title:a("featureAttributes"),className:"lock-item-ratio","data-field":"enableFeatureAttribution",checked:(null==d?void 0:d.enableFeatureAttribution)||!1}),(0,t.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},a("featureAttributes"))))))};var Oe=v(34796);function Ne(){return t.css`
    .dropdown >.dropdown-button:hover,  .dropdown >.dropdown-button{
      background: var(--light-200);
      border: 1px solid var(--light-200);
      border-radius: ${t.polished.rem(2)};
      text-align: left;
    }
  `}var ke=v(30224),Me=v.n(ke);const Pe=e=>{const o=window.SVG,{className:l}=e,i=function(e,t){var o={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(o[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(l=Object.getOwnPropertySymbols(e);i<l.length;i++)t.indexOf(l[i])<0&&Object.prototype.propertyIsEnumerable.call(e,l[i])&&(o[l[i]]=e[l[i]])}return o}(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",l);return o?t.React.createElement(o,Object.assign({className:n,src:Me()},i)):t.React.createElement("svg",Object.assign({className:n},i))};function Le(e){console&&console.warn&&console.warn.apply(console,[e])}var Ae=function(){function e(e){void 0===e&&(e=""),this.termStack=[],this.rangeStack=[],this.openGroups=0,this.q=e}return e.prototype.match=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.termStack=this.termStack.concat(e),this},e.prototype.in=function(e){var t="`in("+(e?'"'+e+'"':"")+")`";return this.hasRange||this.hasTerms?(e&&"*"!==e&&(this.q+=e+":"),this.commit()):(Le(t+" was called with no call to `match(...)` or `from(...)`/`to(...)`. Your query was not modified."),this)},e.prototype.startGroup=function(){return this.commit(),this.openGroups>0&&(this.q+=" "),this.openGroups++,this.q+="(",this},e.prototype.endGroup=function(){return this.openGroups<=0?(Le("`endGroup(...)` was called without calling `startGroup(...)` first. Your query was not modified."),this):(this.commit(),this.openGroups--,this.q+=")",this)},e.prototype.and=function(){return this.addModifier("and")},e.prototype.or=function(){return this.addModifier("or")},e.prototype.not=function(){return this.addModifier("not")},e.prototype.from=function(e){return this.hasTerms?(Le('`from(...)` is not allowed after `match(...)` try using `.from(...).to(...).in(...)`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date("2020-01-01").  Your query was not modified.'),this):(this.rangeStack[0]=e,this)},e.prototype.to=function(e){return this.hasTerms?(Le('`to(...)` is not allowed after `match(...)` try using `.from(...).to(...).in(...)`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date("2020-01-01"). Your query was not modified.'),this):(this.rangeStack[1]=e,this)},e.prototype.boost=function(e){return this.commit(),this.q+="^"+e,this},e.prototype.toParam=function(){return this.commit(),this.cleanup(),this.q},e.prototype.clone=function(){return this.commit(),this.cleanup(),new e(this.q+"")},e.prototype.addModifier=function(e){return this.currentModifer?(Le("You have called `"+this.currentModifer+"()` after `"+e+"()`. Your current query was not modified."),this):(this.commit(),""===this.q&&"not"!==e?(Le("You have called `"+e+"()` without calling another method to modify your query first. Try calling `match()` first."),this):(this.currentModifer=e,this.q+=""===this.q?"":" ",this.q+=e.toUpperCase()+" ",this))},e.prototype.needsQuotes=function(e){return/\s|:/g.test(e)},e.prototype.formatTerm=function(e){return e instanceof Date?e.getTime():"string"==typeof e&&this.needsQuotes(e)?'"'+e+'"':e},e.prototype.commit=function(){var e=this;return this.currentModifer=void 0,this.hasRange&&(this.q+="["+this.formatTerm(this.rangeStack[0])+" TO "+this.formatTerm(this.rangeStack[1])+"]",this.rangeStack=[void 0,void 0]),this.hasTerms&&(this.q+=this.termStack.map((function(t){return e.formatTerm(t)})).join(" "),this.termStack=[]),this},Object.defineProperty(e.prototype,"hasTerms",{get:function(){return this.termStack.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasRange",{get:function(){return this.rangeStack.length&&this.rangeStack[0]&&this.rangeStack[1]},enumerable:!1,configurable:!0}),e.prototype.cleanup=function(){if(this.openGroups>0)for(Le("Automatically closing "+this.openGroups+" group(s). You can use `endGroup(...)` to remove this warning.");this.openGroups>0;)this.q+=")",this.openGroups--;var e=this.q;this.q=e.replace(/( AND ?| NOT ?| OR ?)*$/,""),e!==this.q&&Le("`startGroup(...)` was called without calling `endGroup(...)` first. Your query was not modified."),this.q=this.q.replace(/(\(\))*/,"")},e}(),Ee=v(66325);function ze(e,t,o){let l=(new Ae).match(t).in("type");return o&&(l=l.and().startGroup().not().match(o).in("type").endGroup()),e&&(l=l.and().startGroup().match(e).endGroup()),l.toParam()}const De=[{name:"preventOverflow",options:{altAxis:!0}}],Ue=(0,Oe.styled)(i.DropdownMenu)`
  & .dropdown-item-con{
    max-height: ${t.polished.rem(400)};
    max-width: ${t.polished.rem(300)};
    min-width: ${t.polished.rem(227)};
    overflow: auto;
  }
  .search-container{
    padding: 0 0.5rem 0.5rem 0.5rem;
  }
  .loading-placeholder, .loading-con {
    width: ${t.polished.rem(16)};
    height: ${t.polished.rem(16)};
  }
  .loading-con {
    @keyframes loading {
      0% {transform: rotate(0deg)};
      100% {transform: rotate(360deg)};
    }
    position: absolute;
    right: ${t.polished.rem(8)};
    bottom: ${t.polished.rem(2)};
    min-width: ${t.polished.rem(16)};
    border: 2px solid var(--dark-600);
    border-radius: 50%;
    border-top: 2px solid var(--primary-500);
    box-sizing: border-box;
    animation:loading 2s infinite linear;
    box-sizing: border-box;
  }
`,{useState:$e,useRef:Be,useEffect:qe}=t.React,Ge=(0,Oe.withStyles)((e=>{const o=Be(null),l=Be(null),n=Be(null),a=Be(1),r=Be(""),s=Be((0,t.Immutable)([])),u=Be(null),c=Be(null),p=t.hooks.useTranslation(i.defaultMessages),{portalUrl:d,title:m,className:v,size:g,buttonProps:h,menuProps:y,zIndex:f,fluid:b,autoWidth:x,appendToBody:T,strategy:S,useKeyUpEvent:w,hideSearchInput:I,itemtype:C,activeItem:j,placeholder:R,excludeType:O,onChange:N}=e,[k,M]=$e(!1),[P,L]=$e(""),[A,E]=$e(!1),[z,D]=$e((0,t.Immutable)([]));qe((()=>{U()}),[]);const U=t.hooks.useEventCallback((()=>{if(a.current<0)return;const e=t.SessionManager.getInstance().getSessionByUrl(d),o={searchText:P,start:a.current,searchItemtype:C||"Layout",portalUrl:d,excludeType:O};e&&(o.authentication=e),E(!0),function(e){return t=this,o=void 0,i=function*(){const{searchText:t,portalUrl:o,num:l,start:i,sortField:n,sortOrder:a,searchItemtype:r,excludeType:s,authentication:u}=e;if(!o)return Promise.reject("No portal url");const c={start:i||1,num:l||30,q:ze(t,r,s),sortField:n||"modified",sortOrder:a||"desc"};return u&&(c.authentication=u),Ee.appServices.searchAppByPortalUrl(c,o)},new((l=void 0)||(l=Promise))((function(e,n){function a(e){try{s(i.next(e))}catch(e){n(e)}}function r(e){try{s(i.throw(e))}catch(e){n(e)}}function s(t){var o;t.done?e(t.value):(o=t.value,o instanceof l?o:new l((function(e){e(o)}))).then(a,r)}s((i=i.apply(t,o||[])).next())}));var t,o,l,i}(o).then((e=>{var o;if(E(!1),e){let l=1===a.current?[]:null===(o=s.current)||void 0===o?void 0:o.asMutable({deep:!0});a.current=null==e?void 0:e.nextStart;const i=(null==e?void 0:e.results)||[];l=l.concat(i),s.current=(0,t.Immutable)(l),D((0,t.Immutable)(l))}})).catch((e=>{E(!1)}))})),$=(e=!1)=>{var t;e&&(null===(t=s.current)||void 0===t?void 0:t.length)>0&&U()};return t.React.createElement("div",{className:(0,t.classNames)("app-item-selector-con w-100",v)},t.React.createElement(i.Dropdown,{className:"w-100",size:g,direction:"down",fluid:b,autoWidth:x,toggle:()=>{M(!k)},isOpen:k,useKeyUpEvent:w,handelTabEvent:e=>{const t=!I&&l.current;let o;return"Tab"===e.key&&e.shiftKey?o=t:"Tab"===e.key&&e.shiftKey,!!o&&(e.preventDefault(),o.focus(),!0)}},t.React.createElement(i.DropdownButton,Object.assign({size:g},h,{title:m||(null==j?void 0:j.title),innerRef:e=>{o.current=e},"aria-label":e["aria-label"],"aria-describedby":e["aria-describedby"],"a11y-description":e["a11y-description"]}),(null==j?void 0:j.title)||R),t.React.createElement(Ue,Object.assign({appendToBody:T,strategy:S,zIndex:f+"",className:"shadow-lg",modifiers:De,trapFocus:!1},y),d&&t.React.createElement("div",null,!I&&t.React.createElement("div",{className:"search-container"},t.React.createElement(i.TextInput,{prefix:t.React.createElement(Pe,null),allowClear:!0,size:"sm",type:"text",value:P,ref:l,placeholder:p("SearchLabel"),onChange:e=>{a.current=1,r.current=e.target.value,L(e.target.value),clearTimeout(u.current),s.current=(0,t.Immutable)([]),u.current=setTimeout((()=>{U()}),500)}})),t.React.createElement("div",{className:"dropdown-item-con",ref:e=>{(e=>{e&&c.current&&function(e,t,o,l){new IntersectionObserver((function(e,t){const l=e[0].intersectionRatio>0;o&&o(l)}),{root:t}).observe(e)}(c.current,e,$)})(e)}},z.map(((e,o)=>t.React.createElement(i.DropdownItem,{ref:e=>{((e,t)=>{0===t&&e&&(n.current=e)})(e,o)},key:o,className:"select-item text-truncate d-block text-left",onClick:t=>{(e=>{e.id!==(null==j?void 0:j.id)&&N&&N(e)})(null==e?void 0:e.asMutable({deep:!0}))},active:(null==j?void 0:j.id)===e.id,title:e.title},e.title))),(null==z?void 0:z.length)>0&&!A&&t.React.createElement("span",{ref:c}),0===(null==z?void 0:z.length)&&!A&&t.React.createElement(i.DropdownItem,{disabled:!0},p("noItemsFound")),A&&t.React.createElement("div",{className:"loading-item"},t.React.createElement("div",{className:"loading-placeholder"}),t.React.createElement("div",{className:"loading-con"})))))))}),"AppItemSelector");(0,Oe.registerStyles)("jimu-ui/advanced/app-item-selector",e);const{useState:Fe,useEffect:Ve}=t.React,Ze=t.css`
  .radio-con {
    cursor: pointer;
  }
`,He=e=>{const o=t.hooks.useTranslation(I),{id:l,template:a,config:r,templateIndex:s,handleLayoutChange:u,onSettingChange:c,toggleLoading:p}=e,[d,v]=Fe(null),[g,h]=Fe(null);Ve((()=>{v(null==a?void 0:a.customLayoutItem)}),[s]),Ve((()=>{j(r.useUtility).then((e=>{h(e)}))}),[r.useUtility]);const y=e=>{return o=void 0,i=void 0,u=function*(){const o={id:e.id,title:e.title};v(o),p(!0),((e,o,l)=>C(void 0,void 0,void 0,(function*(){const i=null==o?void 0:o.id;return i?R(i,null==e?void 0:e.useUtility,m.LayoutTemplate).then((i=>{var n,a;const r=null==i?void 0:i[0];let s=((null==e?void 0:e.printTemplateType)===f.Customize?null===(n=e.printCustomTemplate)||void 0===n?void 0:n.asMutable({deep:!0}):null===(a=e.printOrgTemplate)||void 0===a?void 0:a.asMutable({deep:!0}))[l];s.customLayoutItem=o,s=function(e,o){if(!e||!o)return o;(null==e?void 0:e.webMapFrameSize)&&(o.mapFrameSize=null==e?void 0:e.webMapFrameSize),(null==e?void 0:e.pageUnits)&&(o.mapFrameUnit=null==e?void 0:e.pageUnits);const l=null==e?void 0:e.layoutOptions,i=(0,t.Immutable)(l).without("hasAuthorText","hasCopyrightText","hasLegend","hasTitleText");return o.layoutOptions=null==i?void 0:i.asMutable({deep:!0}),o=P(o,l),l&&(o.layout=""),o}(r,s);const u=K(e,l,s);return Promise.resolve(u)}),(e=>Promise.reject(e))).catch((e=>Promise.reject(e))):Promise.reject("No custom layout item id")})))(r,o,s).then((e=>{p(!1),c({id:l,config:e})}),(e=>{v((null==a?void 0:a.customLayoutItem)||null),p(!1)}))},new((n=void 0)||(n=Promise))((function(e,t){function l(e){try{r(u.next(e))}catch(e){t(e)}}function a(e){try{r(u.throw(e))}catch(e){t(e)}}function r(t){var o;t.done?e(t.value):(o=t.value,o instanceof n?o:new n((function(e){e(o)}))).then(l,a)}r((u=u.apply(o,i||[])).next())}));var o,i,n,u},b=()=>{var e,t;const o=a.set("layoutTypes",T.CustomLayout).set("customLayoutItem",null),i=(null==r?void 0:r.printTemplateType)===f.Customize?null===(e=r.printCustomTemplate)||void 0===e?void 0:e.asMutable({deep:!0}):null===(t=r.printOrgTemplate)||void 0===t?void 0:t.asMutable({deep:!0});i[s]=null==o?void 0:o.asMutable({deep:!0});const n=(null==r?void 0:r.printTemplateType)===f.Customize?r.set("printCustomTemplate",i):r.set("printOrgTemplate",i);v(null),c({id:l,config:n})},x=()=>{var e,t;const o=null===(t=null===(e=null==r?void 0:r.layoutChoiceList)||void 0===e?void 0:e[s])||void 0===t?void 0:t.layout;u(F(o))};return(0,t.jsx)("div",{className:"custom-layout-setting-con mt-2",css:Ze},(0,t.jsx)(n.SettingRow,{flow:"wrap",label:o("printLayout")}),(()=>{var e;const l=r.supportCustomLayout,s=!(null==a?void 0:a.layoutTypes)||(null==a?void 0:a.layoutTypes)===T.ServiceLayout||!l;return(0,t.jsx)("div",{role:"group","aria-label":o("printLayout")},l&&(0,t.jsx)(n.SettingRow,null,(0,t.jsx)("div",{className:"d-flex radio-con align-items-center",title:o("useServiceLayout"),onClick:x},(0,t.jsx)(i.Radio,{className:"mr-1",checked:s,title:o("useServiceLayout")}),(0,t.jsx)("span",null,o("useServiceLayout")))),l&&(0,t.jsx)(n.SettingRow,null,(0,t.jsx)("div",{className:"d-flex radio-con align-items-center",title:o("useCustomLayout"),onClick:b},(0,t.jsx)(i.Radio,{checked:(null==a?void 0:a.layoutTypes)===T.CustomLayout,className:"mr-1",title:o("useCustomLayout")}),(0,t.jsx)("span",null,o("useCustomLayout")))),s&&(0,t.jsx)(n.SettingRow,null,(0,t.jsx)(i.Select,{value:F(null==a?void 0:a.layout),onChange:e=>{u(e.target.value)},size:"sm",disabled:(null==r?void 0:r.printTemplateType)===f.OrganizationTemplate,"aria-label":o("printLayout")},null===(e=null==r?void 0:r.layoutChoiceList)||void 0===e?void 0:e.map(((e,o)=>(0,t.jsx)(i.Option,{key:`layout${o}`,value:null==e?void 0:e.layoutTemplate,title:null==e?void 0:e.layoutTemplate},null==e?void 0:e.layoutTemplate))))),(null==a?void 0:a.layoutTypes)===T.CustomLayout&&l&&(0,t.jsx)(n.SettingRow,null,(0,t.jsx)(Ge,{portalUrl:g,activeItem:d,itemtype:"Layout",size:"sm",placeholder:o("selectLayoutItemPlaceholder"),onChange:y})))})())};var _e=v(338),We=v(88866),Qe=v.n(We);const Je=e=>{const o=window.SVG,{className:l}=e,i=function(e,t){var o={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(o[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(l=Object.getOwnPropertySymbols(e);i<l.length;i++)t.indexOf(l[i])<0&&Object.prototype.propertyIsEnumerable.call(e,l[i])&&(o[l[i]]=e[l[i]])}return o}(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",l);return o?t.React.createElement(o,Object.assign({className:n,src:Qe()},i)):t.React.createElement("svg",Object.assign({className:n},i))},Ke=t.css`
  & .loading-con {
    width: ${t.polished.rem(16)};
    height: ${t.polished.rem(16)};
  }
`,Ye=e=>{const{text:o,className:l}=e;return(0,t.jsx)("div",{css:Ke,className:(0,t.classNames)(l,"d-flex align-items-center")},(0,t.jsx)("div",{className:"loading-con position-relative mr-1"},(0,t.jsx)(i.Loading,{width:16,height:16,type:i.LoadingType.Donut})),(0,t.jsx)("div",null,o))};const{useState:Xe,useEffect:et}=t.React,tt=t.css`
  .report-temp-tip-button {
    padding: 0;
  }
  .radio-con {
    cursor: pointer;
  }
  .warning-alert-con {
    position: absolute;
    top: ${t.polished.rem(50)};
    right: ${t.polished.rem(8)};
    left: ${t.polished.rem(8)};
  }
`,ot=e=>{const o=t.hooks.useTranslation(I),{id:l,template:a,config:r,templateIndex:s,onSettingChange:u}=e,[c,p]=Xe(null),[d,v]=Xe(null),[g,h]=Xe(!1);et((()=>{p(null==a?void 0:a.customReportItem)}),[s]),et((()=>{j(r.useUtility).then((e=>{v(e)}))}),[r.useUtility]);const y=(e=!1)=>{h(e)},b=e=>{return t=void 0,o=void 0,n=function*(){const t={id:e.id,title:e.title};p(t),y(!0),((e,t,o)=>C(void 0,void 0,void 0,(function*(){const l=null==t?void 0:t.id;return l?R(l,null==e?void 0:e.useUtility,m.ReportTemplate).then((l=>{var i,n;const a=null==l?void 0:l[0],r=((null==e?void 0:e.printTemplateType)===f.Customize?null===(i=e.printCustomTemplate)||void 0===i?void 0:i.asMutable({deep:!0}):null===(n=e.printOrgTemplate)||void 0===n?void 0:n.asMutable({deep:!0}))[o];r.customReportItem=t,r.reportOptions=(null==a?void 0:a.reportOptions)||{};const s=K(e,o,r);return Promise.resolve(s)}),(e=>Promise.reject(e))).catch((e=>Promise.reject(e))):Promise.reject("No custom report item id")})))(r,t,s).then((e=>{y(!1),u({id:l,config:e})}),(e=>{p((null==a?void 0:a.customLayoutItem)||null),y(!1)}))},new((i=void 0)||(i=Promise))((function(e,l){function a(e){try{s(n.next(e))}catch(e){l(e)}}function r(e){try{s(n.throw(e))}catch(e){l(e)}}function s(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(a,r)}s((n=n.apply(t,o||[])).next())}));var t,o,i,n},x=()=>{let e=a.set("reportTypes",w.CustomReport);p((null==r?void 0:r.defaultCustomReportItem)||null),e=e.set("customReportItem",null).set("reportOptions",null);const t=K(r,s,null==e?void 0:e.asMutable({deep:!0}));u({id:l,config:t})},T=()=>{var e;let t=a.set("reportTypes",w.ServiceReport),o=null;const i=(null==r?void 0:r.defaultReportTemplate)||"";(null==r?void 0:r.defaultReportTemplate)&&(null===(e=null==r?void 0:r.reportTemplateChoiceList)||void 0===e||e.forEach((e=>{e.reportTemplate===(null==r?void 0:r.defaultReportTemplate)&&(o=e.reportOptions)}))),t=t.set("report",i).set("reportOptions",o);const n=K(r,s,null==t?void 0:t.asMutable({deep:!0}));u({id:l,config:n})},O=e=>{const o=function(e){if(!e)return!1;const o=t.DataSourceManager.getInstance().getDataSource(e.id);return o&&o.supportSpatialInfo&&!o.supportSpatialInfo()}(e);if(o)return!0;const l=t.DataSourceManager.getInstance();let i=!1;const n=e=>{var t,o,l;i||("MAP_SERVICE"===(null===(t=null==e?void 0:e.parentDataSource)||void 0===t?void 0:t.type)?i=!0:(null===(o=null==e?void 0:e.parentDataSource)||void 0===o?void 0:o.parentDataSource)&&n(null===(l=null==e?void 0:e.parentDataSource)||void 0===l?void 0:l.parentDataSource))},a=l.getDataSource(e.id);return n(a),i},N=t.hooks.useEventCallback((()=>!(null==a?void 0:a.reportOptions)||J(null==a?void 0:a.reportOptions)===S.RPTX)),k=t.hooks.useEventCallback((()=>{const e=(null==r?void 0:r.supportReport)&&(null==r?void 0:r.defaultReportTemplate)&&!(null==r?void 0:r.supportCustomReport),t=(null==a?void 0:a.reportTypes)===w.CustomReport&&!(null==a?void 0:a.customReportItem);return(e&&t||!N())&&!g}));return(0,t.jsx)("div",{className:"custom-layout-setting-con mt-2",css:tt},(0,t.jsx)(n.SettingRow,{flow:"wrap",label:(0,t.jsx)("div",{className:"d-flex align-items-center"},(0,t.jsx)("div",{className:"mr-1"},o("report")),(0,t.jsx)(i.Tooltip,{title:o("reportRemind"),showArrow:!0,placement:"left"},(0,t.jsx)(i.Button,{className:"report-temp-tip-button",type:"tertiary","aria-label":o("reportRemind")},(0,t.jsx)(Je,{size:"s"}))))}),(()=>{var e;const p=r.supportCustomReport,m=!(null==a?void 0:a.reportTypes)||(null==a?void 0:a.reportTypes)===w.ServiceReport||!p,v=se(null===(e=null==r?void 0:r.reportTemplateChoiceList)||void 0===e?void 0:e.asMutable({deep:!0}),!(null==r?void 0:r.defaultReportTemplate)),h=p&&!(null==r?void 0:r.defaultCustomReportItem);return(0,t.jsx)("div",{role:"group","aria-label":o("report")},h&&(0,t.jsx)(n.SettingRow,null,(0,t.jsx)("div",{className:"d-flex radio-con align-items-center",title:o("useServiceReport"),onClick:T},(0,t.jsx)(i.Radio,{className:"mr-1",checked:m,title:o("useServiceReport")}),(0,t.jsx)("span",null,o("useServiceReport")))),h&&(0,t.jsx)(n.SettingRow,null,(0,t.jsx)("div",{className:"d-flex radio-con align-items-center",title:o("useCustomReport"),onClick:x},(0,t.jsx)(i.Radio,{checked:(null==a?void 0:a.reportTypes)===w.CustomReport,className:"mr-1",title:o("useCustomReport")}),(0,t.jsx)("span",null,o("useCustomReport")))),m&&(0,t.jsx)(n.SettingRow,null,(0,t.jsx)(i.Select,{value:(null==a?void 0:a.report)||"None",onChange:(e,t)=>{((e,t)=>{var o,i;const n=t.key;let c=!1;r.supportCustomReport&&(null==a?void 0:a.reportTypes)===w.CustomReport?c=!r.defaultCustomReportItem:r.supportReport&&(null==a?void 0:a.reportTypes)===w.ServiceReport&&(c=!r.defaultReportTemplate);const p=se(null===(o=null==r?void 0:r.reportTemplateChoiceList)||void 0===o?void 0:o.asMutable({deep:!0}),c);let d=null;"None"===p[n].reportTemplate&&c&&0===Number(n)?e="":d=(null===(i=p[n])||void 0===i?void 0:i.reportOptions)||null;const m=a.set("reportOptions",d).set("report",e),v=K(r,s,null==m?void 0:m.asMutable({deep:!0}));u({id:l,config:v})})(e.target.value,t)},size:"sm",disabled:(null==r?void 0:r.printTemplateType)===f.OrganizationTemplate,"aria-label":o("report")},null==v?void 0:v.map(((e,o)=>(0,t.jsx)(i.Option,{key:o,value:null==e?void 0:e.reportTemplate,title:null==e?void 0:e.reportTemplate},null==e?void 0:e.reportTemplate))))),(null==a?void 0:a.reportTypes)===w.CustomReport&&r.supportCustomReport&&(0,t.jsx)(n.SettingRow,null,(0,t.jsx)(Ge,{portalUrl:d,activeItem:c,itemtype:"Pro Report",excludeType:"Pro Report Template",size:"sm",placeholder:o("selectReportItemPlaceholder"),onChange:b})),g&&(0,t.jsx)(Ye,{className:"mt-2",text:o("checkingReport")}),k()&&(0,t.jsx)("div",{className:"warning-alert-con"},(0,t.jsx)(i.Alert,{type:"warning",text:o("notSupportReport"),withIcon:!0})))})(),(()=>{const e=N();return!g&&e})()&&(()=>{var e,o;const i=(null===(e=null==a?void 0:a.reportOptions)||void 0===e?void 0:e.reportSectionOverrides)||(0,t.Immutable)({});if(0!==(null===(o=Object.keys(i))||void 0===o?void 0:o.length))return(0,t.jsx)("div",{className:"mt-3"},Object.keys(i).map(((e,o)=>{const c=i[e];return(0,t.jsx)(n.SettingRow,{label:e,flow:"wrap",key:o},(0,t.jsx)(_e.DataSourceSelector,{types:(0,t.Immutable)([t.AllDataSourceTypes.FeatureLayer]),useDataSources:null==c?void 0:c.exbDatasource,mustUseDataSource:!0,onChange:o=>{((e,o)=>{var i;const n=function(e){var o,l,i;return null!==(i=null===(l=null===(o=t.DataSourceManager.getInstance().getDataSource(e))||void 0===o?void 0:o.getDataSourceJson())||void 0===l?void 0:l.isOutputFromWidget)&&void 0!==i&&i}(null===(i=e[0])||void 0===i?void 0:i.dataSourceId),c=a.setIn(["reportOptions","reportSectionOverrides",o,"exbDatasource"],e).setIn(["reportOptions","reportSectionOverrides",o,"isDsOutputDs"],n),p=K(r,s,null==c?void 0:c.asMutable({deep:!0}));u({id:l,config:p})})(o,e)},widgetId:l,closeDataSourceListOnChange:!0,"aria-describedby":"list-empty-tip",hideDataView:!0,hideDs:O}))})))})())};var lt=v(79964),it=v.n(lt);const nt=e=>{const o=window.SVG,{className:l}=e,i=function(e,t){var o={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(o[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(l=Object.getOwnPropertySymbols(e);i<l.length;i++)t.indexOf(l[i])<0&&Object.prototype.propertyIsEnumerable.call(e,l[i])&&(o[l[i]]=e[l[i]])}return o}(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",l);return o?t.React.createElement(o,Object.assign({className:n,src:it()},i)):t.React.createElement("svg",Object.assign({className:n},i))};const{useEffect:at,useState:rt,useRef:st}=t.React,ut=v(59216);var ct;!function(e){e.MapSize="MAP SIZE",e.Author="AUTHOR",e.Copyright="COPYRIGHT",e.Legend="LEGEND",e.ScaleBarUnit="SCALE BAR UNIT",e.AttributionVisible="ATTRIBUTION VISIBLE",e.CustomTextElements="CUSTOM TEXZT ELEMENTS",e.NorthArrow="NORTH ARROW"}(ct||(ct={}));const pt=e=>{var o,l,a,r,s;const u=t.hooks.useTranslation(I,i.defaultMessages,t.defaultMessages),{id:c,isOpen:p,trigger:d,popperFocusNode:m,config:v,activeTemplateId:g,jimuMapView:y,toggle:b,handelTemplateListChange:x,onSettingChange:S}=e,w=st(null),C=st(null),j=st(null);at((()=>{de()}),[v,g]);const[R,O]=rt(null),[N,k]=rt(null),[M,P]=rt(null),[L,A]=rt((null==R?void 0:R.label)||""),[E,z]=rt(null===(o=null==R?void 0:R.exportOptions)||void 0===o?void 0:o.width),[D,U]=rt(null===(l=null==R?void 0:R.exportOptions)||void 0===l?void 0:l.height),[$,F]=rt((null===(a=null==R?void 0:R.layoutOptions)||void 0===a?void 0:a.authorText)||""),[Z,H]=rt((null===(r=null==R?void 0:R.layoutOptions)||void 0===r?void 0:r.copyrightText)||""),[W,J]=rt(null),[K,X]=rt(null===(s=null==R?void 0:R.layoutOptions)||void 0===s?void 0:s.customTextElements),[ee,te]=rt(null),[oe,le]=rt(!1),[ie,ne]=rt(null),[ae,se]=rt(!1);at((()=>(Oe(w.current),C.current=null,"number"==typeof N&&(w.current=N),()=>{Oe(w.current)})),[N]),at((()=>{var e,t,o,l,i,n;ne(Q(null===(e=null==R?void 0:R.layoutOptions)||void 0===e?void 0:e.elementOverrides)),A((null==R?void 0:R.label)||""),z(null===(t=null==R?void 0:R.exportOptions)||void 0===t?void 0:t.width),U(null===(o=null==R?void 0:R.exportOptions)||void 0===o?void 0:o.height),F((null===(l=null==R?void 0:R.layoutOptions)||void 0===l?void 0:l.authorText)||""),H((null===(i=null==R?void 0:R.layoutOptions)||void 0===i?void 0:i.copyrightText)||""),X(null===(n=null==R?void 0:R.layoutOptions)||void 0===n?void 0:n.customTextElements),ue(R)}),[R]),at((()=>{pe()}),[]),at((()=>{ce()&&pe()}),[K]);const ue=e=>{const{defaultCustomReportItem:t,defaultReportTemplate:o,supportCustomReport:l,supportReport:i}=v;if(e&&Y({defaultCustomReportItem:t,defaultReportTemplate:o,supportCustomReport:l,supportReport:i,reportOptions:null==e?void 0:e.reportOptions,reportTypes:null==e?void 0:e.reportTypes})){const t={reportOptions:null==e?void 0:e.reportOptions,reportTypes:null==e?void 0:e.reportTypes,customReportItem:null==e?void 0:e.customReportItem,report:null==e?void 0:e.report,templateIndex:N,templateId:e.templateId};C.current=t}},ce=()=>{if(!K)return!1;if((null==K?void 0:K.length)!==(null==ee?void 0:ee.length))return!0;{let e=!1;return null==K||K.forEach(((t,o)=>{for(const l in t)Object.prototype.hasOwnProperty.call(ee[o],l)||(e=!0)})),e}},pe=()=>{const e=null==K?void 0:K.map(((e,t)=>{const o={};for(const t in e)o[t]=!1;return o}));te((0,t.Immutable)(e||[]))},de=()=>{const e=G(null==v?void 0:v.printServiceType,null==v?void 0:v.printTemplateType)?null==v?void 0:v.printCustomTemplate:null==v?void 0:v.printOrgTemplate,t=q(null==e?void 0:e.asMutable({deep:!0}),g);k(t),P(e),O((null==e?void 0:e[t])||null),j.current=e},me=(e,t)=>{const o=R.setIn(e,t),l=null==M?void 0:M.asMutable({deep:!0});l[N]=null==o?void 0:o.asMutable({deep:!0}),x(l)},ve=e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;F(o)},ge=e=>{me(["layoutOptions","authorText"],e)},he=e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;H(o)},ye=e=>{me(["layoutOptions","copyrightText"],e)},fe=e=>{xe(),J(e)},be=()=>{xe(),J(null)},xe=()=>{const e=null==ee?void 0:ee.map((e=>{const t={};for(const o in e)t[o]=!1;return t}));te(e)},Te=e=>{const t=e.target.value;me(["layoutOptions","scalebarUnit"],t)},Se=e=>{me([e],!(null==R?void 0:R[e]))},we=()=>{const e=!(null==R?void 0:R.overrideCommonSetting);if(e){let t=R.setIn(["overrideCommonSetting"],e);t=B(t,null==v?void 0:v.commonSetting);const o=null==M?void 0:M.asMutable({deep:!0});o[N]=null==t?void 0:t.asMutable({deep:!0}),x(o)}else me(["overrideCommonSetting"],e)},Ie=e=>{return t=void 0,o=void 0,i=function*(){const e=Ce()?null:yield _(y);me(["layoutOptions","legendLayers"],e)},new((l=void 0)||(l=Promise))((function(e,n){function a(e){try{s(i.next(e))}catch(e){n(e)}}function r(e){try{s(i.throw(e))}catch(e){n(e)}}function s(t){var o;t.done?e(t.value):(o=t.value,o instanceof l?o:new l((function(e){e(o)}))).then(a,r)}s((i=i.apply(t,o||[])).next())}));var t,o,l,i},Ce=()=>{var e;return!!(null===(e=null==R?void 0:R.layoutOptions)||void 0===e?void 0:e.legendLayers)},je=(e,t)=>{const o=null==ee?void 0:ee.map(((o,l)=>{const i={};for(const n in o)i[n]=t===l&&n===e&&!ee[t][e];return i}));J(null),te(o)},Oe=e=>{var t;const o="number"==typeof e?e:N,l=null===(t=j.current)||void 0===t?void 0:t.asMutable({deep:!0});let i=null==l?void 0:l[o];if(!i)return;let n=!1;const a=Ne(i);a.isTemplateChange&&(n=!0,i=a.newTemplateItem);const r=ke(i);r.isTemplateChange&&(n=!0,i=r.newTemplateItem),n&&(l[o]=i,x(l))},Ne=e=>{var t,o;if(!e)return{isTemplateChange:!1};let l=!1;return(null==e?void 0:e.layoutTypes)!==T.CustomLayout||(null===(t=e.customLayoutItem)||void 0===t?void 0:t.id)||(e=re(e,e.layout,null===(o=null==v?void 0:v.layoutChoiceList)||void 0===o?void 0:o.asMutable({deep:!0})),l=!0),{isTemplateChange:l,newTemplateItem:e}},ke=t.hooks.useEventCallback((e=>{var o;if(!e)return{isTemplateChange:!1};const{defaultCustomReportItem:l,defaultReportTemplate:i,supportCustomReport:n,supportReport:a}=v;let r=!1,s=(0,t.Immutable)(e);if(!Y({defaultCustomReportItem:l,defaultReportTemplate:i,supportCustomReport:n,supportReport:a,reportOptions:null==e?void 0:e.reportOptions,reportTypes:null==e?void 0:e.reportTypes})&&C.current&&(null===(o=C.current)||void 0===o?void 0:o.templateId)===e.templateId){const{reportOptions:e,reportTypes:t,customReportItem:o,report:l}=C.current;s=s.set("reportOptions",e).set("reportTypes",t).set("customReportItem",o).set("report",l).set("report",l),r=!0}return{isTemplateChange:r,newTemplateItem:null==s?void 0:s.asMutable({deep:!0})}})),Me=(e,t)=>{var o,l;const i=null===(o=null==R?void 0:R.customTextElementEnableList)||void 0===o?void 0:o[t],n=i.set(e,!(null==i?void 0:i[e])),a=null===(l=null==R?void 0:R.customTextElementEnableList)||void 0===l?void 0:l.asMutable({deep:!0});a.splice(t,1,n),me(["customTextElementEnableList"],a)},Pe=(e,t,o)=>{const l=K[e].set(t,o),i=null==K?void 0:K.asMutable({deep:!0});i.splice(e,1,l),me(["layoutOptions","customTextElements"],i)},Le=(e,o,l)=>{var i;const n=null===(i=null==l?void 0:l.target)||void 0===i?void 0:i.value,a=K[e].set(o,n),r=null==K?void 0:K.asMutable({deep:!0});r.splice(e,1,a),X((0,t.Immutable)(r))},Ae=()=>{var e,t,o;const l=null===(o=null===(t=null===(e=null==R?void 0:R.layoutOptions)||void 0===e?void 0:e.elementOverrides)||void 0===t?void 0:t[ie])||void 0===o?void 0:o.visible;me(["layoutOptions","elementOverrides",ie,"visible"],!l)},Ee=()=>{le(!oe)},ze=t.css`
    .remind-con {
      padding-left: ${t.polished.rem(25)};
      color: var(--dark-800);
      margin-bottom: ${t.polished.rem(60)};
      margin-top: ${t.polished.rem(19)};
      font-size: ${t.polished.rem(13)};
    }
    .modal-body {
      padding: ${t.polished.rem(30)} ${t.polished.rem(30)} 0 ${t.polished.rem(30)};
    }
    .modal-footer {
      padding: 0 ${t.polished.rem(30)} ${t.polished.rem(30)} ${t.polished.rem(30)};
    }
    .remind-title {
      font-size: ${t.polished.rem(16)};
      font-weight: 500;
    }
  `,De=t.css`
    & {
      overflow: auto;
    }
    .text-wrap {
      overflow: hidden;
      white-space: pre-wrap;
    }
    .map-size-input {
      width: ${t.polished.rem(80)};
    }
    .setting-collapse {
      & {
        margin-bottom: ${t.polished.rem(8)};
      }
      .collapse-header {
        line-height: 2.2;
        padding-left: ${t.polished.rem(8)} !important;
        padding-right: ${t.polished.rem(8)} !important;
      }
    }
    .check-box-con {
      color: var(--dark-400);
      font-size: ${t.polished.rem(14)};
      line-height: ${t.polished.rem(22)};
      margin: ${t.polished.rem(4)} 0 ${t.polished.rem(8)} 0;
    }
    .layout-loading-con {
      left: 0;
      height: ${t.polished.rem(100)};
    }
  `,Ue=t.hooks.useEventCallback(((e,t)=>{var o;const l=!(null==t?void 0:t.layoutTypes)||(null==t?void 0:t.layoutTypes)===T.ServiceLayout;return!(e||!l&&!(null===(o=t.customLayoutItem)||void 0===o?void 0:o.id))}));return(0,t.jsx)(n.SidePopper,{isOpen:p,position:"right",toggle:b,trigger:d,title:u("templateConfiguration"),backToFocusNode:m},(0,t.jsx)("div",{className:"w-100 h-100",css:De},(0,t.jsx)(n.SettingSection,null,(0,t.jsx)(n.SettingRow,{flow:"wrap",label:u("templateName")},(0,t.jsx)(i.TextInput,{size:"sm",className:"w-100",value:L,onAcceptValue:e=>{if(!e)return A(null==R?void 0:R.label),!1;me(["label"],e)},onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;A(o)},"aria-label":u("templateName"),disabled:(null==v?void 0:v.printTemplateType)===f.OrganizationTemplate})),(0,t.jsx)(n.SettingRow,{flow:"wrap",label:u("fileFormat"),role:"group","aria-label":u("fileFormat")},(0,t.jsx)(i.MultiSelect,{fluid:!0,"aria-label":u("fileFormat"),items:(0,t.Immutable)(null==v?void 0:v.formatList.map(((e,t)=>({value:e,label:e})))),onClickItem:(e,t,o)=>{if(0===(null==o?void 0:o.length))return!1;let l=R.set("selectedFormatList",o);(null==o?void 0:o.includes(l.format))||(l=l.set("format",o[0]));const i=null==M?void 0:M.asMutable({deep:!0});i[N]=null==l?void 0:l.asMutable({deep:!0}),x(i)},values:(0,t.Immutable)((null==R?void 0:R.selectedFormatList)||[]),size:"sm"})),(0,t.jsx)(He,{id:c,config:v,template:R,templateIndex:N,handleLayoutChange:(e,t)=>{var o;const l="number"==typeof t?t:N,i=re(null==R?void 0:R.asMutable({deep:!0}),e,null===(o=null==v?void 0:v.layoutChoiceList)||void 0===o?void 0:o.asMutable({deep:!0})),n=null==M?void 0:M.asMutable({deep:!0});n[l]=i,x(n)},onSettingChange:S,toggleLoading:(e=!1)=>{se(e)}}),((null==v?void 0:v.supportCustomReport)||(null==v?void 0:v.supportReport))&&(0,t.jsx)(ot,{id:c,config:v,template:R,templateIndex:N,onSettingChange:S}),ae&&(0,t.jsx)("div",{className:"layout-loading-con position-absolute w-100"},(0,t.jsx)(i.Loading,null))),Ue(ae,R)&&(0,t.jsx)("div",null,V(null==R?void 0:R.layout)&&(0,t.jsx)(n.SettingSection,{title:u("MapOnlyOptions"),role:"group","aria-label":u("MapOnlyOptions")},(0,t.jsx)("div",{role:"group","aria-label":u("setDefaults")},(0,t.jsx)(n.SettingRow,{label:u("setDefaults"),flow:"wrap"}),(0,t.jsx)(i.CollapsablePanel,{label:u("mapSize"),isOpen:W===ct.MapSize,onRequestOpen:()=>{fe(ct.MapSize)},onRequestClose:be,role:"group","aria-label":u("mapSize"),rightIcon:ut,type:"primary",className:W===ct.MapSize&&"active-collapse"},(0,t.jsx)(n.SettingRow,{label:u("width"),className:"mt-2"},(0,t.jsx)(i.NumericInput,{className:"map-size-input",size:"sm",placeholder:u("width"),value:E||800,onAcceptValue:e=>{var t;if(!e||Number(e)<1)return z(null===(t=null==R?void 0:R.exportOptions)||void 0===t?void 0:t.width),!1;me(["exportOptions","width"],Number(e))},onChange:e=>{if(e<1)return!1;z(e)},showHandlers:!1,"aria-label":u("width")})),(0,t.jsx)(n.SettingRow,{label:u("height")},(0,t.jsx)(i.NumericInput,{className:"map-size-input",size:"sm",placeholder:u("height"),value:D||1100,onAcceptValue:e=>{var t;if(!e||Number(e)<1)return U(null===(t=null==R?void 0:R.exportOptions)||void 0===t?void 0:t.height),!1;me(["exportOptions","height"],Number(e))},onChange:e=>{U(e)},showHandlers:!1,"aria-label":u("height")}))),(0,t.jsx)(i.CollapsablePanel,{label:u("mapAttribution"),isOpen:W===ct.AttributionVisible,onRequestOpen:()=>{fe(ct.AttributionVisible)},onRequestClose:be,role:"group","aria-label":u("mapAttribution"),rightIcon:ut,type:"primary",className:W===ct.AttributionVisible&&"active-collapse"},(0,t.jsx)(n.SettingRow,{flow:"wrap",className:"mt-2"},(0,t.jsx)("div",{title:u("includeAttribution"),className:"d-flex w-100 align-items-center check-box-con",onClick:e=>{const t=!(null==R?void 0:R.attributionVisible);me(["attributionVisible"],t)}},(0,t.jsx)(i.Checkbox,{title:u("includeAttribution"),className:"lock-item-ratio","data-field":"mapSize",checked:!!(null==R?void 0:R.attributionVisible)||!1}),(0,t.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},u("includeAttribution")))))),v.modeType===h.Classic&&(0,t.jsx)(n.SettingRow,{className:"mt-2",flow:"wrap",role:"group","aria-label":u("selectEditableSettings"),label:u("selectEditableSettings")},(0,t.jsx)("div",{className:"w-100"},(0,t.jsx)("div",{title:u("printTitle"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{Se("enableMapSize")}},(0,t.jsx)(i.Checkbox,{title:u("printTitle"),className:"lock-item-ratio","data-field":"mapSize",checked:(null==R?void 0:R.enableMapSize)||!1}),(0,t.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},u("mapSize")))),(0,t.jsx)("div",{className:"w-100 mt-1"},(0,t.jsx)("div",{title:u("mapAttribution"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{Se("enableMapAttribution")}},(0,t.jsx)(i.Checkbox,{title:u("mapAttribution"),className:"lock-item-ratio","data-field":"mapSize",checked:(null==R?void 0:R.enableMapAttribution)||!1}),(0,t.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},u("mapAttribution")))))),!V(null==R?void 0:R.layout)&&(()=>{var e,o,l,a,r,s,c,p;return(0,t.jsx)(n.SettingSection,{title:u("LayoutOptions"),role:"group","aria-label":u("LayoutOptions")},(0,t.jsx)("div",{role:"group","aria-label":u("setDefaults")},(0,t.jsx)(n.SettingRow,{label:u("setDefaults"),flow:"wrap"}),(null==R?void 0:R.hasAuthorText)&&(0,t.jsx)(i.CollapsablePanel,{label:u("printTemplateAuthor"),isOpen:W===ct.Author,onRequestOpen:()=>{fe(ct.Author)},onRequestClose:be,role:"group","aria-label":u("printTemplateAuthor"),type:"primary",rightIcon:ut,className:"mb-2"},(0,t.jsx)(n.SettingRow,{flow:"wrap",className:"mt-2"},(0,t.jsx)(i.TextInput,{size:"sm",className:"w-100",value:$,onAcceptValue:ge,onChange:ve,"aria-label":u("printTemplateAuthor")}))),(null==R?void 0:R.hasCopyrightText)&&(0,t.jsx)(i.CollapsablePanel,{label:u("copyright"),isOpen:W===ct.Copyright,onRequestOpen:()=>{fe(ct.Copyright)},onRequestClose:be,role:"group","aria-label":u("copyright"),rightIcon:ut,type:"primary",className:"mb-2"},(0,t.jsx)(n.SettingRow,{flow:"wrap",className:"mt-2"},(0,t.jsx)(i.TextInput,{size:"sm",className:"w-100",value:Z,onAcceptValue:ye,onChange:he,"aria-label":u("copyright")}))),(null==R?void 0:R.hasLegend)&&(0,t.jsx)(i.CollapsablePanel,{label:u("legend"),isOpen:W===ct.Legend,onRequestOpen:()=>{fe(ct.Legend)},onRequestClose:be,role:"group",type:"primary","aria-label":u("legend"),rightIcon:ut,className:"mb-2"},(0,t.jsx)(n.SettingRow,{flow:"wrap",className:"mt-2"},(0,t.jsx)("div",{title:u("includeLegend"),className:"d-flex w-100 align-items-center check-box-con",onClick:Ie},(0,t.jsx)(i.Checkbox,{title:u("includeLegend"),className:"lock-item-ratio",checked:Ce()}),(0,t.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},u("includeLegend"))))),(0,t.jsx)(i.CollapsablePanel,{label:u("scaleBarUnit"),isOpen:W===ct.ScaleBarUnit,onRequestOpen:()=>{fe(ct.ScaleBarUnit)},onRequestClose:be,role:"group","aria-label":u("scaleBarUnit"),rightIcon:ut,type:"primary",className:W===ct.ScaleBarUnit&&"active-collapse"},(0,t.jsx)(n.SettingRow,{flow:"wrap",className:"mt-2"},(0,t.jsx)(i.Select,{value:null===(e=null==R?void 0:R.layoutOptions)||void 0===e?void 0:e.scalebarUnit,onChange:Te,size:"sm","aria-label":u("scaleBarUnit")},function(e){return[{value:"Miles",label:e("unitsLabelMiles")},{value:"Kilometers",label:e("unitsLabelKilometers")},{value:"Meters",label:e("unitsLabelMeters")},{value:"Feet",label:e("unitsLabelFeet")}]}(u).map(((e,o)=>(0,t.jsx)(i.Option,{key:`unit${o}`,value:e.value,title:e.label},e.label)))))),(null===(l=null===(o=null==R?void 0:R.layoutOptions)||void 0===o?void 0:o.customTextElements)||void 0===l?void 0:l.length)>0&&(()=>{const e=[];return null==K||K.forEach(((o,l)=>{var a;for(const r in o){const s=(0,t.jsx)(i.CollapsablePanel,{label:r,key:`${r}_${l}`,isOpen:(null===(a=null==ee?void 0:ee[l])||void 0===a?void 0:a[r])||!1,onRequestOpen:()=>{je(r,l)},onRequestClose:be,role:"group","aria-label":r,rightIcon:ut,type:"primary",className:ee[r]&&"active-collapse"},(0,t.jsx)(n.SettingRow,{flow:"wrap",className:"align-item-center mt-2"},(0,t.jsx)(i.TextInput,{size:"sm",className:"flex-grow-1",value:o[r]||"","aria-label":r,onAcceptValue:e=>{Pe(l,r,e)},onChange:e=>{Le(l,r,e)}})));e.push(s)}})),e})(),ie&&(0,t.jsx)(i.CollapsablePanel,{label:u("northArrow"),isOpen:W===ct.NorthArrow,onRequestOpen:()=>{fe(ct.NorthArrow)},onRequestClose:be,role:"group",type:"primary","aria-label":u("northArrow"),rightIcon:ut,className:"mb-2"},(0,t.jsx)(n.SettingRow,{flow:"wrap",className:"mt-2"},(0,t.jsx)("div",{title:u("includeNorthArrow"),className:"d-flex w-100 align-items-center check-box-con",onClick:Ae},(0,t.jsx)(i.Checkbox,{title:u("includeNorthArrow"),className:"lock-item-ratio",checked:null===(s=null===(r=null===(a=null==R?void 0:R.layoutOptions)||void 0===a?void 0:a.elementOverrides)||void 0===r?void 0:r[ie])||void 0===s?void 0:s.visible}),(0,t.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},u("includeNorthArrow")))))),v.modeType===h.Classic&&(0,t.jsx)(n.SettingRow,{className:"mt-2",flow:"wrap",role:"group","aria-label":u("selectEditableSettings"),label:u("selectEditableSettings")},(0,t.jsx)("div",{className:"w-100"},(null==R?void 0:R.hasAuthorText)&&(0,t.jsx)("div",{title:u("printTemplateAuthor"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{Se("enableAuthor")}},(0,t.jsx)(i.Checkbox,{title:u("printTemplateAuthor"),className:"lock-item-ratio",checked:(null==R?void 0:R.enableAuthor)||!1}),(0,t.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},u("printTemplateAuthor"))),(null==R?void 0:R.hasCopyrightText)&&(0,t.jsx)("div",{title:u("copyright"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{Se("enableCopyright")}},(0,t.jsx)(i.Checkbox,{title:u("copyright"),className:"lock-item-ratio",checked:(null==R?void 0:R.enableCopyright)||!1}),(0,t.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},u("copyright"))),(null==R?void 0:R.hasLegend)&&(0,t.jsx)("div",{title:u("legend"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{Se("enableLegend")}},(0,t.jsx)(i.Checkbox,{title:u("legend"),className:"lock-item-ratio",checked:(null==R?void 0:R.enableLegend)||!1}),(0,t.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},u("legend"))),(0,t.jsx)("div",{title:u("scaleBarUnit"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{Se("enableScalebarUnit")}},(0,t.jsx)(i.Checkbox,{title:u("scaleBarUnit"),className:"lock-item-ratio",checked:(null==R?void 0:R.enableScalebarUnit)||!1}),(0,t.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},u("scaleBarUnit"))),(null===(p=null===(c=null==R?void 0:R.layoutOptions)||void 0===c?void 0:c.customTextElements)||void 0===p?void 0:p.length)>0&&(()=>{const e=[];return null==K||K.forEach(((o,l)=>{var n,a;for(const r in o){const o=(0,t.jsx)("div",{key:`${r}_${l}`,title:r,className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{Me(r,l)}},(0,t.jsx)(i.Checkbox,{title:r,className:"lock-item-ratio",checked:(null===(a=null===(n=null==R?void 0:R.customTextElementEnableList)||void 0===n?void 0:n[l])||void 0===a?void 0:a[r])||!1}),(0,t.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},r));e.push(o)}})),e})(),ie&&(0,t.jsx)("div",{title:u("northArrow"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{Se("enableNorthArrow")}},(0,t.jsx)(i.Checkbox,{title:u("northArrow"),className:"lock-item-ratio",checked:(null==R?void 0:R.enableNorthArrow)||!1}),(0,t.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},u("northArrow"))))))})(),(0,t.jsx)(n.SettingSection,null,(0,t.jsx)(n.SettingRow,{className:"mb-4",label:u("overrideCommonSettings")},(0,t.jsx)(i.Switch,{"aria-label":u("overrideCommonSettings"),checked:(null==R?void 0:R.overrideCommonSetting)||!1,onChange:e=>{e.target.checked?we():Ee()}})),(null==R?void 0:R.overrideCommonSetting)&&(0,t.jsx)(Re,{id:c,printTemplateProperties:R,handleTemplatePropertyChange:e=>{const t=null==M?void 0:M.asMutable({deep:!0});t[N]=null==e?void 0:e.asMutable({deep:!0}),x(t)},modeType:null==v?void 0:v.modeType,jimuMapView:y}),(0,t.jsx)(i.AlertPopup,{isOpen:oe,toggle:Ee,hideHeader:!0,onClickOk:we,onClickClose:Ee,css:ze},(0,t.jsx)("div",{className:"align-middle pt-2 remind-title d-flex align-items-center"},(0,t.jsx)("div",{className:"mr-1"},(0,t.jsx)(nt,{className:"align-middle",size:"l",color:"var(--warning-600)"})),(0,t.jsx)("span",{className:"align-middle flex-grow-1"},u("overrideSettingsTitle"))),(0,t.jsx)("div",{className:"remind-con"},u("overrideSettingsRemind")))))))};var dt=v(52785);const{useState:mt,useEffect:vt,useRef:gt}=t.React,ht=[t.SupportedUtilityType.Printing],yt=e=>{const o=gt(!1),l=t.hooks.useTranslation(I,i.defaultMessages),{config:a,id:r,onSettingChange:s,toggleLoading:u,toggleRemindPopper:c}=e,[p,d]=mt(null==a?void 0:a.useUtility),m=t.css`
    &>div>div {
      padding-left: 0!important;
      padding-right: 0!important;
    }
    .utility-list {
      margin-bottom: 0 !important;
    }
  }`;vt((()=>{d(null==a?void 0:a.useUtility)}),[a]);const v=()=>{let e=a;e=e.set("useUtility",null),d(null),u(!1),s({id:r,config:e,useUtilities:[]})},g=e=>{return l=void 0,i=void 0,p=function*(){u(!0),((e,t)=>C(void 0,void 0,void 0,(function*(){return Z(e).then((o=>O(o,e,t)))})))(e,a).then((t=>{if(o.current)return!1;u(!1),s({id:r,config:t,useUtilities:e?[e]:[]})}),(o=>{!function(e,o,l){var i,n,a,r;const s=t.UtilityManager.getInstance().utilityHasSignInError(e);let u=404===(null===(i=null==l?void 0:l.details)||void 0===i?void 0:i.httpStatus);400===(null===(n=null==l?void 0:l.details)||void 0===n?void 0:n.httpStatus)&&(null===(r=null===(a=null==l?void 0:l.details)||void 0===a?void 0:a.message)||void 0===r?void 0:r.includes("Item does not exist"))&&(u=!0),s||u?t.UtilityManager.getInstance().reportUtilityState(e,!1,s):t.UtilityManager.getInstance().reportUtilityState(e,!0)}(null==e?void 0:e.utilityId,0,o),v(),u(!1),c(!0)}))},new((n=void 0)||(n=Promise))((function(e,t){function o(e){try{r(p.next(e))}catch(e){t(e)}}function a(e){try{r(p.throw(e))}catch(e){t(e)}}function r(t){var l;t.done?e(t.value):(l=t.value,l instanceof n?l:new n((function(e){e(l)}))).then(o,a)}r((p=p.apply(l,i||[])).next())}));var l,i,n,p};return(0,t.jsx)("div",{css:m},(0,t.jsx)(n.SettingRow,{flow:"wrap",label:l("printService"),role:"group","aria-label":l("printService")},(0,t.jsx)(dt.UtilitySelector,{useUtilities:(e=>{var o;if(!e)return(0,t.Immutable)([]);const l=null===(o=(0,t.getAppStore)().getState().appStateInBuilder.appConfig)||void 0===o?void 0:o.utilities;if(null==l?void 0:l[e.utilityId])return(0,t.Immutable)([e]);(0,t.Immutable)([])})(p),onChange:e=>{const t=e[0];d(t),t?(o.current=!1,g(t)):(o.current=!0,v())},showRemove:!0,closePopupOnSelect:!0,types:ht})))};const{useState:ft,useRef:bt}=t.React,xt=e=>{const o=bt(null),l=bt(null),{config:a,id:s,jimuMapView:u,showLoading:c,className:p,onSettingChange:m,handlePropertyChange:v,toggleRemindPopper:g,toggleLoading:h}=e,y=t.hooks.useTranslation(I,i.defaultMessages),b=t.css`
    .radio-con {
      cursor: pointer;
    }
    .loading-con {
      height: ${t.polished.rem(100)};
    }
  `,[x,S]=ft(null),[w,j]=ft(null),[R,O]=ft(!0),M=(e,t)=>{var l,i;if(e===x)S(null);else{const n=null===(i=null===(l=o.current)||void 0===l?void 0:l.getElementsByClassName("jimu-tree-item__body"))||void 0===i?void 0:i[t];S(e),n&&j(n)}},P=e=>{const t=G(null==a?void 0:a.printServiceType,null==a?void 0:a.printTemplateType);v(t?"printCustomTemplate":"printOrgTemplate",e)},L=()=>{O(!R)};return(0,t.jsx)(n.SettingSection,{className:p,css:b,role:"group","aria-label":y("configurePrintTemplate")},(0,t.jsx)(i.CollapsablePanel,{label:y("configurePrintTemplate"),isOpen:R,onRequestOpen:L,onRequestClose:L,"aria-label":y("configurePrintTemplate"),className:"custom-setting-collapse"},(0,t.jsx)(yt,{id:s,config:a,showLoading:c,onSettingChange:m,toggleLoading:h,toggleRemindPopper:g}),c&&(0,t.jsx)("div",{className:"loading-con position-relative"},(0,t.jsx)(i.Loading,{type:i.LoadingType.Secondary,width:38,height:38})),(null==a?void 0:a.useUtility)&&!c&&(0,t.jsx)("div",null,(null==a?void 0:a.printTemplateType)===f.Customize&&(0,t.jsx)(i.Button,{className:"w-100 mt-2",ref:l,type:"primary",onClick:()=>{return e=void 0,o=void 0,n=function*(){var e,o,i;let n=(null===(o=null===(e=null==a?void 0:a.printCustomTemplate)||void 0===e?void 0:e[0])||void 0===o?void 0:o.asMutable({deep:!0}))||{};const s=(null===(i=null==a?void 0:a.printCustomTemplate)||void 0===i?void 0:i.asMutable({deep:!0}))||[],u=ne(s,null==a?void 0:a.printServiceType,f.Customize);n=yield function(e,o,l){var i;return C(this,void 0,void 0,(function*(){let n=null===(i=B((0,t.Immutable)(o),(0,t.Immutable)(d)))||void 0===i?void 0:i.asMutable({deep:!0});n=yield function(e,t){return C(this,void 0,void 0,(function*(){const{layoutChoiceList:o,defaultCustomLayoutItem:l,defaultLayout:i,supportCustomLayout:n}=null==e?void 0:e.asMutable({deep:!0});let a={layoutTypes:T.ServiceLayout};if(n&&l){const o={defaultCustomLayoutItem:l,defaultLayout:i,supportCustomLayout:n};a=yield N(o,e.useUtility),t.customLayoutItem=(null==a?void 0:a.customLayoutItem)||null;const r=null==a?void 0:a.templateInfo;r&&(t.layoutOptions=null==r?void 0:r.layoutOptions,t.mapFrameUnit=null==r?void 0:r.pageUnits,t.mapFrameSize=null==r?void 0:r.webMapFrameSize)}else null==o||o.forEach(((e,o)=>{let l=!1;i?i===(null==e?void 0:e.layoutTemplate)&&(l=!0):0===o&&(l=!0),l&&(t=Object.assign(Object.assign({},t),e)),a.templateInfo={}}));return t.layoutTypes=null==a?void 0:a.layoutTypes,Promise.resolve(t)}))}(e,o),n=yield function(e,t){return C(this,void 0,void 0,(function*(){const{reportTemplateChoiceList:o,defaultCustomReportItem:l,defaultReportTemplate:i,supportReport:n,supportCustomReport:a}=null==e?void 0:e.asMutable({deep:!0}),r={defaultReportTemplate:i,supportCustomReport:a,defaultCustomReportItem:l,supportReport:n},s=yield k(o,r,e.useUtility);return s&&(t.reportTypes=null==s?void 0:s.reportTypes,t.customReportItem=(null==s?void 0:s.customReportItem)||null,t.report=(null==s?void 0:s.report)||null,t.reportOptions=(null==s?void 0:s.reportOptions)||null),Promise.resolve(t)}))}(e,n);const a=function(e){var t,o;let l=0,i=r;const n=(null==e?void 0:e.printTemplateType)===f.Customize?null===(t=e.printCustomTemplate)||void 0===t?void 0:t.asMutable({deep:!0}):null===(o=e.printOrgTemplate)||void 0===o?void 0:o.asMutable({deep:!0});return null==n||n.forEach((e=>{e.label===i&&(l+=1,i=`${r} ${l}`)})),i}(e);return n.format=e.defaultFormat,n.templateId=l,n.label=a,Promise.resolve(n)}))}(a,n,u),s.push(n),v("printCustomTemplate",s),j(l.current),S(u)},new((i=void 0)||(i=Promise))((function(t,l){function a(e){try{s(n.next(e))}catch(e){l(e)}}function r(e){try{s(n.throw(e))}catch(e){l(e)}}function s(e){var o;e.done?t(e.value):(o=e.value,o instanceof i?o:new i((function(e){e(o)}))).then(a,r)}s((n=n.apply(e,o||[])).next())}));var e,o,i,n}},(0,t.jsx)(fe,{className:"mr-1"}),y("newTemplate")),(0,t.jsx)("div",{ref:o},!c&&(0,t.jsx)(ge,{id:s,handelActiveTemplateIdChange:M,handelTemplateListChange:P,showNewTemplateItem:!1,activeTemplateId:x,config:a})),(0,t.jsx)(pt,{id:s,isOpen:x,config:a,activeTemplateId:x,toggle:()=>{M(null)},handelTemplateListChange:P,jimuMapView:u,trigger:o.current,popperFocusNode:w,onSettingChange:m}))))};var Tt=v(55505),St=v(41362);const wt=e=>{const o=(0,Oe.getTheme2)(),l=t.hooks.useTranslation(I,i.defaultMessages),{config:a,handlePropertyChange:r}=e,u=t.css`
    .outline-con {
      input {
        width: ${t.polished.rem(55)};
      }
    }
    .preview-style-setting-con {
      margin-top: ${t.polished.rem(16)};
    }
    .enable-preview-label {
      margin-right: ${t.polished.rem(10)};
    }
  `,c=()=>{r("enablePreview",!(null==a?void 0:a.enablePreview))};return(0,t.jsx)(n.SettingSection,{css:u,role:"group",title:(0,t.jsx)("div",{className:"d-flex align-items-center",onClick:c},(0,t.jsx)("div",{className:"flex-grow-1 enable-preview-label text-truncate w-100",title:l("enablePrintPreview")},l("enablePrintPreview")),(0,t.jsx)(i.Switch,{"aria-label":l("enablePrintPreview"),checked:null==a?void 0:a.enablePreview,onChange:c,title:l("enablePrintPreview")})),"aria-label":l("printPreviewStyle")},(null==a?void 0:a.enablePreview)&&(0,t.jsx)("div",{className:"preview-style-setting-con"},(0,t.jsx)(n.SettingRow,{label:l("fill"),"aria-label":l("fill")},(0,t.jsx)(St.ThemeColorPicker,{value:null==a?void 0:a.previewBackgroundColor,specificTheme:o,onChange:e=>{r("previewBackgroundColor",e)}})),(0,t.jsx)(n.SettingRow,{className:"outline-con",flow:"no-wrap",label:l("columnOutline"),"aria-label":l("columnOutline")},(0,t.jsx)(Tt.SizeColorSetting,{color:(null===(p=null==a?void 0:a.previewOutLine)||void 0===p?void 0:p.color)||s.color,size:(null===(d=null==a?void 0:a.previewOutLine)||void 0===d?void 0:d.size)||s.size,onChange:(e,o)=>{const l=null==o?void 0:o.includes("px"),i=function(e){const t=null==e?void 0:e.split("px")[0];return!(!e||!t)&&Number(t)>=0}(o);if(l&&!i)return;const n=(null==a?void 0:a.previewOutLine)||(0,t.Immutable)(s);r("previewOutLine",n.setIn([e],o))}}))));var p,d};var It=v(748),Ct=v.n(It);const jt=e=>{const o=window.SVG,{className:l}=e,i=function(e,t){var o={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(o[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(l=Object.getOwnPropertySymbols(e);i<l.length;i++)t.indexOf(l[i])<0&&Object.prototype.propertyIsEnumerable.call(e,l[i])&&(o[l[i]]=e[l[i]])}return o}(e,["className"]),n=(0,t.classNames)("jimu-icon jimu-icon-component",l);return o?t.React.createElement(o,Object.assign({className:n,src:Ct()},i)):t.React.createElement("svg",Object.assign({className:n},i))},Rt=()=>{const e=t.hooks.useTranslation(I,i.defaultMessages),o=t.css`
    & {
      & {
        color: var(--dark-200);
      }
      p {
        color: var(--dark-500);
        font-size: ${t.polished.rem(14)};
        margin: ${t.polished.rem(16)} auto 0;
        line-height: ${t.polished.rem(19)};
        width: ${t.polished.rem(228)};
      }
    }
  `;return(0,t.jsx)("div",{className:"w-100 mt-4 text-center utility-placeholder",css:o},(0,t.jsx)("div",{className:"text-center w-100"},(0,t.jsx)(jt,{size:48}),(0,t.jsx)("p",{className:"text-Secondary",id:"list-empty-tip",title:e("utilityPlaceholder")},e("utilityPlaceholder"))))},{useEffect:Ot,useRef:Nt}=t.React,kt={width:"360px",height:"460px"},Mt={width:"40px",height:"40px"},Pt=e=>{const{config:a,id:r,portalUrl:s,onSettingChange:u,useMapWidgetIds:c}=e,p=t.hooks.useTranslation(I,i.defaultMessages),d=Nt(null),m=t.ReactRedux.useSelector((e=>{var t,o;return null===(o=null===(t=null==e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.widgetsState[r])||void 0===o?void 0:o.layoutInfo})),g=t.ReactRedux.useSelector((e=>e.appStateInBuilder.appConfig)),[y,f]=t.React.useState(null),[b,x]=t.React.useState(!1),[T,S]=t.React.useState(!1),[w,C]=t.React.useState(!1),j=t.css`
    & .custom-setting-collapse>div.collapse-header {
      padding-left: 0 !important;
      padding-right: 0 !important;
    }
    .no-utility-setting {
      border-bottom: none;
    }
    .select-mode-con {
      &>div {
        flex: 1;
      }
      button {
        height: ${t.polished.rem(80)};
        background: var(--light-200);
        border: 2px solid transparent;
        &:not(:disabled):not(.disabled).active {
          border-color: var(--primary);
          background: var(--light-200);
        }
      }
      img {
        width: 100%;
        height: 100%;
        margin: 0 auto;
      }
    }
    .remind-con {
      top: ${t.polished.rem(90)};
    }
    .text-wrap {
      overflow: hidden;
      white-space: pre-wrap;
    }
    .setting-collapse {
      & {
        margin-bottom: ${t.polished.rem(8)};
      }
      .collapse-header {
        line-height: 2.2;
        padding-left: ${t.polished.rem(8)} !important;
        padding-right: ${t.polished.rem(8)} !important;
      }
      .handle{
        height: ${t.polished.rem(32)};
        background: var(--light-500);
        padding-left: ${t.polished.rem(8)};
        padding-right: ${t.polished.rem(8)};
      }
    }
  `,R=t.ReactRedux.useSelector((e=>e.appStateInBuilder.appConfig.utilities));Ot((()=>{O(R)}),[R]),Ot((()=>{N()}),[a]);const O=t.hooks.useEventCallback((e=>{var t,o;const l=null===(t=null==a?void 0:a.useUtility)||void 0===t?void 0:t.utilityId;l&&((null===(o=Object.keys(e||{}))||void 0===o?void 0:o.includes(l))||k("useUtility",null))})),N=()=>{var e,t;const o=null===(t=null===(e=null==g?void 0:g.widgets)||void 0===e?void 0:e[r])||void 0===t?void 0:t.style;if(!(null==a?void 0:a.hasInitBorder)&&!(null==o?void 0:o.border)){const e=(0,l.getAppConfigAction)(),t={color:"var(--light-800)",type:"solid",width:"1px"};let i;i=o?o.set("border",t):{border:t};const n=null==a?void 0:a.set("hasInitBorder",!0);e.editWidgetProperty(r,"style",i).editWidgetProperty(r,"config",n).exec()}},k=(e,t)=>{if((null==a?void 0:a[e])===t)return!1;const o=a.setIn([e],t);u({id:r,config:o})},M=(e=!1)=>{x(e),e&&(clearTimeout(d.current),d.current=setTimeout((()=>{x(!1)}),5e3))},P=e=>{var o;const i=a.setIn(["modeType"],e),n=(0,l.getAppConfigAction)();let s=kt;if(e===h.Compact&&(s=Mt),L()===t.LayoutType.FixedLayout){const{layoutId:e,layoutItemId:t}=m,l=g.layouts[e],a=(null===(o=null==l?void 0:l.content)||void 0===o?void 0:o[t]).bbox.set("width",s.width).set("height",s.height);n.editLayoutItemProperty(m,"bbox",a).editWidgetProperty(r,"config",i).exec()}else n.editWidgetProperty(r,"config",i).exec()},L=()=>{var e,t;const o=null==m?void 0:m.layoutId;return null===(t=null===(e=null==g?void 0:g.layouts)||void 0===e?void 0:e[o])||void 0===t?void 0:t.type},A=()=>{S(!T)};return(0,t.jsx)("div",{className:"widget-setting-search jimu-widget-search",css:j},(0,t.jsx)(n.SettingSection,{className:"map-selector-section",role:"group","aria-label":p("printSource"),title:p("printSource")},(0,t.jsx)(n.SettingRow,{flow:"wrap",label:p("selectMap"),role:"group","aria-label":p("selectMap")},(0,t.jsx)(n.MapWidgetSelector,{onSelect:e=>{u({id:r,useMapWidgetIds:e})},"aria-label":p("selectMap"),useMapWidgetIds:c})),(0,t.jsx)("div",{className:"fly-map"},(0,t.jsx)("div",null,(0,t.jsx)(o.JimuMapViewComponent,{useMapWidgetId:null==c?void 0:c[0],onActiveViewChange:e=>{null==e||"3d"===e.view.type?f(null):(null==e?void 0:e.id)!==(null==y?void 0:y.id)&&f(e)}})))),(0,t.jsx)(n.SettingSection,{className:"map-selector-section"},(0,t.jsx)(n.SettingRow,{flow:"wrap",label:p("printMode"),role:"group","aria-label":p("printMode")},(0,t.jsx)("div",{className:"d-flex w-100 select-mode-con"},(0,t.jsx)("div",{className:"flex-grow-1 text-truncate"},(0,t.jsx)(i.Button,{className:"w-100",title:p("printClassic"),active:(null==a?void 0:a.modeType)===h.Classic,onClick:()=>{P(h.Classic)}},(0,t.jsx)(i.Icon,{autoFlip:!0,icon:v(69797)})),(0,t.jsx)("div",{className:"mt-1 w-100 text-center text-truncate",title:p("printClassic")},p("printClassic"))),(0,t.jsx)("div",{className:"flex-grow-1 ml-2 text-truncate"},(0,t.jsx)(i.Button,{className:"w-100",active:(null==a?void 0:a.modeType)===h.Compact,title:p("printCompact"),onClick:()=>{P(h.Compact)}},(0,t.jsx)(i.Icon,{autoFlip:!0,icon:v(80941)})),(0,t.jsx)("div",{className:"mt-1 text-center text-truncate",title:p("printCompact")},p("printCompact")))))),(0,t.jsx)("div",{className:"w-100 position-absolute remind-con"},(0,t.jsx)(i.Alert,{withIcon:!0,form:"basic",type:"warning",open:b,closable:!0,className:"w-100",text:p("serviceIsNotAvailable"),onClose:()=>{M(!1)}})),(0,t.jsx)(xt,{id:r,config:a,portalUrl:s,handlePropertyChange:k,onSettingChange:u,jimuMapView:y,toggleRemindPopper:M,showLoading:w,toggleLoading:e=>{C(e)},className:!(null==a?void 0:a.useUtility)&&!w&&"no-utility-setting"}),(null==a?void 0:a.useUtility)&&(0,t.jsx)(n.SettingSection,{role:"group","aria-label":p("templateCommonSettings")},(0,t.jsx)(i.CollapsablePanel,{label:p("templateCommonSettings"),isOpen:T,onRequestOpen:A,onRequestClose:A,"aria-label":p("templateCommonSettings"),className:"custom-setting-collapse"},(0,t.jsx)(Re,{id:r,printTemplateProperties:null==a?void 0:a.commonSetting,handleTemplatePropertyChange:e=>{const t=a.set("commonSetting",e);u({id:r,config:t})},modeType:null==a?void 0:a.modeType,jimuMapView:y}))),(null==a?void 0:a.useUtility)&&(0,t.jsx)(wt,{config:a,handlePropertyChange:k}),!(null==a?void 0:a.useUtility)&&!w&&(0,t.jsx)(Rt,null))};function Lt(e){v.p=e}})(),g})())}}}));