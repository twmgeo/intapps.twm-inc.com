System.register(["jimu-core","jimu-layouts/layout-runtime","jimu-ui","jimu-arcgis","jimu-theme"],(function(e,t){var o={},n={},l={},r={},i={};return{setters:[function(e){o.AppMode=e.AppMode,o.BaseVersionManager=e.BaseVersionManager,o.ClauseLogic=e.ClauseLogic,o.ClauseOperator=e.ClauseOperator,o.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,o.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,o.DataSourceComponent=e.DataSourceComponent,o.DataSourceFilterChangeMessage=e.DataSourceFilterChangeMessage,o.DataSourceManager=e.DataSourceManager,o.DataSourceStatus=e.DataSourceStatus,o.Immutable=e.Immutable,o.JimuFieldType=e.JimuFieldType,o.MessageManager=e.MessageManager,o.React=e.React,o.ReactRedux=e.ReactRedux,o.RecordSetChangeType=e.RecordSetChangeType,o.UrlManager=e.UrlManager,o.UtilityManager=e.UtilityManager,o.WidgetState=e.WidgetState,o.classNames=e.classNames,o.css=e.css,o.dataSourceUtils=e.dataSourceUtils,o.defaultMessages=e.defaultMessages,o.esri=e.esri,o.getAppStore=e.getAppStore,o.hooks=e.hooks,o.i18n=e.i18n,o.jsx=e.jsx,o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,o.lodash=e.lodash,o.polished=e.polished,o.urlUtils=e.urlUtils,o.utils=e.utils},function(e){n.PageVisibilityContext=e.PageVisibilityContext,n.ViewVisibilityContext=e.ViewVisibilityContext},function(e){l.Alert=e.Alert,l.Button=e.Button,l.Checkbox=e.Checkbox,l.Dropdown=e.Dropdown,l.DropdownButton=e.DropdownButton,l.DropdownItem=e.DropdownItem,l.DropdownMenu=e.DropdownMenu,l.Icon=e.Icon,l.Link=e.Link,l.Popper=e.Popper,l.TextInput=e.TextInput,l.defaultMessages=e.defaultMessages},function(e){r.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){i.useTheme=e.useTheme}],execute:function(){e((()=>{var e={20864:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13 6.133c0 .598-.28 1.46-.825 2.51-.53 1.02-1.247 2.102-1.981 3.102A45.718 45.718 0 0 1 8 14.492a48.01 48.01 0 0 1-2.194-2.747c-.734-1-1.451-2.081-1.98-3.102C3.28 7.593 3 6.731 3 6.133 3 3.277 5.26 1 8 1s5 2.277 5 5.133m1 0c0 2.685-3.768 7.311-5.332 9.115C8.258 15.722 8 16 8 16s-.258-.279-.668-.751C5.768 13.444 2 8.817 2 6.133 2 2.746 4.686 0 8 0s6 2.746 6 6.133M10 5.5a2 2 0 1 1-4 0 2 2 0 0 1 4 0m1 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0" clip-rule="evenodd"></path></svg>'},59788:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .538.538 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.538.538 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},96009:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .538.538 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.538.538 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'},55339:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},30224:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},54357:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},79964:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},26826:e=>{"use strict";e.exports=r},48891:e=>{"use strict";e.exports=o},74758:e=>{"use strict";e.exports=n},34796:e=>{"use strict";e.exports=i},30726:e=>{"use strict";e.exports=l}},t={};function s(o){var n=t[o];if(void 0!==n)return n.exports;var l=t[o]={exports:{}};return e[o](l,l.exports,s),l.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var a={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(a),s.d(a,{__set_webpack_public_path__:()=>lt,default:()=>nt});var e=s(48891),t=s(74758);const o=[0,3];var n,l,r,i,u;!function(e){e.GeocodeService="GeocodeService",e.FeatureService="FeatureService"}(n||(n={})),function(e){e.ResultPanel="Result_Panel",e.OtherWidgets="Other_Widgets"}(l||(l={})),function(e){e.Style1="Style1",e.Style2="Style2",e.Style3="Style3"}(r||(r={})),function(e){e.Classic="Classic",e.Compact="Compact"}(i||(i={})),function(e){e.None="",e.Init="init",e.Loading="loading",e.Loaded="loaded",e.Warning="warning",e.Error="error"}(u||(u={}));var c=s(30726);const d={_widgetLabel:"Search",showResult:"Show search results for {searchText}",hideResult:"Hide search results for {searchText}",allSearchSources:"All search sources",noResult:'No results found for "{searchText}"',couldNotRetrieve:"Could not retrieve current location.",showMoreResult:"Show more results",clearAllHistories:"Clear all histories",clearHistorie:"Clear history",clearThisHistories:"Remove this history",clearRecentSearches:"Recent searches",searchIn:"Search in {value}",searchResults:"Search result"};var v=s(59788),g=s.n(v);const m=t=>{const o=window.SVG,{className:n}=t,l=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:g()},l)):e.React.createElement("svg",Object.assign({className:r},l))};var p=s(96009),h=s.n(p);const f=t=>{const o=window.SVG,{className:n}=t,l=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:h()},l)):e.React.createElement("svg",Object.assign({className:r},l))};var S=s(26826);const y="address";const b={alias:"ADDRESS",type:"string",name:y},I=(Object.assign(Object.assign({},b),{jimuName:y}),(e,t)=>H(null==t?void 0:t.outputDataSourceId)&&(null==t?void 0:t.isSupportSuggest)?x(t,e):Promise.resolve({})),x=(e,t)=>{var o;return C(null==e?void 0:e.geocodeURL,t,null==e?void 0:e.maxSuggestions,null===(o=null==e?void 0:e.useUtility)||void 0===o?void 0:o.utilityId).then((o=>{if(!Array.isArray(o))return Promise.resolve({suggestionItem:[],layer:null==e?void 0:e.label,icon:null==e?void 0:e.icon,err:o});let n=[];o.forEach(((o,l)=>{const r=o.text;if(r&&!function(e,t){return e.filter((e=>t===(null==e?void 0:e.suggestion))).length>0}(n,r)){const l={suggestionHtml:z(r,t),suggestion:r,configId:null==e?void 0:e.configId,magicKey:null==o?void 0:o.magicKey};n.push(l)}})),n=A(n,"suggestion");const l={suggestionItem:n.splice(0,e.maxSuggestions),layer:null==e?void 0:e.label,icon:null==e?void 0:e.icon};return Promise.resolve(l)})).catch((e=>Promise.reject(e)))},w=(t,o,n,l)=>{if(H(null==n?void 0:n.outputDataSourceId))return q($(n.outputDataSourceId),e.DataSourceStatus.NotReady),j({address:t,maxResultNumber:o,searchResultView:l,geocodeItem:n})},j=t=>{const{address:o,maxResultNumber:n,geocodeItem:l}=t,{outputDataSourceId:r,singleLineFieldName:i,defaultAddressFieldName:s}=l,a=$(r),u={geocodeItem:l,address:o,maxResultNumber:n,singleLineFieldName:i,addressFields:(null==l?void 0:l.addressFields)||[]};return R(u).then((t=>{return n=void 0,i=void 0,c=function*(){var n;if(!Array.isArray(t))return Promise.resolve(!1);const i=null==t?void 0:t.filter((e=>null==e?void 0:e.address));let u;const c=(null==i?void 0:i.map(((e,t)=>{const o=e.attributes;return o.address=e.address,s&&(o[s]=e.address),o.objectid=t,u=e.extent,{attributes:o,geometry:e.location}})))||[],d=null===(n=null==l?void 0:l.addressFields)||void 0===n?void 0:n.map((e=>({alias:e.alias,type:"string",name:e.jimuName}))),v=a;yield v.updateSourceByFeatures(c,d,"objectid",{id:`${r}_layer`,geometryType:"point",fullExtent:u});const g=o?e.DataSourceStatus.Unloaded:e.DataSourceStatus.NotReady;return q(a,g),Promise.resolve(e.DataSourceStatus.Unloaded)},new((u=void 0)||(u=Promise))((function(e,t){function o(e){try{r(c.next(e))}catch(e){t(e)}}function l(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){var n;t.done?e(t.value):(n=t.value,n instanceof u?n:new u((function(e){e(n)}))).then(o,l)}r((c=c.apply(n,i||[])).next())}));var n,i,u,c})).catch((e=>Promise.reject(e)))},R=t=>{const{geocodeItem:o,address:n,maxResultNumber:l,singleLineFieldName:r,addressFields:i}=t,{geocodeURL:s,magicKey:a,useUtility:u}=o;return(0,S.loadArcGISJSAPIModules)(["esri/rest/locator"]).then((t=>{var o;const[c]=t,d=r||"SingleLine";let v=(0,e.Immutable)({maxSuggestions:l});const g=null===(o=null==i?void 0:i.map((e=>null==e?void 0:e.jimuName)))||void 0===o?void 0:o.join(",");return g&&(v=v.set("outFields",g)),v=v.setIn([d],n),a&&(v=v.set("magicKey",a)),c.addressToLocations(s,{address:null==v?void 0:v.asMutable({deep:!0})},{query:{}}).then((e=>(e=(e=e.sort(((e,t)=>t.score-e.score))).filter((e=>e.location)),N(null==u?void 0:u.utilityId),e)),(e=>{console.error(e.message);const t=k(null==u?void 0:u.utilityId,e);return M(null==u?void 0:u.utilityId,e),t?e:[]}))}))},C=(e,t,o,n)=>(0,S.loadArcGISJSAPIModules)(["esri/rest/locator"]).then((l=>{const[r]=l;return r.suggestLocations(e,{text:t,maxSuggestions:o}).then((e=>(N(n),e||[])),(e=>{console.error(e.message);const t=k(n,e);return M(n,e),t?e:[]}))}));function N(t){e.UtilityManager.getInstance().reportUtilityState(t,!0)}function M(t,o){const n=k(t,o),l=e.UtilityManager.getInstance().utilityHasSignInError(t);n?e.UtilityManager.getInstance().reportUtilityState(t,!1,l):e.UtilityManager.getInstance().reportUtilityState(t,!1)}function k(t,o){var n,l,r,i;const s=e.UtilityManager.getInstance().utilityHasSignInError(t);let a=404===(null===(n=null==o?void 0:o.details)||void 0===n?void 0:n.httpStatus);return 400===(null===(l=null==o?void 0:o.details)||void 0===l?void 0:l.httpStatus)&&(null===(i=null===(r=null==o?void 0:o.details)||void 0===r?void 0:r.message)||void 0===i?void 0:i.includes("Item does not exist"))&&(a=!0),s||a}const D=(e,t,o,n=!1)=>{const l=null==e?void 0:e.outputDataSourceId,r=$(null==e?void 0:e.outputDataSourceId),i=null==r?void 0:r.getRecordsByPage(1,t);return Promise.resolve({records:i,configId:e.configId,dsId:l,isGeocodeRecords:!0,displayFields:null==e?void 0:e.displayFields})};var O=function(e,t,o,n){return new(o||(o=Promise))((function(l,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};function F(t,o,n){var l,r;return O(this,void 0,void 0,(function*(){const i=(null==o?void 0:o.datasourceConfig)||[];if(!H(null===(l=null==n?void 0:n.useDataSource)||void 0===l?void 0:l.dataSourceId))return Promise.resolve({});const s=(null==n?void 0:n.searchFields)||[],a=null===(r=null==i?void 0:i.filter((e=>(null==e?void 0:e.configId)===n.configId)))||void 0===r?void 0:r[0];return function(t,o,n,l,r){var i;return O(this,void 0,void 0,(function*(){const{label:s,icon:a,configId:u}=n,c=null===(i=null==o?void 0:o.useDataSource)||void 0===i?void 0:i.dataSourceId,d=$(c),v={searchText:t,searchFields:l.map((e=>e.name)),dataSource:d,maxSuggestions:r};return e.dataSourceUtils.querySuggestions(v).then((e=>{const t={suggestionItem:null==e?void 0:e.map((e=>Object.assign(Object.assign({},e),{configId:u,isFromSuggestion:!0}))),layer:s,icon:a};return Promise.resolve(t)})).catch((e=>Promise.resolve({suggestionItem:[],layer:null,icon:null})))}))}(t,n,a,s,null==o?void 0:o.maxSuggestions)}))}function T(t,o,n,l){if(o){const r=[];return o.forEach((o=>{let i=t;const s=null==n?void 0:n.getFieldCodedValueList(null==o?void 0:o.name);s&&(null==s||s.forEach((e=>{i===(null==e?void 0:e.label)&&(i=null==e?void 0:e.value)})));const a=(null==t?void 0:t.length)>0&&!isNaN(Number(i))&&isFinite(Number(i));if(o.type===e.JimuFieldType.Number&&!a)return!1;const u=function(t,o){let n;return t===e.JimuFieldType.Number?n=e.ClauseOperator.NumberOperatorIs:t===e.JimuFieldType.String&&(n=o?e.ClauseOperator.StringOperatorIs:e.ClauseOperator.StringOperatorContains),n}(o.type,l),c=o.type===e.JimuFieldType.Number?Number(i):i,d=e.dataSourceUtils.createSQLClause(null==o?void 0:o.name,u,[{value:c,label:c+""}]);r.push(d)})),e.dataSourceUtils.createSQLExpression(e.ClauseLogic.Or,r,n)}}function L(e,t,o){const n=(null==e?void 0:e.map((e=>e.jimuName)))||[],l=(null==t?void 0:t.map((e=>e.jimuName)))||[],r=$(o),i=(null==r?void 0:r.getAllUsedFields())||[];return"*"===i?"*":Array.from(new Set(n.concat(l).concat(i)))}const E=(t,o,n)=>{var l;const r=null===(l=null==t?void 0:t.useDataSource)||void 0===l?void 0:l.dataSourceId,i=W(t.configId,n);if(!H(r,i))return Promise.resolve({});const s=$(r,i),a=e.DataSourceManager.getInstance().getLocalDataSourceId(r,i),u=null==s?void 0:s.getRecordsByPage(1,o);return Promise.resolve({records:u,configId:t.configId,dsId:r,localDsId:a,isGeocodeRecords:!1})};const P=(e,t,o,n)=>{var l;const r=null===(l=null==e?void 0:e.useDataSource)||void 0===l?void 0:l.dataSourceId,i=W(o,t),s=$(r),a=$(r,i);a&&a.updateQueryParams({},i),n&&s&&s.updateQueryParams({},t)},U=(e,t,o,l=!1)=>{const r=[];for(const i in e){const s=e[i];let a;a=s.searchServiceType===n.FeatureService?E(s,t,o):D(s,t,0,l),r.push(a)}return Promise.all(r)},$=(t,o)=>{if(!t)return null;if(o){const n=e.DataSourceManager.getInstance(),l=n.getLocalDataSourceId(t,o);return n.getDataSource(l)}return e.DataSourceManager.getInstance().getDataSource(t)},A=(e,t)=>{const o=e[0]?[e[0]]:[];for(let n=1;n<e.length;n++){const l=e[n];let r=!1;for(let e=0;e<o.length;e++)if(l[t]===o[e][t]){r=!0;break}r||o.push(l)}return o},G=t=>{const o=e.urlUtils.getAppIdPageIdFromUrl().appId,n=B(o,t);let l=e.utils.readLocalStorage(n);return l&&(l=unescape(l)),l?null==l?void 0:l.split("/@/"):[]},B=(e,t)=>`exb-${e}-${t}_recent_searches`,_=(e,t)=>{var o,n,l;return null===(l=null===(n=null===(o=null==e?void 0:e.asMutable({deep:!0}))||void 0===o?void 0:o.datasourceConfig)||void 0===n?void 0:n.filter((e=>e.configId===t)))||void 0===l?void 0:l[0]},V=e=>{let t=0;for(const o in e)t++;return t};function z(e,t){if(!t)return e;const o=new RegExp(`(${J(t)})`,"gi"),n=new RegExp(`(${J(t)})`,"gi");return e.match(o)?e.replace(n,"<strong >$1</strong>"):e}function J(e){return e.replace(/[-[\]{}()*+!<=:?.\/\\^$|#\s,]/g,"\\$&")}function q(e,t){e.setStatus(t),e.setCountStatus(t)}function H(e,t){return!!e&&!!$(e,t)}const K=(t,o,n=e.RecordSetChangeType.CreateUpdate)=>{const l=[];null==o||o.forEach((e=>{var t;if(null==e?void 0:e.isGeocodeRecords){const o=$(e.dsId),n=null===(t=null==e?void 0:e.displayFields)||void 0===t?void 0:t.map((e=>e.jimuName)),r={records:e.records,fields:n,dataSource:o,name:o.id};l.push(r)}}));const r=new e.DataRecordSetChangeMessage(t,n,l);e.MessageManager.getInstance().publishMessage(r)},W=(e,t)=>`${t}_${e}_useDataSource`,Q=(t,o)=>{var l;let r=!0;for(const i in t){const s=t[i];let a;if(s.searchServiceType===n.FeatureService){const e=null===(l=null==s?void 0:s.useDataSource)||void 0===l?void 0:l.dataSourceId,t=W(s.configId,o);a=$(e,t)}else{const e=null==s?void 0:s.outputDataSourceId;a=$(e)}(null==a?void 0:a.getStatus())===e.DataSourceStatus.Loading&&(r=!1)}return r},X=t=>{var o,n;if(!t)return;const l=(0,e.getAppStore)().getState();return JSON.parse((null===(n=null===(o=null==l?void 0:l.urlHashObject)||void 0===o?void 0:o[t])||void 0===n?void 0:n.search_status)||"{}")},Y=(t,o)=>{if(!t)return;const n=o?JSON.stringify(o):null;e.UrlManager.getInstance().setWidgetUrlParams(t,{search_status:n})},{useRef:Z,useState:ee,useEffect:te}=e.React,oe=e.css`
& {
  box-sizing: border-box;
  width: ${e.polished.rem(32)};
}
.setting-dropdown-button {
  height: ${e.polished.rem(32)};
  border-radius: 0;
  svg {
    margin: 0 !important;
  }
}
&.ds-setting-Style1 {
  .setting-dropdown-button {
    border-radius: ${e.polished.rem(4)} 0 0 ${e.polished.rem(4)};
  }
}
&.ds-setting-Style2 {
  & {
    margin-right: ${e.polished.rem(4)};
  }
  .setting-dropdown-button {
    border-radius: 50%;
  }
}
&.ds-setting-Style3 {
  .setting-dropdown-button {
    background: none;
    border: none;
  }
}
`,ne=t=>{const o=e.hooks.useTranslation(d,c.defaultMessages),[l,r]=ee(!0),[i,s]=ee(!1),[a,u]=e.React.useState(!1),{className:v,datasourceConfig:g,dsStatus:p,config:h,id:S,useDataSources:y,onDatasourceConfigChange:b}=t,I=Z(null),x=Z(null),w=t=>{const o=[];null==t||t.forEach((e=>{e.enable&&o.push(e.configId)})),((t,o,n)=>{if(!t)return;const l=X(t)||{};l[o]=n,e.UrlManager.getInstance().setWidgetUrlParams(t,{search_status:JSON.stringify(l)})})(S,"serviceEnabledList",o)};return te((()=>{const e=null==g?void 0:g.filter((e=>!(null==e?void 0:e.enable))),t=0===(null==e?void 0:e.length),o=(null==e?void 0:e.length)>0&&(null==e?void 0:e.length)<(null==g?void 0:g.length);s(o),r(t)}),[g]),(0,e.jsx)("div",{className:`${v||""} ds-setting-${h.arrangementStyle}`,css:oe,role:"group","aria-label":o("searchIn",{value:""})},(0,e.jsx)(c.Dropdown,{className:"w-100 h-100",toggle:e=>{var t;const o=null==e?void 0:e.target;if(null===(t=null==I?void 0:I.current)||void 0===t?void 0:t.contains(o))return!1;((e,t)=>{if(!e)return!1;const o=null==e?void 0:e.getAttribute("z-index"),n=null==e?void 0:e.role,l=e&&e.tagName||"",r="button"===l.toLowerCase()||"button"===n,i="input"===l.toLowerCase()||"input"===n,s="a"===l.toLowerCase()||"linkClick"===t.exbEventType;return r||s||!!o&&o>-1||i})(o,e)&&a&&(clearTimeout(x.current),x.current=setTimeout((()=>{null==o||o.focus()}),200)),u(!a)},isOpen:a},(0,e.jsx)(c.DropdownButton,{className:"setting-dropdown-button",arrow:!1,icon:!0,title:o("searchIn",{value:""})},!a&&(0,e.jsx)(m,{size:16,className:"mr-1 d-inline-block",autoFlip:!0}),a&&(0,e.jsx)(f,{size:16,className:"mr-1 d-inline-block",autoFlip:!0})),(0,e.jsx)(c.DropdownMenu,{trapFocus:!1,autoFocus:!1,style:{maxHeight:"auto"}},(0,e.jsx)("div",{ref:I},(0,e.jsx)(c.DropdownItem,{onClick:()=>{const e=!l,t=null==g?void 0:g.map((t=>{var o;return null===(o=t.setIn(["enable"],e))||void 0===o?void 0:o.asMutable({deep:!0})}));w(t),b(t)},title:o("all")},(0,e.jsx)(c.Checkbox,{checked:l||i,indeterminate:i,className:"mr-2"}),o("all")),(0,e.jsx)(c.DropdownItem,{divider:!0}),null==g?void 0:g.map(((t,l)=>{var r;const i=p[t.configId]===e.DataSourceStatus.LoadError||p[t.configId]===e.DataSourceStatus.CreateError,s=t.searchServiceType===n.GeocodeService,a=((t,o=!1)=>{var n;let l;if(o){const o=(0,e.getAppStore)().getState().appConfig,r=null===(n=null==o?void 0:o.widgets)||void 0===n?void 0:n[S],i=(null==r?void 0:r.outputDataSources)||[];l=(null==i?void 0:i.filter((e=>t===e)).length)>0}else l=(null==y?void 0:y.filter((e=>t===e.dataSourceId)).length)>0;return l&&t})(s?t.outputDataSourceId:t.useDataSource.dataSourceId,s),u=1===(null===(r=null==g?void 0:g.filter((e=>null==e?void 0:e.enable)))||void 0===r?void 0:r.length)&&(null==t?void 0:t.enable)&&i;return(0,e.jsx)(c.DropdownItem,{key:`${null==t?void 0:t.label}${l}`,title:null==t?void 0:t.label,disabled:u,onClick:()=>{((e,t)=>{const o=null==g?void 0:g.setIn([t,"enable"],e);w(o),b(o)})(!(null==t?void 0:t.enable),l)}},(0,e.jsx)("div",{className:"d-flex w-100 h-100 align-items-center"},(0,e.jsx)("div",{className:"flex-grow-1 d-flex align-items-center"},(0,e.jsx)(c.Checkbox,{checked:null==t?void 0:t.enable,disabled:u,className:"mr-2"}),(0,e.jsx)("div",{className:"flex-grow-1"},null==t?void 0:t.label)),(i||!a)&&(0,e.jsx)(c.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:o("dataSourceCreateError")})))}))))))};var le=s(34796);const re=(t,o)=>{var n,l,r,i,s,a,u,c,d,v,g,m,p,h,f,S,y,b,I;return e.css`
    & {
      width: ${e.polished.rem(null===(n=null==o?void 0:o.current)||void 0===n?void 0:n.clientWidth)};
      padding-top: 0;
      padding-bottom: 0;
      /* visibility: unset !important; */
    }
    &.hide-popper {
      border: none;
      outline: none;
      box-shadow: none;
      width: 0;
    }
    button {
      width: 100%;
      border: none;
      text-align: left;
      min-height: ${e.polished.rem(32)};
      border-radius: 0;
    }
    .result-list-content {
      position: relative;
      overflow: auto;
    }
    &.suggestion-list-con, .result-list-content {
      max-height: ${e.polished.rem(300)};
    }
    &.suggestion-list-con {
      overflow: auto;
    }
    &.result-list-con button {
      text-overflow: ellipsis;
      white-space: pre-wrap;
      &:focus-visible {
        background: var(--light-100);
      }
    }
    &.result-list-con :disabled, &.result-list-con button:disabled:hover {
      color: ${null===(i=null===(r=null===(l=null==t?void 0:t.colors)||void 0===l?void 0:l.palette)||void 0===r?void 0:r.secondary)||void 0===i?void 0:i[800]};
      background-color: ${null===(u=null===(a=null===(s=null==t?void 0:t.colors)||void 0===s?void 0:s.palette)||void 0===a?void 0:a.light)||void 0===u?void 0:u[200]};
    }
    &.result-list-con button:hover {
      color: ${null===(c=null==t?void 0:t.colors)||void 0===c?void 0:c.black};
      background-color: ${null===(g=null===(v=null===(d=null==t?void 0:t.colors)||void 0===d?void 0:d.palette)||void 0===v?void 0:v.light)||void 0===g?void 0:g[100]};
    }
    &.result-list-con button:focus-visible {
      color: ${null===(m=null==t?void 0:t.colors)||void 0===m?void 0:m.black};
      background-color: ${null===(f=null===(h=null===(p=null==t?void 0:t.colors)||void 0===p?void 0:p.palette)||void 0===h?void 0:h.light)||void 0===f?void 0:f[100]};
    }
    &.result-list-con .dropdown-divider {
      margin-left: 0;
      margin-right: 0;
    }
    &.result-list-con button.active {
      background: ${null===(S=null==t?void 0:t.colors)||void 0===S?void 0:S.primary};
      color: ${null===(y=null==t?void 0:t.colors)||void 0===y?void 0:y.white};
    }
    .show-result-button:active, &.result-list-con .show-result-button:hover {
      background-color: ${null===(b=null==t?void 0:t.colors)||void 0===b?void 0:b.white};
    }
    &.result-list-con .show-result-button:focus-visible {
      background-color: ${null===(I=null==t?void 0:t.colors)||void 0===I?void 0:I.white};
    }
    .dropdown-menu--inner {
      max-height: none;
    }
    .jimu-dropdown-item {
      min-height: ${e.polished.rem(32)};
    }
    .clear-recent-search-con {
      color: var(--primary) !important;
      height: ${e.polished.rem(40)};
      margin-top: ${e.polished.rem(-4)};
    }
    .dropdown-divider {
      min-height: 0;
    }
    .item-p-l {
      padding-left: ${e.polished.rem(42)} !important;
    }
    .source-label-con {
      color: var(--black) !important;
      font-weight: bold !important;
    }
    .show-result-button-style2 {
      & {
        padding: 0;
        height: ${e.polished.rem(11)};
        min-height: ${e.polished.rem(11)};
        justify-content: center;
        align-items: center;
      }
      svg {
        margin-right: 0;
      }
    }
    &.result-list-con-compact-close {
      & {
        width: ${e.polished.rem(32)};
        border-top: 0;
        justify-content: center;
      }
      .show-result-button {
        & {
          border-radius: 0 0 0.25rem 0.25rem;
          padding: 0;
          height: ${e.polished.rem(8)};
          min-height: ${e.polished.rem(8)};
          justify-content: center;
          align-items: center;
        }
        svg {
          margin-right: 0;
          height: ${e.polished.rem(8)};
        }
      }
    }
    &.result-list-con-compact-open {
      .show-result-button-style2-con {
        position: -webkit-sticky;
        position: sticky;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--white);
      }
    }
  `},{useEffect:ie,useRef:se}=e.React,ae=t=>{const n=se(null),l=se(null),{children:r,isOpen:i,reference:s,searchInputRef:a,autoFocus:u,className:d,isFocusWidtSearchInput:v,id:g,offset:m,version:p,toggle:h}=t,f=(0,le.useTheme)(),S=e.ReactRedux.useSelector((e=>{var t;const o=null==e?void 0:e.widgetsRuntimeInfo;return null===(t=null==o?void 0:o[g])||void 0===t?void 0:t.state}));ie((()=>{var e;return(null==a?void 0:a.current)&&v&&(null===(e=a.current)||void 0===e||e.addEventListener("keydown",y,!0)),()=>{var e;v&&(null===(e=a.current)||void 0===e||e.removeEventListener("keydown",y,!0))}}),[]);const y=e.hooks.useEventCallback((e=>{if(!i)return!1;const t=x()||[],o=(null==t?void 0:t.length)-1;"ArrowUp"===e.key?l.current=setTimeout((()=>{t[o].focus()})):"ArrowDown"===e.key&&(l.current=setTimeout((()=>{t[0].focus()})))})),b=e.hooks.useEventCallback((e=>{if(!i)return;const t="button"===e.target.getAttribute("role");if(["Tab","ArrowUp","ArrowDown"].includes(e.key)&&((e.which>=48&&e.which<=90||"Tab"===e.key)&&e.preventDefault(),i&&t))if(clearTimeout(l.current),"Escape"===e.key)I(e);else if(["ArrowUp","ArrowDown"].includes(e.key)||["n","p"].includes(e.key)&&e.ctrlKey){const t=x();let o=t.indexOf(e.target),r=!1;"ArrowUp"===e.key||"p"===e.key&&e.ctrlKey?(o=0!==o?o-1:t.length-1,r=!0):("ArrowDown"===e.key||"n"===e.key&&e.ctrlKey)&&(r=!1,o=o===t.length-1?0:o+1);const i=0===o&&!r,s=o===t.length-1&&r;l.current=v&&(i||s)?setTimeout((()=>{var e;null===(e=a.current)||void 0===e||e.focus()})):setTimeout((()=>{Array.prototype.slice.call(n.current.querySelectorAll(".popper-box"))[0].focus(),t[o].focus()}))}else if("End"===e.key){const e=x();l.current=setTimeout((()=>{e[e.length-1].focus()}))}else if("Home"===e.key){const e=x();l.current=setTimeout((()=>{e[0].focus()}))}else if(e.which>=48&&e.which<=90){const t=x(),o=String.fromCharCode(e.which).toLowerCase();for(let e=0;e<t.length;e+=1)if((t[e].textContent&&t[e].textContent[0].toLowerCase())===o){l.current=setTimeout((()=>{t[e].focus()}));break}}})),I=e=>{var t;e.preventDefault(),w(e),null===(t=null==a?void 0:a.current)||void 0===t||t.focus()},x=()=>n?Array.prototype.slice.call(n.current.querySelectorAll('[role="button"]')).filter((e=>!e.disabled)):[],w=e=>{h(e)};return(0,e.jsx)("div",null,(0,e.jsx)(c.Popper,{autoFocus:u,placement:"bottom-start",open:i,toggle:w,css:re(f,s),reference:s,version:p,className:(0,e.classNames)("result-list-popper",d,{"hide-popper":S===e.WidgetState.Closed}),offset:m||o,popperNodeRef:n},(0,e.jsx)("div",{onKeyDown:b},r)))},{useState:ue,useRef:ce,useEffect:de}=e.React,ve=e.css`
  & .utility-err-remind-con {
    bottom: 0;
  }
`,ge=t=>{const o=e.hooks.useTranslation(c.defaultMessages,e.defaultMessages),l=ce(null),{serviceList:r,open:i,toggleUtilityErrorRemind:s}=t,[a,u]=ue(null),d=e.ReactRedux.useSelector((e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.utilityStates}));de((()=>{i&&(clearTimeout(l.current),l.current=setTimeout((()=>{s(!1)}),5e3))}),[i]),de((()=>{v(d)}),[d]);const v=e=>{var t;if(!r)return;let o=null,l=[],i=[];null===(t=Object.keys(r))||void 0===t||t.forEach((t=>{var o;const s=r[t];if(s.searchServiceType===n.GeocodeService){const t=null===(o=null==s?void 0:s.useUtility)||void 0===o?void 0:o.utilityId;if(t){const o=null==e?void 0:e[t];(null==o?void 0:o.isSignInError)?i.push(t):!1===(null==o?void 0:o.success)&&l.push(t)}}})),l=g(l),i=g(i),0===(null==l?void 0:l.length)&&(null==i?void 0:i.length)>0?o=m(i):0===(null==i?void 0:i.length)&&(null==l?void 0:l.length)>0?o=p(l):(null==i?void 0:i.length)>0&&(null==l?void 0:l.length)>0&&(o=`${m(i)} ${p(l)}`),u(o)},g=(t=[])=>(t=Array.from(new Set(t))).map((t=>{const o=e.UtilityManager.getInstance().getUtilityJson(t);return null==o?void 0:o.label})),m=e=>{let t=null;return 1===V(r)?(null==e?void 0:e.length)>0&&(t=o("signInErrorDefault")):(null==e?void 0:e.length)>0&&(t=o("signInErrorsDefault",{names:e.join(", ")})),t},p=e=>{let t=null;return 1===V(r)?1===(null==e?void 0:e.length)&&(t=o("utilityInaccessible")):(null==e?void 0:e.length)>0&&(t=o("utilityNotAvailableWidthName",{name:e.join(", ")})),t};return(0,e.jsx)("div",{className:"posotion-relative w-100",css:ve},(0,e.jsx)("div",{className:"position-absolute w-100 utility-err-remind-con"},(0,e.jsx)(c.Alert,{buttonType:"tertiary",className:"w-100",type:"warning",withIcon:!0,closable:!0,onClose:()=>{s(!1)},text:a,title:a})))},{useRef:me}=e.React,pe=new(0,e.esri.Sanitizer),he=t=>{const o=e.hooks.useTranslation(d,c.defaultMessages),{className:n,reference:l,searchSuggestion:r,isOpen:i,searchText:s,canUseOutoutDsLength:a,id:u,searchInputRef:v,openUtilityErrRemindInSuggestion:g,serviceList:m,toggleSuggestionUtilityError:p,toggel:h,onRecordItemClick:f,setSuggestionFirstItem:S}=t,y=(0,le.useTheme)(),b=me(!1),I=(e,t)=>{0!==e||b.current||(S(t),b.current=!0)};return(0,e.jsx)("div",null,(0,e.jsx)(ae,{isOpen:i,autoFocus:!1,reference:l,searchInputRef:v,isFocusWidtSearchInput:!0,toggle:h,id:u,className:(0,e.classNames)("result-list-con suggestion-list-con",n)},(()=>{let e=[];return r.forEach((t=>{const o=(null==t?void 0:t.suggestionItem)||[];e=e.concat(o)})),s&&0===e.length})()&&(0,e.jsx)(c.Button,{role:"button",className:"text-center py-2",disabled:!0,title:o("noResult",{searchText:s})},o("noResult",{searchText:s})),(b.current=null,null==r?void 0:r.map(((t,o)=>{var n,l,i;const s=(null==r?void 0:r.length)>1&&(null===(n=null==t?void 0:t.suggestionItem)||void 0===n?void 0:n.length)>0;return(0,e.jsx)("div",{key:`${null==t?void 0:t.layer}-${o}`,role:"group","aria-label":null==t?void 0:t.layer},s&&(0,e.jsx)(c.Button,{role:"button",className:"source-label-con jimu-outline-inside",disabled:!0,title:null==t?void 0:t.layer},(null==t?void 0:t.icon)&&(0,e.jsx)(c.Icon,{className:"mr-2",color:null===(l=null==y?void 0:y.colors)||void 0===l?void 0:l.primary,size:16,icon:null===(i=null==t?void 0:t.icon)||void 0===i?void 0:i.svg}),null==t?void 0:t.layer),((t,o=!1)=>{const n=null==t?void 0:t.suggestionItem,l=null==t?void 0:t.icon;return null==n?void 0:n.map(((n,r)=>{var i;const s=pe.sanitize(n.suggestionHtml),u={configId:null==n?void 0:n.configId,isFromSuggestion:null==n?void 0:n.isFromSuggestion,magicKey:null==n?void 0:n.magicKey};return(0,e.jsx)(c.Button,{className:(0,e.classNames)("d-flex align-items-center py-2 jimu-outline-inside",{"item-p-l":o}),key:`${null==t?void 0:t.layer}${r}`,title:n.suggestion,role:"button",onClick:()=>{((e,t)=>{const{configId:o,isFromSuggestion:n,magicKey:l}=t||{};o&&(n||l)?f(e,t):f(e)})(n.suggestion,u)},ref:e=>{I(r,e)}},l&&1===a&&(0,e.jsx)(c.Icon,{className:"mr-2",color:null===(i=null==y?void 0:y.colors)||void 0===i?void 0:i.primary,size:16,icon:null==l?void 0:l.svg}),(0,e.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:s}}))}))})(t,(()=>{if((null==r?void 0:r.length)<2)return!1;let e=0,t=0;return null==r||r.forEach((o=>{var n;const l=null==o?void 0:o.icon;l&&(e+=1),(null===(n=o.suggestionItem)||void 0===n?void 0:n.length)>0&&l&&(t+=1)})),t>0&&e>0})()))}))),g&&(0,e.jsx)(ge,{open:g,serviceList:m,toggleUtilityErrorRemind:p})))};var fe=s(54357),Se=s.n(fe);const ye=t=>{const o=window.SVG,{className:n}=t,l=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:Se()},l)):e.React.createElement("svg",Object.assign({className:r},l))};var be=s(20864),Ie=s.n(be);const xe=t=>{const o=window.SVG,{className:n}=t,l=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:Ie()},l)):e.React.createElement("svg",Object.assign({className:r},l))};var we=s(79964),je=s.n(we);const Re=t=>{const o=window.SVG,{className:n}=t,l=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:je()},l)):e.React.createElement("svg",Object.assign({className:r},l))},Ce=t=>{const o=e.hooks.useTranslation(d,c.defaultMessages),{serviceList:l,locationLoading:r,isGetLocationError:i,onLocationChange:s,handleLocationLoadingChange:a}=t,[u,v]=e.React.useState(null);e.React.useEffect((()=>{g()}),[l]);const g=()=>{var e;for(const t in l){const o=null===(e=l[t])||void 0===e?void 0:e.asMutable({deep:!0});if(o.searchServiceType===n.GeocodeService){v(o);break}}},m=e=>{a(!1);const t=`${e.coords.longitude},${e.coords.latitude}`;u?((e,t)=>t?(0,S.loadArcGISJSAPIModules)(["esri/rest/locator"]).then((o=>{const[n]=o;return(e=>{const t=e&&e.coords;return t?(0,S.loadArcGISJSAPIModules)(["esri/geometry/Point"]).then((e=>{const[o]=e;return new o({longitude:t.longitude,latitude:t.latitude,z:t.altitude||null,spatialReference:{wkid:4326}})})):Promise.resolve(null)})(t).then((t=>n.locationToAddress(e,{location:t},{query:{}}).then((e=>Promise.resolve(e.address)),(e=>(console.error(e.message),[])))))})):Promise.resolve(null))(null==u?void 0:u.geocodeURL,e).then((e=>{s(e)})):s(t)},p=e=>{a(!1),s(null,null,!0)};return(0,e.jsx)("div",null,!i&&(0,e.jsx)(c.Button,{role:"button",onClick:()=>{if(r)return!1;a(!0),((e,t)=>{if(navigator.geolocation){const o={enableHighAccuracy:!0,timeout:3e3,maximumAge:1e4};navigator.geolocation.getCurrentPosition(e,t,o)}else t&&t()})(m,p)},title:o("useCurrentLocation")},(0,e.jsx)(xe,{className:"mr-2"}),o("useCurrentLocation")),i&&(0,e.jsx)(c.Button,{role:"button",title:o("couldNotRetrieve")},(0,e.jsx)(Re,{className:"mr-2"}),o("couldNotRetrieve")))},{useRef:Ne}=e.React,Me=new(0,e.esri.Sanitizer),ke=t=>{var o,n,l,r;const i=e.hooks.useTranslation(d,c.defaultMessages),{className:s,reference:a,recentSearchesData:u,isOpen:v,isGetLocationError:g,serviceList:m,config:p,id:h,searchInputRef:f,locationLoading:S,toggel:y,onRecordItemClick:b,clearSearches:I,setSuggestionFirstItem:x,handleLocationLoadingChange:w}=t,j=Ne(!1),R=(e,t)=>{0!==e||j.current||(x(t),j.current=!0)};return(0,e.jsx)("div",null,(0,e.jsx)(ae,{isOpen:v,autoFocus:!1,reference:a,searchInputRef:f,isFocusWidtSearchInput:!0,toggle:y,id:h,className:(0,e.classNames)("result-list-con suggestion-list-con",s)},p.isUseCurrentLoation&&(0,e.jsx)(Ce,{serviceList:m,isShowCurrentLocation:!0,onLocationChange:b,locationLoading:S,isGetLocationError:g,handleLocationLoadingChange:w}),(j.current=null,null==u?void 0:u.map(((t,o)=>(0,e.jsx)("div",{key:`${null==t?void 0:t.layer}-${o}`,role:"group","aria-label":null==t?void 0:t.layer},(t=>{const o=null==t?void 0:t.suggestionItem;return null==o?void 0:o.map(((o,n)=>{const l=Me.sanitize(o.suggestionHtml),r={configId:null==o?void 0:o.configId,isFromSuggestion:null==o?void 0:o.isFromSuggestion,magicKey:null==o?void 0:o.magicKey};return(0,e.jsx)(c.Button,{className:(0,e.classNames)("d-flex align-items-center py-2 jimu-outline-inside"),key:`${null==t?void 0:t.layer}${n}`,title:o.suggestion,role:"button",onClick:()=>{((e,t)=>{const{configId:o,isFromSuggestion:n,magicKey:l}=t||{};o&&(n||l)?b(e,t):b(e)})(o.suggestion,r)},ref:e=>{R(n,e)}},(0,e.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:l}}))}))})(t))))),p.isShowRecentSearches&&(null===(n=null===(o=u[0])||void 0===o?void 0:o.suggestionItem)||void 0===n?void 0:n.length)>0&&(0,e.jsx)(c.DropdownItem,{divider:!0}),p.isShowRecentSearches&&(null===(r=null===(l=u[0])||void 0===l?void 0:l.suggestionItem)||void 0===r?void 0:r.length)>0&&(0,e.jsx)(c.Button,{role:"button",className:"clear-recent-search-con jimu-outline-inside",title:i("clearRecentSearches"),onClick:I},(0,e.jsx)(ye,{className:"mr-2"}),i("clearRecentSearches"))))},{useEffect:De,useRef:Oe}=e.React,Fe=t=>{const n=e.hooks.useTranslation(d),{reference:l,searchText:r,id:s,config:a,serviceList:u,isOpentResultListDefault:v,searchInputRef:g,searchResult:p,selectionList:h,openUtilityErrRemindInResult:S,toggleResultUtilityError:y,setResultFirstItem:b,handleDsIdOfSelectedResultItemChange:I}=t,{resultMaxNumber:x}=a,w=Oe([]),j=Oe(!1),R=Oe(null),C=Oe(!1),N=Oe((0,e.Immutable)({})),M=Oe({}),k=e.ReactRedux.useSelector((e=>e.appContext.isRTL));let D={};const O=(0,le.useTheme)(),[F,T]=e.React.useState((0,e.Immutable)({})),[L,E]=e.React.useState(v),[P,A]=e.React.useState(!1),[G,B]=e.React.useState(i.Classic),[z,J]=e.React.useState(!1),[q,H]=e.React.useState(0),[K,W]=e.React.useState(o);De((()=>{j.current=!1,Q(null==u?void 0:u.asMutable({deep:!0}),s)&&X()}),[p]),De((()=>{de(F)}),[F]),De((()=>{(null==a?void 0:a.searchResultStyle)&&(null==a?void 0:a.searchResultStyle)!==G&&B(null==a?void 0:a.searchResultStyle)}),[a]),De((()=>{w.current=[]}),[r]),De((()=>{ve(G,L,z)}),[G,L,z]);const X=()=>{const t=U(null==u?void 0:u.asMutable({deep:!0}),x,s);Promise.all([t]).then((t=>{j.current=!0;let o=F||(0,e.Immutable)({}),n=[];null==t||t.forEach((e=>{n=n.concat(e)}));const l={};n.forEach((e=>{const{records:t,configId:n,dsId:r,isGeocodeRecords:i,localDsId:s}=e;l[n]=t;const a=re(t,n,r,i,s);o=o.setIn([n],a)})),N.current=o,T(o),M.current=l,H(q+1),ue()}))},Y=()=>{var e;if(V(u)<2)return!1;let t=0,o=0;for(const n in F){const l=_(a,n),r=null==l?void 0:l.icon;r&&(t+=1),(null===(e=F[n])||void 0===e?void 0:e.length)>0&&r&&(o+=1)}return o>0&&t>0},Z=e.hooks.useEventCallback(((t,o,n=!1)=>null==t?void 0:t.map(((t,l)=>{var r,i,s,d;const{configId:v,value:g,recordId:m,outputDsId:p}=t,h=se(v,m),f=null===(i=null===(r=null==o?void 0:o.asMutable({deep:!0}))||void 0===r?void 0:r[v])||void 0===i?void 0:i.includes(m),S=_(a,v),y=null==S?void 0:S.icon,b=f?null===(s=null==O?void 0:O.colors)||void 0===s?void 0:s.white:null===(d=null==O?void 0:O.colors)||void 0===d?void 0:d.primary,I=V(u);return(0,e.jsx)(c.Button,{className:(0,e.classNames)("d-flex align-items-center jimu-outline-inside",{"item-p-l":n}),key:h,role:"button",active:f,title:g.join(", "),ref:e=>{ee(l,e)},onClick:()=>{te({isActive:f,key:h,recordId:m,dsId:p,configId:v})}},y&&1===I&&(0,e.jsx)(c.Icon,{className:"mr-2",color:b,size:16,icon:null==y?void 0:y.svg}),(0,e.jsx)("div",null,g.join(", ")))})))),ee=(e,t)=>{0!==e||C.current||(b(t),C.current=!0)},te=e.hooks.useEventCallback((t=>{var o,n,l,r,i,a;const{isActive:u,recordId:c,dsId:d,configId:v}=t,g=null===(l=null===(n=null===(o=N.current)||void 0===o?void 0:o[v])||void 0===n?void 0:n[0])||void 0===l?void 0:l.localDsId,m=null===(a=null===(i=null===(r=N.current)||void 0===r?void 0:r[v])||void 0===i?void 0:i[0])||void 0===a?void 0:a.isGeocodeRecords,p=$(m?d:g),h=u?[]:ne(v,c);e.MessageManager.getInstance().publishMessage(new e.DataRecordsSelectionChangeMessage(s,h)),I(c?d:null),c&&(!u&&oe(v),u?null==p||p.selectRecordsByIds([]):null==p||p.selectRecordsByIds([c]))})),oe=e=>{var t,o,n,l,r,i;const s=N.current;for(const a in s)if(e!==a){const e=null===(o=null===(t=s[a])||void 0===t?void 0:t[0])||void 0===o?void 0:o.outputDsId,u=null===(l=null===(n=null==s?void 0:s[a])||void 0===n?void 0:n[0])||void 0===l?void 0:l.localDsId,c=null===(i=null===(r=null==s?void 0:s[a])||void 0===r?void 0:r[0])||void 0===i?void 0:i.isGeocodeRecords,d=$(c?e:u);d&&d.selectRecordsByIds([])}},ne=(e,t)=>{var o;const n=(null===(o=M.current)||void 0===o?void 0:o[e])||[];return(null==n?void 0:n.filter((e=>(null==e?void 0:e.getId())===t)))||[]},re=(t,o,n,l,r)=>{var i;const s=(null===(i=null==u?void 0:u[o])||void 0===i?void 0:i.displayFields)||[],a=[],c=e.i18n.getIntl();return null==t||t.forEach((e=>{const t=[];s.forEach((o=>{const n=e.getFormattedFieldValue(o.jimuName,c);(n||0===n)&&t.push(n)}));const i={value:t,configId:o,outputDsId:n,recordId:null==e?void 0:e.getId(),isGeocodeRecords:l,localDsId:r};a.push(i),ie(i)})),a},ie=e=>{!(null==D?void 0:D.recordId)&&e.recordId&&(D=e)},se=(e,t)=>`${e}_${t}`,ue=()=>{const e=Q(null==u?void 0:u.asMutable({deep:!0}),s);if(!(null==a?void 0:a.isAutoSelectFirstResult)||!(null==D?void 0:D.recordId)||P||!e)return;const{configId:t,recordId:o,outputDsId:n}=D,l=se(t,o);te({isActive:!1,key:l,recordId:o,dsId:n,configId:t}),A(!0)},ce=()=>{ve(G,!L,z),E(!L),H(q+1)},de=e=>{var t;let o=0;for(const n in e)o+=(null===(t=null==e?void 0:e[n])||void 0===t?void 0:t.length)||0;const n=V(u);J(0===n||0===o&&j.current)},ve=(e,t,n)=>{var r;let s=o;if(e===i.Compact)if(t||n)s=o;else{const e=(null===(r=null==l?void 0:l.current)||void 0===r?void 0:r.clientWidth)/2-15||0;s=k?[-e,0]:[e,0]}else s=o;W(s)};return(0,e.jsx)("div",{role:"group","aria-label":n("searchResults")},(0,e.jsx)(ae,{isOpen:!0,isFocusWidtSearchInput:!0,autoFocus:!1,reference:l,searchInputRef:g,toggle:e=>{L&&E(!1)},id:s,offset:K,version:q,className:(0,e.classNames)("result-list-con",G!==i.Compact||z?"":L?"result-list-con-compact-open":"result-list-con-compact-close")},(0,e.jsx)("div",{className:"result-list-content"},(0,e.jsx)("div",{ref:R},z&&(0,e.jsx)(c.Button,{role:"button",className:"text-center",disabled:!0,title:n("noResult",{searchText:r})},n("noResult",{searchText:r})),!z&&(0,e.jsx)("div",null,G===i.Classic&&(0,e.jsx)("div",null,(0,e.jsx)(c.Button,{role:"button",className:"d-flex align-items-center show-result-button jimu-outline-inside",onClick:ce,title:n("searchResults")},(0,e.jsx)("div",{className:"flex-grow-1 font-weight-bold"},n("searchResults")),!L&&r?(0,e.jsx)(m,null):(0,e.jsx)(f,null)),L&&(0,e.jsx)(c.DropdownItem,{divider:!0})),L&&(0,e.jsx)("div",null,(()=>{var t,o;const n=[];C.current=null;for(const l in F){const r=null===(t=null==F?void 0:F.asMutable({deep:!0}))||void 0===t?void 0:t[l],i=_(a,l),s=null==i?void 0:i.label,d=null==i?void 0:i.icon,v=V(u),g=(0,e.jsx)("div",{key:`${l}_${s}_con`,role:"group",title:"label","aria-label":s},r.length>0&&(0,e.jsx)("div",null,v>1&&(0,e.jsx)(c.Button,{role:"button",className:"source-label-con jimu-outline-inside",disabled:!0,key:`${l}_${s}`,title:s},d&&(0,e.jsx)(c.Icon,{className:"mr-2",color:null===(o=null==O?void 0:O.colors)||void 0===o?void 0:o.primary,size:16,icon:null==d?void 0:d.svg}),s),Z(r,h,Y())));n.push(g)}return n})()),G===i.Compact&&(0,e.jsx)("div",{className:"show-result-button-style2-con"},L&&(0,e.jsx)(c.DropdownItem,{divider:!0}),(0,e.jsx)(c.Button,{role:"button",className:"d-flex align-items-center show-result-button show-result-button-style2 jimu-outline-inside",onClick:ce,title:n("searchResults")},!L&&r?(0,e.jsx)(m,{size:10}):(0,e.jsx)(f,{size:10}))))),S&&(0,e.jsx)(ge,{open:S,serviceList:u,toggleUtilityErrorRemind:y}))))};var Te=s(30224),Le=s.n(Te);const Ee=t=>{const o=window.SVG,{className:n}=t,l=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:Le()},l)):e.React.createElement("svg",Object.assign({className:r},l))};var Pe=s(55339),Ue=s.n(Pe);const $e=t=>{const o=window.SVG,{className:n}=t,l=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:Ue()},l)):e.React.createElement("svg",Object.assign({className:r},l))},{useSelector:Ae}=e.ReactRedux,{useState:Ge,useEffect:Be,useRef:_e,useMemo:Ve}=e.React,ze=t=>{var o,i,s,a,u,v,g;const m=e.hooks.useTranslation(d,c.defaultMessages),p=(0,le.useTheme)(),h=Ae((e=>null==e?void 0:e.queryObject)),f=Ae((e=>{var t;return null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.appMode})),S=_e((e=>{})),y=_e(null),b=_e(null),x=_e(null),j=_e(null),R=_e(null),C=_e(!1),N=_e(!1),M=_e(null),k=_e(null),D=_e(null),O=_e(!1),E=_e(!1),A=_e(null),_=_e(null),z=_e(null),J=_e(!1),Z=_e(null),ee=_e(!1),te=_e(null),oe=_e(null),ne=_e(!1),re=_e(!1),ie=_e(!1),{config:se,className:ae,reference:ue,id:ce,isShowSearchInput:de,isInCurrentView:ve,isWidgetInCurrentPage:ge,serviceList:me,searchResult:pe,selectionList:fe,handleServiceListChange:Se,clearSearchResult:ye}=t,{isShowRecentSearches:be,recentSearchesMaxNumber:Ie,linkParam:xe,searchResultView:we,resultMaxNumber:je}=se,[Re,Ce]=Ge(null),[Ne,Me]=Ge(!1),[De,Oe]=Ge(!1),[Te,Le]=Ge(!1),[Pe,Ue]=Ge([]),[ze,Je]=Ge({}),[qe,He]=Ge(!1),[Ke,We]=Ge(!1),[Qe,Xe]=Ge(null),[Ye,Ze]=Ge(!1),[et,tt]=Ge(!1),[ot,nt]=Ge([]),[lt,rt]=Ge(!1),[it,st]=Ge(null),[at,ut]=Ge(!1),[ct,dt]=Ge(!1),vt=e.css`
    .input-wrapper {
      height: 100% !important;
    }
    .loading-con {
      @keyframes loading {
        0% {transform: rotate(0deg); };
        100% {transform: rotate(360deg)};
      }
      width: ${e.polished.rem(16)};
      height: ${e.polished.rem(16)};
      min-width: ${e.polished.rem(16)};
      border: 2px solid ${null===(s=null===(i=null===(o=null==p?void 0:p.colors)||void 0===o?void 0:o.palette)||void 0===i?void 0:i.secondary)||void 0===s?void 0:s[300]};
      border-radius: 50%;
      border-top: 2px solid ${null===(v=null===(u=null===(a=null==p?void 0:p.colors)||void 0===a?void 0:a.palette)||void 0===u?void 0:u.primary)||void 0===v?void 0:v[500]};
      box-sizing: border-box;
      animation:loading 2s infinite linear;
      box-sizing: border-box;
    }
    .search-button {
      width: ${e.polished.rem(32)};
      border-radius: 0;
    }
    .search-input-con input{
      width: 100%;
    }
    .search-link-con {
      width: 0;
      height: 0;
      overflow: hidden;
    }
    &.arrangement-Style1 {
      .search-button {
        border-radius: 0 ${e.polished.rem(4)} ${e.polished.rem(4)} 0;
      }
      .input-wrapper {
        border-radius: ${e.polished.rem(4)} 0 0 ${e.polished.rem(4)};
      }
      .no-border-left .input-wrapper{
        border-radius: 0;
        border-left: none;
      }
    }
    &.arrangement-Style2 {
      & {
        padding-right: 1px;
      }
      .input-prefix-icon {
        color: var(--light-700);
      }
      .input-wrapper {
        border-radius: ${e.polished.rem(32)} !important;
      }
    }
    &.arrangement-Style3 {
      .input-wrapper {
        background: none;
        border: none;
      }
      .search-button {
        background: none;
      }
    }
  `;Be((()=>{ee.current&&ve&&ge?(We(!1),e.lodash.defer((()=>{jt(!0)}))):We(!0),ve&&ge||He(!1)}),[ve,ge]),Be((()=>{!Ye&&J.current&&mt(!0,!1),J.current=Ye}),[qe,Ye]),Be((()=>{qe&&f===e.AppMode.Design&&He(!1)}),[f]),Be((()=>{S.current=e.lodash.debounce(bt,400)}),[se]),Be((()=>{_t(me),It(me),!E.current&&me&&(gt(me),E.current=!0)}),[me]);const gt=e.hooks.useEventCallback((e=>{var t;const o=X(ce),{searchText:l,status:r}=o;if(r&&(r.isFromSuggestion=!0),l){if(!(null==se?void 0:se.datasourceConfig)||0===(null===(t=null==se?void 0:se.datasourceConfig)||void 0===t?void 0:t.length))return Gt(l,r),void kt(l);clearTimeout(Z.current),Z.current=setTimeout((()=>{((e,t)=>{var o;let l=!0;for(const r in e){const i=e[r];let s;if(i.searchServiceType===n.FeatureService)H(null===(o=null==i?void 0:i.useDataSource)||void 0===o?void 0:o.dataSourceId,W(i.configId,t))||(l=!1);else{const e=null==i?void 0:i.outputDataSourceId;s=$(e),s||(l=!1)}}return l})(null==e?void 0:e.asMutable({deep:!0}),ce)&&Vt()>0?(Gt(l,r),kt(l)):gt(e)}),300)}}));Be((()=>{ht(me),pt(me,C.current),R.current=me,C.current=null==se?void 0:se.enableFiltering,N.current=!0}),[me,se.enableFiltering]);const mt=(e=!1,t=!0)=>{t&&rt(!1),e||(re.current=!1),tt(e)},pt=(e,t)=>{if(!N.current)return!1;t!==(null==se?void 0:se.enableFiltering)&&(clearTimeout(b.current),b.current=setTimeout((()=>{var o;xt(),ye();for(const l in e)(null===(o=e[l])||void 0===o?void 0:o.searchServiceType)===n.FeatureService&&P(e[l],ce,l,t)})))},ht=e=>{if(!N.current)return!1;const t=R.current,o=ft(e),l=ft(R.current),r=null==l?void 0:l.filter((e=>!(null==o?void 0:o.includes(e))));(null==r?void 0:r.length)>0&&(clearTimeout(b.current),b.current=setTimeout((()=>{xt(!1),ye(),null==r||r.forEach((e=>{var o;(null===(o=t[e])||void 0===o?void 0:o.searchServiceType)===n.FeatureService&&P(t[e],ce,e,null==se?void 0:se.enableFiltering)}))})))},ft=e=>e?Object.keys(e).map((e=>e)):[],St=(e=!1)=>{ut(e)},yt=(e=!1)=>{dt(e)},bt=e.hooks.useEventCallback((e=>{var t;const o=((e,t,o)=>{const l=[];for(const r in t){const i=t[r];let s;s=i.searchServiceType===n.FeatureService?F(e,o,i):I(e,i),l.push(s)}return Promise.all(l)})(e,null===(t=null==M?void 0:M.current)||void 0===t?void 0:t.asMutable({deep:!0}),se);Promise.all([o]).then((e=>{var t;const o=null==e?void 0:e[0];(null===(t=null==o?void 0:o.filter((e=>null==e?void 0:e.err)))||void 0===t?void 0:t.length)>0&&St(!0),Me(!1),o&&Ue(o),O.current||A.current&&Oe(!0),O.current=!1})).catch((e=>{Me(!1)}))})),It=e.hooks.useEventCallback((e=>{if(!N.current)return!1;let t=!1;for(const o in e){const l=e[o];((null==l?void 0:l.searchServiceType)===n.FeatureService||(null==l?void 0:l.isSupportSuggest))&&(t=!0)}Le(t)})),xt=(e=!0)=>{var t;Gt(""),wt(),Me(!1),jt(!1),kt("",!0),Dt(),clearTimeout(z.current),e&&(null===(t=_.current)||void 0===t||t.focus())},wt=e.hooks.useEventCallback((()=>{var t,o;for(const l in me)if((null===(t=me[l])||void 0===t?void 0:t.searchServiceType)===n.GeocodeService){const t=null===(o=me[l])||void 0===o?void 0:o.outputDataSourceId,n=$(t);n.selectRecordsByIds([]),q(n,e.DataSourceStatus.NotReady);const r=new e.DataRecordSetChangeMessage(ce,e.RecordSetChangeType.Remove,[t]);e.MessageManager.getInstance().publishMessage(r)}})),jt=e=>{ee.current=e,e||We(!0),He(e)},Rt=()=>{let e=!0;if(!j.current)return e;const t=j.current;for(const o in t){const n=t[o];if(e=!((null==n?void 0:n.magicKey)||(null==n?void 0:n.isFromSuggestion)),!e)break}return e},Ct=(e,t,o)=>{if(o)return Mt(),!1;Nt(e,t),Gt(e,t),kt(e),_.current.focus()},Nt=(e,t)=>{const o=X(ce)||{};if(e){if(o.searchText=e,t){const e={configId:null==t?void 0:t.configId};(null==t?void 0:t.magicKey)&&(e.magicKey=null==t?void 0:t.magicKey),o.status=e}Y(ce,o)}else if(null==o?void 0:o.serviceEnabledList){const e={serviceEnabledList:null==o?void 0:o.serviceEnabledList};Y(ce,e)}else Y(ce,null)},Mt=()=>{var e;null===(e=_.current)||void 0===e||e.focus(),rt(!0),mt(!0,!1)},kt=e.hooks.useEventCallback(((t,o=!1)=>{if(qe&&!o)return;t=null==t?void 0:t.trim(),Pt(t),Oe(!1),mt(!1),Dt(),Se(M.current),O.current=!0;const r={serviceList:j.current,searchText:t,searchResultView:we,id:ce};Nt(t),(e=>{const{serviceList:t,searchText:o,searchResultView:r}=e,i=[];for(const e in t){const s=t[e],{searchServiceType:a,resultMaxNumber:u}=s;if(a===n.GeocodeService){const e=r===l.ResultPanel?u:null,t=w(o,e,s,r);i.push(t)}}return Promise.all(i)})(r).then((o=>{var l;(null===(l=null==o?void 0:o.filter((e=>"boolean"==typeof e)))||void 0===l?void 0:l.length)>0&&yt(!0),O.current=!1,(null==se?void 0:se.enableFiltering)&&(function(t){var o,l;const{serviceList:r,searchText:i,id:s}=t,a={};for(const e in r){const t=r[e],{searchServiceType:i,useDataSource:s}=t;if(i===n.FeatureService&&(null==s?void 0:s.dataSourceId)){const e=null==s?void 0:s.dataSourceId;let n=(null===(o=null==a?void 0:a[e])||void 0===o?void 0:o.sqlExpression)||null,r=(null===(l=a[e])||void 0===l?void 0:l.outFields)||[];const i=L(t.searchFields,t.displayFields,e)||[];a[e]?((null==t?void 0:t.SQL)&&n.push(null==t?void 0:t.SQL),r=Array.from(new Set(r.concat(i)))):(n=(null==t?void 0:t.SQL)?[null==t?void 0:t.SQL]:null,r=i,a[e]={}),a[e].sqlExpression=n,a[e].outFields=r}}!function(t,o,n){var l,r;for(const i in null==t?void 0:t.asMutable({deep:!0})){const s=null===(l=null==t?void 0:t[i])||void 0===l?void 0:l.sqlExpression,a=null===(r=null==t?void 0:t[i])||void 0===r?void 0:r.outFields,u=$(i);let c,d;n?s?(d=e.dataSourceUtils.getMergedSQLExpressions(null==s?void 0:s.asMutable({deep:!0}),u,e.ClauseLogic.Or),c=d.sql):(c="1=0",d=null):(c="1=1",d=null);const v=(0,e.Immutable)({outFields:a,where:c,sqlExpression:d,returnGeometry:!0});u&&u.updateQueryParams(v,o)}}((0,e.Immutable)(a),s,i)}(r),Ot()),t&&Ft(t)}))})),Dt=()=>{if(e.MessageManager.getInstance().publishMessage(new e.DataRecordsSelectionChangeMessage(ce,[])),it){const e=$(it);null==e||e.selectRecordsByIds([])}},Ot=()=>{var t;const o=[];for(const e in me){const l=me[e];let r;(null==l?void 0:l.searchServiceType)===n.FeatureService&&(r=null===(t=null==l?void 0:l.useDataSource)||void 0===t?void 0:t.dataSourceId,o.push(r))}e.MessageManager.getInstance().publishMessage(new e.DataSourceFilterChangeMessage(ce,o))},Ft=e=>{$t(),we===l.OtherWidgets?e&&(Et()?Ut():Tt()):Lt()},Tt=()=>{if(!Q(j.current,ce))return clearTimeout(k.current),k.current=setTimeout((()=>{Tt()}),200),!1;const e=U(j.current,je,ce);Promise.all([e]).then((e=>{let t=[],o=[];null==e||e.forEach((e=>{t=t.concat(e)})),t.forEach((e=>{const t=(null==e?void 0:e.records)||[];o=o.concat(t)})),(null==o?void 0:o.length)>0?Ut():Lt()}))},Lt=()=>{const t=U(j.current,je,ce,!0);Promise.all([t]).then((t=>{let o=[];null==t||t.forEach((e=>{o=o.concat(e)})),K(ce,o,e.RecordSetChangeType.CreateUpdate)})),jt(!0)},Et=()=>{let e=[];return Pe.forEach((t=>{e=e.concat(null==t?void 0:t.suggestionItem)})),e.length>0},Pt=t=>{(t=>{const{searchText:o,id:n,recentSearchesMaxNumber:l,isShowRecentSearches:r}=t,i=e.urlUtils.getAppIdPageIdFromUrl().appId,s=B(i,n);if(!r||!o)return!1;let a=G(n);a.includes(o)||(a.unshift(o),a=a.splice(0,l||10),e.utils.setLocalStorage(s,escape(a.join("/@/"))))})({searchText:t,id:ce,recentSearchesMaxNumber:Ie,isShowRecentSearches:be})},Ut=()=>{var e;if(!(null==y?void 0:y.current))return!1;null===(e=null==y?void 0:y.current)||void 0===e||e.click()},$t=()=>{if(!Q(j.current,ce))return clearTimeout(D.current),D.current=setTimeout((()=>{$t()}),200),!1;const t=we===l.ResultPanel?je:100,o=U(j.current,t,ce,!0);Promise.all([o]).then((t=>{let o=[];null==t||t.forEach((e=>{o=o.concat(e)})),K(ce,o,e.RecordSetChangeType.CreateUpdate)}))},At=Ve((()=>(e=>{let t,o;return(null==e?void 0:e.linkType)&&(t=null==e?void 0:e.openType,o={linkType:null==e?void 0:e.linkType},o.value=null==e?void 0:e.value),{linkTo:o,target:t}})(xe)),[xe]),Gt=(e,t)=>{Ue([]),Ce(e),A.current=e,Bt(e,t)},Bt=e.hooks.useEventCallback(((t,o)=>{var l,r,i;let s=me;t=null==t?void 0:t.trim();for(const e in me){const o=null===(r=null===(l=me[e])||void 0===l?void 0:l.useDataSource)||void 0===r?void 0:r.dataSourceId;if(me[e].searchServiceType===n.GeocodeService||!H(o))continue;const a=$(o),u=(null===(i=me[e].searchFields)||void 0===i?void 0:i.asMutable({deep:!0}))||[],c=T(t,u,a,me[e].searchExact||!1),d=T(t,u,a,!1);s=s.setIn([e,"SQL"],c).setIn([e,"SuggestionSQL"],d).setIn([e,"searchText"],t)}M.current=s,((t,o)=>{const{configId:n,magicKey:l,isFromSuggestion:r}=o||{};let i=(0,e.Immutable)(t);const s={};for(const e in i)e===n&&(l||r)&&(l&&(i=i.setIn([n,"magicKey"],l||null)),r&&(i=i.setIn([n,"isFromSuggestion"],r||null)),s[n]=i[n]);(l||r)&&Object.keys(t).includes(n)&&(i=(0,e.Immutable)(s)),j.current=null==i?void 0:i.asMutable({deep:!0}),Je(null==i?void 0:i.asMutable({deep:!0}))})(null==s?void 0:s.asMutable({deep:!0}),o)})),_t=e.hooks.useEventCallback((e=>{var t,o;let n;const l=Vt(e);for(const l in e)n=(null===(t=null==e?void 0:e[l])||void 0===t?void 0:t.hint)&&(null===(o=null==e?void 0:e[l])||void 0===o?void 0:o.hint);const r=(null==se?void 0:se.hint)||m("findAddressOrPlace");n=n||m("findAddressOrPlace"),Xe(1!==l?r:n)})),Vt=e.hooks.useEventCallback((e=>V(e=e||me))),zt=e=>{var t,o,n;40===e.keyCode&&te&&(De?null===(t=null==te?void 0:te.current)||void 0===t||t.focus():qe?null===(o=null==x?void 0:x.current)||void 0===o||o.focus():et&&(null===(n=null==oe?void 0:oe.current)||void 0===n||n.focus(),re.current=!0))},Jt=()=>{if(Ye)return!0;if(Ne||qe)return!1;let e=!1;return(null==se?void 0:se.maxSuggestions)>0&&(e=De&&Te),e||(ne.current=!1),e},qt=()=>{Oe(!1)};return(0,e.jsx)("div",{className:`h-100 align-items-center position-relative d-flex flex-grow-1 ${ae||""} arrangement-${se.arrangementStyle}`,css:vt},(0,e.jsx)("div",{className:"h-100 flex-grow-1 search-input-con"},(0,e.jsx)("div",{className:"h-100 w-100",onKeyDown:e=>{if("ArrowUp"===e.key||"ArrowDown"===e.key){const e=Jt();ne.current=e,re.current=et}zt(e)}},de&&(0,e.jsx)(c.TextInput,{value:Re||"",onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,n=(null==o?void 0:o.length)>2;if(Gt(o),qe&&kt("",!0),jt(!1),!n||!Te)return Oe(!1),0===(null==o?void 0:o.length)&&kt("",!0),!1;!Ne&&Me(!0),S.current(o)},onFocus:e=>{if(ne.current||re.current)return re.current=!1,ne.current=!1,!1;(e=>{if(!e&&be){const e=G(ce).map((e=>({suggestionHtml:e,suggestion:e,isRecentSearche:!0})));nt([{suggestionItem:e,layer:null,icon:null}]),mt(!0)}})(A.current),!A.current&&(null==se?void 0:se.isUseCurrentLoation)&&(mt(!0),(null==se?void 0:se.isShowRecentSearches)||nt([{suggestionItem:[],layer:null,icon:null}]))},onKeyUp:e=>{var t;if(!e||!e.target)return;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;13===e.keyCode&&Rt()&&(Gt(o),kt(o)),zt(e)},onBlur:e=>{z.current=setTimeout((()=>{ne.current||Oe(!1),ie.current||re.current||mt(!1)}),200)},className:(0,e.classNames)("h-100 w-100",{"no-border-left":(null===(g=null==se?void 0:se.datasourceConfig)||void 0===g?void 0:g.length)>1}),suffix:(0,e.jsx)("div",{className:"d-flex align-items-center"},(Ne||Ye)&&(0,e.jsx)("div",{className:"loading-con mr-1"}),Re&&(null==Re?void 0:Re.length)>0&&(0,e.jsx)(c.Button,{icon:!0,type:"tertiary",size:"sm",title:m("clear"),onClick:()=>{xt()}},(0,e.jsx)($e,null))),prefix:se.arrangementStyle===r.Style2?(0,e.jsx)(Ee,{className:"input-prefix-icon"}):null,placeholder:Qe,title:Re||Qe,ref:_})),Re&&(0,e.jsx)(he,{canUseOutoutDsLength:Vt(),isOpen:Jt(),reference:ue,searchText:Re,searchSuggestion:Pe,toggel:qt,onRecordItemClick:Ct,setSuggestionFirstItem:e=>{te.current=e},id:ce,config:se,toggleSuggestionUtilityError:St,openUtilityErrRemindInSuggestion:at,searchInputRef:_,serviceList:me}),!Re&&((null==se?void 0:se.isUseCurrentLoation)||(null==se?void 0:se.isShowRecentSearches)||!Ye)&&(0,e.jsx)(ke,{serviceList:(0,e.Immutable)(ze),isOpen:et||Ye,reference:ue,isGetLocationError:lt,recentSearchesData:ot,toggel:qt,onRecordItemClick:Ct,clearSearches:()=>{(t=>{const o=e.urlUtils.getAppIdPageIdFromUrl().appId,n=B(o,t);e.utils.setLocalStorage(n,"")})(ce),nt([]),tt(!1)},setSuggestionFirstItem:e=>{oe.current=e},id:ce,config:se,searchInputRef:_,locationLoading:Ye,handleLocationLoadingChange:e=>{e?(Ze(e),ie.current=e):setTimeout((()=>{Ze(e),ie.current=e}),300)}}),qe&&(0,e.jsx)(Fe,{serviceList:(0,e.Immutable)(ze),config:se,reference:ue,searchText:Re,id:ce,setResultFirstItem:e=>{x.current=e},isOpentResultListDefault:Ke,searchInputRef:_,searchResult:pe,selectionList:fe,openUtilityErrRemindInResult:ct,handleDsIdOfSelectedResultItemChange:e=>{st(e)},toggleResultUtilityError:yt})),se.arrangementStyle!==r.Style2&&(0,e.jsx)(c.Button,{className:"search-button h-100",type:se.arrangementStyle===r.Style3?"tertiary":"primary",icon:!0,onClick:()=>{(e=>{Rt()&&kt(e)})(Re)},title:m("SearchLabel")},(0,e.jsx)(Ee,null)),we===l.OtherWidgets&&(0,e.jsx)("div",{className:"search-link-con"},(0,e.jsx)(c.Link,{ref:y,to:null==At?void 0:At.linkTo,target:null==At?void 0:At.target,queryObject:h})))},Je=t=>{const{config:o,id:l,serviceList:r,dsStatus:i,handleSearchResultChange:s,handleSelectionListChange:a,handleDsStatusChange:u}=t,c=(t,r)=>{if(t.searchServiceType===n.GeocodeService){const n=null==t?void 0:t.outputDataSourceId,i={dataSourceId:n,mainDataSourceId:n},s={where:"1=1",sqlExpression:null,pageSize:o.resultMaxNumber,page:1,returnGeometry:!0};return(0,e.jsx)("div",{key:`${r}_con`},n&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:(0,e.Immutable)(i),query:s,key:`${r}_outputDataSource`,onDataSourceInfoChange:e=>{v(t,r)},onDataSourceStatusChange:e=>{v(t,r,e)},onSelectionChange:e=>{d(e,r)},widgetId:l}))}if(t.searchServiceType===n.FeatureService){const o=null==t?void 0:t.useDataSource,n=function(t){const{searchText:o,useDataSource:n}=t,l=null==t?void 0:t.SQL,r=o?(null==l?void 0:l.sql)||"1=0":"1=1",i=o&&(null==l?void 0:l.sql)?l:null,s=L(t.searchFields,t.displayFields,null==n?void 0:n.dataSourceId);return(0,e.Immutable)({outFields:s,where:r,sqlExpression:i,returnGeometry:!0})}(null==t?void 0:t.asMutable({deep:!0})),s=W(r,l);return(0,e.jsx)("div",{key:`${r}_con`},o&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:(0,e.Immutable)(o),query:n,key:`${r}_useDataSource`,onDataSourceInfoChange:e=>{v(t,r)},onSelectionChange:e=>{d(e,r)},onDataSourceCreated:e=>{e.setListenSelection(!0)},onDataSourceStatusChange:t=>{u((0,e.Immutable)(i.set(r,t)))},localId:s}))}},d=(e,t)=>{a(e,t)},v=(t,r,a)=>{const{searchServiceType:c}=t;switch(c){case n.GeocodeService:D(null==t?void 0:t.asMutable({deep:!0}),o.resultMaxNumber).then((e=>{const{records:t}=e,o=null==t?void 0:t.map((e=>e.getId()));s(r,o)}));break;case n.FeatureService:E(null==t?void 0:t.asMutable({deep:!0}),o.resultMaxNumber,l).then((e=>{const{records:t}=e,o=null==t?void 0:t.map((e=>e.getId()));s(r,o)}))}a&&u((0,e.Immutable)(i.set(r,a)))};return(0,e.jsx)("div",null,(()=>{const e=[];for(const t in r)e.push(c(r[t],t));return e})())},qe=(e,t=0)=>{let o="Default Address";return null==e||e.forEach((n=>{o=t?`${o}${t}`:o,n.jimuName===o&&(o=qe(e,t+=1))})),o};var He=function(e,t,o,n){return new(o||(o=Promise))((function(l,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};const Ke={jimuName:y,alias:"ADDRESS",type:e.JimuFieldType.String,name:y},We=t=>He(void 0,void 0,void 0,(function*(){return e.UtilityManager.getInstance().getUrlOfUseUtility(t).then((e=>Promise.resolve(e)))}));class Qe extends e.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.9.0",description:"For geocode service, use arrary of Schema to set displayFields",upgrader:e=>{var t,o;const l=null===(o=null===(t=null==e?void 0:e.asMutable({deep:!0}))||void 0===t?void 0:t.datasourceConfig)||void 0===o?void 0:o.map((e=>((null==e?void 0:e.searchServiceType)===n.FeatureService||(null==e?void 0:e.displayFields)||(e.displayFields=[Ke],e.addressFields=[Ke],e.defaultAddressFieldName=Ke.jimuName),e)));return e.setIn(["datasourceConfig"],l)}},{version:"1.10.0",description:"For locator service, need to save support for suggest in config",upgrader:t=>He(this,void 0,void 0,(function*(){var o,l;const r=null===(l=null===(o=null==t?void 0:t.asMutable({deep:!0}))||void 0===o?void 0:o.datasourceConfig)||void 0===l?void 0:l.map((t=>(null==t?void 0:t.searchServiceType)===n.FeatureService?Promise.resolve(t):We(null==t?void 0:t.useUtility).then((o=>He(this,void 0,void 0,(function*(){return(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[n]=e;return n(o,{query:{f:"json"},responseType:"json"}).then((e=>{var o;const n=(null==e?void 0:e.data)||{};if(null==n?void 0:n.capabilities){const e=(null===(o=null==n?void 0:n.capabilities)||void 0===o?void 0:o.split(","))||[],l=null==e?void 0:e.includes("Suggest");return t.isSupportSuggest=l,Promise.resolve(t)}return Promise.resolve(t)}))}),(e=>Promise.resolve(t)))})))))),i=r?yield Promise.all(r):[];return t.setIn(["datasourceConfig"],i)}))},{version:"1.12.0",description:'For old search widgets, "enableFiltering" needs to be "true" by default, and the default value of "searchResultStyle" should be "Classic"',upgrader:t=>He(this,void 0,void 0,(function*(){const o=yield(()=>He(this,void 0,void 0,(function*(){var o,l;const r=null===(l=null===(o=null==t?void 0:t.asMutable({deep:!0}))||void 0===o?void 0:o.datasourceConfig)||void 0===l?void 0:l.map((t=>He(this,void 0,void 0,(function*(){return(null==t?void 0:t.searchServiceType)===n.FeatureService?Promise.resolve(t):We(null==t?void 0:t.useUtility).then((o=>(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((n=>{const[l]=n;return l(o,{query:{f:"json"},responseType:"json"}).then((o=>{const n=(null==o?void 0:o.data)||{};if(null==n?void 0:n.capabilities){const o=(null==n?void 0:n.candidateFields)||[],{addressFieldsSchema:l}=((t=[])=>{const o=null==t?void 0:t.map((t=>({jimuName:null==t?void 0:t.alias,alias:null==t?void 0:t.alias,type:e.JimuFieldType.String,name:null==t?void 0:t.alias}))),n=qe(o,0),l={jimuName:n,alias:n,type:e.JimuFieldType.String,name:n};return o.unshift(l),{addressFieldsSchema:o,defaultAddressFieldName:n}})(o),r=((null==t?void 0:t.addressFields)||[]).concat(l);return t.addressFields=r,Promise.resolve(t)}return Promise.resolve(t)}),(e=>Promise.resolve(t)))}))))}))));return r?yield Promise.all(r):[]})))();return t.setIn(["enableFiltering"],!0).setIn(["datasourceConfig"],o).setIn(["searchResultStyle"],i.Classic)}))}]}}const Xe=new Qe;var Ye=function(e,t,o,n){return new(o||(o=Promise))((function(l,r){function i(e){try{a(n.next(e))}catch(e){r(e)}}function s(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}a((n=n.apply(e,t||[])).next())}))};const{useEffect:Ze,useState:et,useRef:tt}=e.React,ot=o=>{const{config:l,id:i,useDataSources:s}=o,{resultMaxNumber:a}=l,u=tt(null),c=tt((0,e.Immutable)({})),[d,v]=et((0,e.Immutable)([])),[g,m]=et(!1),[p,h]=et(null),[f,S]=et((0,e.Immutable)({})),[y,b]=et((0,e.Immutable)({})),[I,x]=et((0,e.Immutable)({}));Ze((()=>{R()}),[l]);const w=e.css`
    & {
      height: ${e.polished.rem(32)};
      margin-top: 1px;
      margin-left: 1px;
    }
    &.search-con-Style3 {
      border-bottom: 1px solid var(--light-400);
    }
  `,j=e=>{e&&v(e),O(e)},R=()=>Ye(void 0,void 0,void 0,(function*(){const t=((null==l?void 0:l.datasourceConfig)||(0,e.Immutable)([])).map((e=>Ye(void 0,void 0,void 0,(function*(){const t=C(e);let o=null==e?void 0:e.setIn(["enable"],t);return(null==e?void 0:e.useUtility)&&(yield N(null==e?void 0:e.useUtility).then((e=>{o=o.setIn(["geocodeURL"],e)}))),Promise.resolve(null==o?void 0:o.asMutable({deep:!0}))}))));yield Promise.all(t).then((t=>{v((0,e.Immutable)(t)),O((0,e.Immutable)(t))}))})),C=e=>{if(d&&0!==(null==d?void 0:d.length)){let t=!0;return null==d||d.forEach((o=>{(null==e?void 0:e.configId)===(null==o?void 0:o.configId)&&(t=!!(null==o?void 0:o.enable))})),t}{const t=X(i),o=null==t?void 0:t.serviceEnabledList;return!o||o.includes(null==e?void 0:e.configId)}},N=t=>Ye(void 0,void 0,void 0,(function*(){return e.UtilityManager.getInstance().getUrlOfUseUtility(t).then((e=>Promise.resolve(e)))})),M=e=>{h(e)},k=()=>(null==l?void 0:l.arrangementStyle)===r.Style1||(null==l?void 0:l.arrangementStyle)===r.Style2||(null==l?void 0:l.arrangementStyle)===r.Style3||g,D=e=>{m(e)},O=t=>{var o;let l=(0,e.Immutable)({});null===(o=null==t?void 0:t.asMutable({deep:!0}))||void 0===o||o.forEach((e=>{if(!(null==e?void 0:e.enable))return!1;const{configId:t}=e;let o;o=(null==e?void 0:e.searchServiceType)===n.GeocodeService?T(e):F(e),l=l.setIn([t],o)})),h(l)},F=e.hooks.useEventCallback((e=>{var t;if(!(null==e?void 0:e.enable)||(null==e?void 0:e.searchServiceType)===n.GeocodeService)return!1;const{configId:o,useDataSource:r,displayFields:i,searchFields:s,searchExact:u,hint:c,searchServiceType:d}=e,v=(null===(t=null==p?void 0:p[o])||void 0===t?void 0:t.asMutable({deep:!0}))||{},g={useDataSource:r,displayFields:i,searchFields:s,searchExact:u,maxSuggestions:null==l?void 0:l.maxSuggestions,resultMaxNumber:a,hint:c,searchServiceType:d,configId:o};return Object.assign(v,g)})),T=e=>{var t;if(!(null==e?void 0:e.enable)||(null==e?void 0:e.searchServiceType)===n.FeatureService)return!1;const{configId:o,hint:r,geocodeURL:i,outputDataSourceId:s,label:u,searchServiceType:c,singleLineFieldName:d,displayFields:v,defaultAddressFieldName:g,addressFields:m,isSupportSuggest:h,useUtility:f}=e,S=(null===(t=null==p?void 0:p[o])||void 0===t?void 0:t.asMutable({deep:!0}))||{},y={hint:r,geocodeURL:i,outputDataSourceId:s,icon:null==e?void 0:e.icon,maxSuggestions:null==l?void 0:l.maxSuggestions,resultMaxNumber:a,label:u,searchServiceType:c,configId:o,singleLineFieldName:d||"",displayFields:v,defaultAddressFieldName:g,addressFields:m||[],isSupportSuggest:h,useUtility:f};return Object.assign(S,y)},L=(t,o)=>{const n=f.set(t,o);S((0,e.Immutable)(n))},E=()=>{S((0,e.Immutable)({}))},P=e.hooks.useEventCallback(((e,t)=>{const o=c.current.setIn([t],e);b(o),c.current=o})),U=e=>{x(e)};return(0,e.jsx)(t.ViewVisibilityContext.Consumer,null,(({isInView:o,isInCurrentView:n})=>{const r=!o||n;return(0,e.jsx)(t.PageVisibilityContext.Consumer,null,(t=>{var o;return(0,e.jsx)("div",{className:"widget-search jimu-widget"},(0,e.jsx)("div",{className:`d-flex w-100 align-items-center search-con-${l.arrangementStyle}`,css:w,ref:u},(0,e.jsx)("div",null,(null===(o=null==l?void 0:l.datasourceConfig)||void 0===o?void 0:o.length)>1&&k()&&(0,e.jsx)(ne,{className:"h-100",config:l,dsStatus:I,datasourceConfig:d,id:i,useDataSources:s,onDatasourceConfigChange:j})),(0,e.jsx)(ze,{id:i,className:"flex-grow-1 h-100",reference:u,config:l,isShowSearchInput:k(),onShowSearchInputChange:D,isInCurrentView:r,isWidgetInCurrentPage:t,handleServiceListChange:M,searchResult:f,serviceList:p,clearSearchResult:E,selectionList:y}),(0,e.jsx)(Je,{id:i,config:l,serviceList:p,dsStatus:I,handleSearchResultChange:L,handleSelectionListChange:P,handleDsStatusChange:U})))}))}))};ot.versionManager=Xe;const nt=ot;function lt(e){s.p=e}})(),a})())}}}));