System.register(["jimu-core","jimu-arcgis","jimu-ui","esri/widgets/FeatureForm","esri/widgets/Editor","esri/layers/FeatureLayer","esri/form/FormTemplate","esri/form/elements/FieldElement","esri/form/elements/GroupElement","esri/Graphic","esri/rest/support/Query","esri/core/reactiveUtils"],(function(e,t){var i={},o={},s={},r={},a={},n={},l={},d={},u={},c={},p={},h={};return{setters:[function(e){i.BaseVersionManager=e.BaseVersionManager,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.DataSourceStatus=e.DataSourceStatus,i.Immutable=e.Immutable,i.React=e.React,i.ServiceManager=e.ServiceManager,i.SessionManager=e.SessionManager,i.SupportedLayerServiceTypes=e.SupportedLayerServiceTypes,i.appActions=e.appActions,i.classNames=e.classNames,i.css=e.css,i.dataSourceUtils=e.dataSourceUtils,i.defaultMessages=e.defaultMessages,i.esri=e.esri,i.jsx=e.jsx,i.lodash=e.lodash,i.polished=e.polished,i.privilegeUtils=e.privilegeUtils},function(e){o.JimuMapViewComponent=e.JimuMapViewComponent},function(e){s.Button=e.Button,s.Select=e.Select,s.TextInput=e.TextInput,s.WidgetPlaceholder=e.WidgetPlaceholder,s.defaultMessages=e.defaultMessages},function(e){r.default=e.default},function(e){a.default=e.default},function(e){n.default=e.default},function(e){l.default=e.default},function(e){d.default=e.default},function(e){u.default=e.default},function(e){c.default=e.default},function(e){p.default=e.default},function(e){h.default=e.default}],execute:function(){e((()=>{var e={94127:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 400 400"><path fill="#A8A8A8" fill-rule="evenodd" d="M193 10H10v28h183zm197 53H10v2h380zM10 299h380v2H10zm142-196H25v22h127zm235.99-11H12.01v44h375.98zM10 90v48h380V90zm348 38c7.732 0 14-6.268 14-14s-6.268-14-14-14-14 6.268-14 14 6.268 14 14 14M25 171h127v22H25zm-12.99-11h375.98v44H12.01zM10 206v-48h380v48zm362-24c0 7.732-6.268 14-14 14s-14-6.268-14-14 6.268-14 14-14 14 6.268 14 14m-220 57H25v22h127zm235.99-11H12.01v44h375.98zM10 226v48h380v-48zm348 38c7.732 0 14-6.268 14-14s-6.268-14-14-14-14 6.268-14 14 6.268 14 14 14m-188 62H10v22h160zm209 2h-18a9 9 0 0 0-9 9 9 9 0 0 0 9 9h18a9 9 0 0 0 9-9 9 9 0 0 0-9-9m-18-2c-6.075 0-11 4.925-11 11s4.925 11 11 11h18c6.075 0 11-4.925 11-11s-4.925-11-11-11zm25 11a7 7 0 1 1-14 0 7 7 0 0 1 14 0M10 367h160v22H10zm351 2h18a9 9 0 0 1 9 9 9 9 0 0 1-9 9h-18a9 9 0 0 1-9-9 9 9 0 0 1 9-9m-11 9c0-6.075 4.925-11 11-11h18c6.075 0 11 4.925 11 11s-4.925 11-11 11h-18c-6.075 0-11-4.925-11-11m29 7a7 7 0 1 0 0-14 7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},34750:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},30224:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},88866:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},79964:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},94129:e=>{"use strict";e.exports=c},135:e=>{"use strict";e.exports=h},48702:e=>{"use strict";e.exports=l},70281:e=>{"use strict";e.exports=d},11668:e=>{"use strict";e.exports=u},99818:e=>{"use strict";e.exports=n},37902:e=>{"use strict";e.exports=p},88359:e=>{"use strict";e.exports=a},27387:e=>{"use strict";e.exports=r},26826:e=>{"use strict";e.exports=o},48891:e=>{"use strict";e.exports=i},30726:e=>{"use strict";e.exports=s}},t={};function v(i){var o=t[i];if(void 0!==o)return o.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,v),s.exports}v.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return v.d(t,{a:t}),t},v.d=(e,t)=>{for(var i in t)v.o(t,i)&&!v.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},v.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),v.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},v.p="";var f={};return v.p=window.jimuConfig.baseUrl,(()=>{"use strict";v.r(f),v.d(f,{ModifyType:()=>q,__set_webpack_public_path__:()=>Q,default:()=>K});var e,t,i,o,s,r=v(48891);!function(e){e.Attribute="ATTRIBUTE",e.Geometry="GEOMETRY"}(e||(e={})),function(e){e.Webmap="WEBMAP",e.Custom="CUSTOM"}(t||(t={})),function(e){e.Added="Added",e.Updated="Updated",e.Deleted="Deleted"}(i||(i={})),function(e){e.NoMap="NOMAP",e.NoLayer="NOEDITABLE"}(o||(o={})),function(e){e.Prescriptive="PRESCRIPTIVE",e.Flexible="FLEXIBLE"}(s||(s={}));var a=v(26826),n=v(30726);function l(e,t,i,o,s){return r.css`
    ${"&.edit-widget-"+t} {
      .esri-feature-form__input:focus,
      calcite-input:focus{
        outline: unset !important;
        outline-offset: unset !important;
      }
      .editor-white-bg{
        background-color: ${e.colors.white};
      }
      [heading='Edit feature'] .esri-editor__panel-content{
        padding: 0;
        .esri-editor__panel-content--section{
          padding: 8px 16px;
        }
      }
      .esri-editor__content{
        padding: 8px 16px;
      }
      .esri-feature-form{
        ${("empty"===i||"list"===i)&&`border-bottom: 1px solid ${e.colors.palette.light[200]};`}
        background-color: unset;
        .esri-feature-form__form-header{
          margin: 0;
          .esri-feature-form__description-text{
            font-weight: 500;
            font-size: 13px;
            margin: 0;
          }
        }
      }
      .esri-feature-templates{
        width: 100%;
        height: calc(100% - 40px);
        .esri-item-list{
          height: 100%;
          .esri-item-list__scroller{
            height: 100%;
          }
        }
      }
      .esri-editor__temp-wrapper{
        height: 100%;
      }
      .esri-editor__header{
        min-height: 56px;
        padding-left: ${s&&1!==o?"35px":"15px"};
        .esri-widget__heading{
          font-weight: 600;
          font-size: 16px;
          margin: 0 8px;
          text-align: left;
          padding: 1px 0;
          height: 56px;
          line-height: 54px
        }
      }
      .esri-editor__controls{
        border-top: 1px solid rgba(110,110,110,.3);
        padding: 12px 15px;
        display: flex;
        flex-direction: column;
        ${!s&&"justify-content: space-between !important; flex-direction: row !important;"}
        .esri-editor__control-button:first-of-type{
          color: ${e.colors.white};
          background-color: ${e.colors.palette.primary[500]};
          border: 1px solid ${e.colors.palette.primary[500]};
          :hover{
            background-color: ${e.colors.palette.primary[600]};
          }
        }
        .esri-editor__control-button{
          color: ${e.colors.palette.dark[800]};
          background-color: ${e.colors.white};
          border: 1px solid ${e.colors.palette.light[400]};
          :hover{
            background-color: ${e.colors.palette.light[100]};
          }
        }
        .esri-editor__control-button + .esri-editor__control-button{
          margin-left: 2%;
        }
      }
      .esri-item-list__list-item{
        :focus,
        :focus-visible {
          outline-offset: -2px !important;
        }
      }
      .esri-item-list__list{
        list-style: none;
        margin: 0;
        padding: 0;
        .esri-item-list__list-item{
          cursor: pointer;
          margin-bottom: 6px;
          min-height: 48px;
          transition: border 250ms ease-in-out;
          display: flex;
          justify-content: space-between;
          .esri-item-list__list-item-container{
            display: flex;
            margin: 9px 2px;
            width: 100%;
            .esri-item-list__list-item-label{
              flex: 1;
              margin: 0;
              display: flex;
              align-items: center;
              word-break: break-word;
              padding-left: 20px;
            }
          }
        }
      }
      .esri-item-list__scroller {
        position: relative;
        z-index: 0;
      }

      .esri-editor__feature-list-item,
      .esri-item-list__list-item{
        border-color: ${e.colors.palette.light[200]};
        box-shadow: unset;
        :hover{
          border-color: ${e.colors.palette.dark[300]};
        }
      }
      .confirm-scrim{
        position: absolute;
        background-color: var(--calcite-scrim-background);
        width: 100%;
        height: 100%;
        top: 0;
      }
      .esri-editor__prompt__actions{
        .esri-editor__warning-option--primary,
        .esri-editor__warning-option--positive{
          text-align: center;
          padding: ${r.polished.rem(4)} ${r.polished.rem(16)};
          line-height: ${r.polished.rem(22)};
          border: 1px solid var(--calcite-ui-danger);
          border-radius: 0;
          flex: 1;
        }
        .esri-editor__warning-option--primary{
          background-color: transparent;
          color: var(--calcite-ui-danger);
          :hover{
            border-color: var(--calcite-ui-danger-hover);
            color: var(--calcite-ui-danger-hover);
            box-shadow: inset 0 0 0 1px var(--calcite-ui-danger-hover);
          }
        }
        .esri-editor__warning-option--positive{
          background-color: var(--calcite-ui-danger);
          color: ${e.colors.white};
          :hover{
            border-color: var(--calcite-ui-danger-hover);
            background-color: var(--calcite-ui-danger-hover);
          }
        }
      }
      .esri-feature-table__loader-container{
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        margin: unset;
        background-color: ${r.polished.rgba(e.colors.palette.secondary[400],.3)};
        .esri-feature-table__loader{
          position: absolute;
          left: 50%;
          top: 50%;
          margin-left: -16px;
          margin-top: -20px;
          z-index: 2;
        }
      }

      .attr-height{
        overflow-y: auto;
        height: calc(100% - 113px);
      }
      .snapping-option{
        position: absolute;
        top: 170px;
        width: calc(100% - 33px);
        margin: 10px 16px;
        padding: 16px 7px 10px;
        border-top: 1px solid ${e.colors.palette.light[300]};
        .snapping-item{
          display: flex;
          justify-content: space-between;
          margin-bottom: 16px;
        }
      }
      .feature-list{
        height: calc(100% - 57px);
        background-color: var(--calcite-ui-background);
        max-height: unset;
        .esri-item-list{
          background-color: unset;
        }
        .esri-item-list__list-item{
          background-color: var(--calcite-ui-foreground-1);
          :hover{
            cursor: pointer;
            background-color: var(--calcite-ui-foreground-2);
          }
        }
        .esri-editor__scroller{
          overflow-y: auto;
          max-height: unset;
        }
      }
      .esri-editor__scroller{
        overflow-y: auto;
        max-height: unset;
        .esri-item-list__scroller{
          max-height: unset;
        }
      }
      .esri-item-list__group{
        padding: 0 12px;
      }
      .esri-editor__message{
        margin: auto;
      }
      .form-header-container{
        border-bottom: 1px solid ${e.colors.palette.light[200]};.
      }
      .esri-editor__header{
        padding-left: unset;
      }
      .back-button{
        width: 32px;
        padding-inline: ${r.polished.rem(8)};
        padding-block: ${r.polished.rem(4)};
        line-height: ${r.polished.rem(16)};
        color: ${e.colors.black};
        border-top: 0px !important;
        border-left: 0px !important;
        border-bottom: 0px !important;
        border-style: solid;
        border-color: var(--calcite-ui-border-3);
        border-inline-end-width: 1px;
      }
      .layer-selector{
        padding: 12px 15px;
      }
      .single-buttons{
        flex: 1;
      }
      .multi-buttons{
        width: 49%;
      }
      .add-feature-btn{
        position: absolute;
        right: 15px;
        top: 12px;
        button{
          width: 32px;
          height: 32px;
        }
      }
      .back-list-btn{
        position: absolute;
        left: 15px;
        top: 15px;
      }
      .edit-blank{
        min-height: 300px;
        .placeholder-icon{
          color: ${e.colors.palette.dark[200]};
        }
        & > div{
          top: calc(50% + 20px);
          transform: translateY(-50%);
        }
        p{
          font-size: ${r.polished.rem(14)};
          margin-top: ${r.polished.rem(16)};
          line-height: ${r.polished.rem(19)};
          color: ${e.colors.palette.dark[500]};
        }
      }
    }
  `}class d extends r.React.PureComponent{constructor(){super(...arguments),this.onDataSourceCreated=e=>{this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,e)},this.onDataSourceInfoChange=(e,t)=>{this.props.onIsDataSourceNotReady(this.props.useDataSource.dataSourceId,null==e?void 0:e.status);const i=null==t?void 0:t.selectedIds,o=null==e?void 0:e.selectedIds,s=i!==o&&(0!==(null==i?void 0:i.length)||0!==(null==o?void 0:o.length)),r=null==t?void 0:t.gdbVersion,a=null==e?void 0:e.gdbVersion,n=null==t?void 0:t.sourceVersion,l=null==e?void 0:e.sourceVersion,d=null==t?void 0:t.version,u=null==e?void 0:e.version;s?this.props.onDataSourceSelectedChange(this.props.useDataSource.dataSourceId,o):r===a&&n===l&&d===u||this.props.onDataSourceVersionChange(this.props.useDataSource.dataSourceId)},this.onCreateDataSourceFailed=()=>{this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,null)}}componentWillUnmount(){this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,null),this.props.onIsDataSourceNotReady(this.props.useDataSource.dataSourceId,r.DataSourceStatus.NotReady)}render(){const{useDataSource:e}=this.props;return(0,r.jsx)(r.DataSourceComponent,{useDataSource:e,onDataSourceCreated:this.onDataSourceCreated,onCreateDataSourceFailed:this.onCreateDataSourceFailed,onDataSourceInfoChange:this.onDataSourceInfoChange})}}var u=v(34750),c=v.n(u);const p=e=>{const t=window.SVG,{className:i}=e,o=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(e,["className"]),s=(0,r.classNames)("jimu-icon jimu-icon-component",i);return t?r.React.createElement(t,Object.assign({className:s,src:c()},o)):r.React.createElement("svg",Object.assign({className:s},o))};var h=v(88866),m=v.n(h);const g=e=>{const t=window.SVG,{className:i}=e,o=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(e,["className"]),s=(0,r.classNames)("jimu-icon jimu-icon-component",i);return t?r.React.createElement(t,Object.assign({className:s,src:m()},o)):r.React.createElement("svg",Object.assign({className:s},o))};var y=v(27387),b=v(88359),S=v(99818),w=v(48702),x=v(70281),j=v(11668),I=v(94129),F=v(37902);const _=["CreationDate","Creator","EditDate","Editor","GlobalID"];var E=function(e,t,i,o){return new(i||(i=Promise))((function(s,r){function a(e){try{l(o.next(e))}catch(e){r(e)}}function n(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,n)}l((o=o.apply(e,t||[])).next())}))};class M extends r.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.7.0",description:"Add layerHonorMode to config for support smart form.",upgrader:e=>E(this,void 0,void 0,(function*(){let i=e;const o=(e,t)=>{const i=[],o=e=>(e.forEach((e=>{if(e.groupKey)o(e.children);else{const o=t.find((t=>t.name===e.jimuName));_.includes(e.jimuName)||i.push(Object.assign(Object.assign({},e),{editable:null==o?void 0:o.editable,editAuthority:!!(null==o?void 0:o.editable)&&(null==e?void 0:e.editAuthority)}))}})),i);return o(e)};return yield Promise.all(i.layersConfig.map((e=>new Promise((t=>{r.DataSourceManager.getInstance().createDataSourceByUseDataSource(e.useDataSource).then((i=>{const s=null==i?void 0:i.getLayerDefinition(),r=(null==s?void 0:s.fields)||[],a=e.groupedFields.map((e=>{var t;const i=r.find((t=>t.name===e.jimuName));return e.groupKey?Object.assign(Object.assign({},e),{editable:!0,editAuthority:!(null===(t=null==e?void 0:e.children)||void 0===t?void 0:t.some((e=>!1===e.editAuthority))),children:o(null==e?void 0:e.children,r)}):Object.assign(Object.assign({},e),{editable:null==i?void 0:i.editable,editAuthority:!!(null==i?void 0:i.editable)&&(null==e?void 0:e.editAuthority)})})).filter((e=>!_.includes(e.jimuName)));t(a)}))}))))).then((e=>(e.forEach(((e,o)=>{const s=i.layersConfig[o].showFields.filter((e=>!_.includes(e.jimuName)));let a=[];const n=e.asMutable({deep:!0});e.forEach((e=>{e.groupKey?a=a.concat(e.children):a.push(e)})),s.forEach((e=>{a.find((t=>t.jimuName===e.jimuName))||n.push(e)})),i=i.setIn(["layersConfig",o,"groupedFields"],(0,r.Immutable)(n)),i=i.setIn(["layersConfig",o,"layerHonorMode"],t.Custom)})),Promise.resolve(i))))}))},{version:"1.10.0",description:"Set old app default snapping to true",upgrader:e=>E(this,void 0,void 0,(function*(){let t=e;return t=t.set("selfSnapping",!0).set("featureSnapping",!0),t}))},{version:"1.12.0",description:'Set "undefined" option to "false", and remove not editable layer',upgrader:t=>E(this,void 0,void 0,(function*(){var i,o,s;let a=t;const n=a.editMode===e.Geometry,l=r.DataSourceManager.getInstance(),d=[];for(const e of a.layersConfig){let t;try{t=yield l.createDataSourceByUseDataSource(null==e?void 0:e.useDataSource)}catch(e){console.error(e)}if(!t){d.push(e);continue}const a=null==t?void 0:t.getLayerDefinition(),u=(null===(i=null==t?void 0:t.layer)||void 0===i?void 0:i.isTable)||(null==a?void 0:a.type)===r.SupportedLayerServiceTypes.Table;if(n&&u)continue;const c=null==a?void 0:a.allowGeometryUpdates;if(null===(s=null===(o=null==t?void 0:t.layer)||void 0===o?void 0:o.editingEnabled)||void 0===s||s){let t;t=e.updateGeometries?Object.assign(Object.assign({},e),{updateRecords:!0,updateAttributes:!0,updateGeometries:c&&!0}):Object.assign(Object.assign({},e),{updateRecords:!1,updateAttributes:!1,updateGeometries:!1}),d.push(t)}}return a=a.setIn(["layersConfig"],d),a}))},{version:"1.13.0",description:"Update snap options",upgrader:e=>E(this,void 0,void 0,(function*(){let t=e;return t.selfSnapping&&(t=t.set("defaultSelfEnabled",!0)),t.featureSnapping&&(t=t.set("defaultFeatureEnabled",!0)),t}))},{version:"1.14.0",description:"Add predefine snapping options",upgrader:e=>E(this,void 0,void 0,(function*(){let t=e;return t=t.set("snapSettingMode",s.Flexible),t}))}]}}const C=new M;var N=v(79964),D=v.n(N);const O=e=>{const t=window.SVG,{className:i}=e,o=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(e,["className"]),s=(0,r.classNames)("jimu-icon jimu-icon-component",i);return t?r.React.createElement(t,Object.assign({className:s,src:D()},o)):r.React.createElement("svg",Object.assign({className:s},o))};var k=v(135),A=v(30224),L=v.n(A);const T=e=>{const t=window.SVG,{className:i}=e,o=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(e,["className"]),s=(0,r.classNames)("jimu-icon jimu-icon-component",i);return t?r.React.createElement(t,Object.assign({className:s,src:L()},o)):r.React.createElement("svg",Object.assign({className:s},o))};var R=function(e,t,i,o){return new(i||(i=Promise))((function(s,r){function a(e){try{l(o.next(e))}catch(e){r(e)}}function n(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,n)}l((o=o.apply(e,t||[])).next())}))};const $=v(94127),P="esri-feature-form__form-header",B="esri-feature-form__description-text",U="esri-widget__heading",V="esri-feature-form",H="esri-editor__scroller",W="esri-item-list__list-item-label",G="esri-editor__warning-option",z=Object.assign({},{_widgetLabel:"Edit",initGeoEmptyMessage:"Please add an editable layer.",initAttEmptyMessage:"Please add an editable source.",noRecordTips:"No valid record is selected, select one or add one.",addFeature:"Add feature",selectLayer:"Select layer",selfSnapping:"Geometry guides",featureSnapping:"Feature to feature",update:"Update",deleteRecord:"Delete this record?",deleteRecordTips:"This record will be permanently removed.",keepRecord:"Keep record"},n.defaultMessages,r.defaultMessages);var q;!function(e){e.new="NEW",e.update="UPDATE"}(q||(q={}));class J extends r.React.PureComponent{constructor(o){super(o),this.getWhetherArrayIsShallowEqual=(e,t)=>{let i=!1;return e&&t&&e.length===t.length&&(i=!e.some(((e,i)=>e!==t[i]))),i},this.handleActiveViewChange=e=>R(this,void 0,void 0,(function*(){this.setState({jimuMapView:e},(()=>{const t=null==e?void 0:e.view;null==t||t.when((()=>{null==t||t.on("layerview-create",(t=>{const i=t.layer;if("hide"===(null==i?void 0:i.listMode)){const t=this.edit;this.newOrUpdateEditor((null==t?void 0:t.layerInfos)?q.update:q.new,e)}}))})),e?this.newOrUpdateEditor(q.new,e):this.destoryEdit()}))})),this.formatMessage=(e,t)=>this.props.intl.formatMessage({id:e,defaultMessage:z[e]},t),this.destoryEdit=()=>{this.edit&&!this.edit.destroyed&&this.edit.destroy()},this.flatMapArray=e=>{const t=[];for(const i in e)(null==e?void 0:e[i])&&t.push(...e[i]);return t},this.flatMapArrayWithView=(e,t)=>{const i=[],o=null==t?void 0:t.dataSourceId;for(const t in e)0===t.indexOf(o)&&(null==e?void 0:e[t])&&i.push(...e[t]);return i},this.createEditForm=(e,t,i)=>R(this,void 0,void 0,(function*(){var o,s,a,n;const{dataSources:l,editFeatures:d}=this.state,{id:u,config:c}=this.props,{layersConfig:p}=c,h=l[e],v=this.getInLayersConfigFeatures(d,p),f=this.flatMapArray(v).length;if(1===f){const e=null===(o=h.getSelectedRecords())||void 0===o?void 0:o[0],n=h.getIdField()||"OBJECTID",l=e?`${n} IN (${e.getId()})`:"",d=yield h.query({where:l,returnGeometry:!0,notAddFieldsToClient:!0,outFields:["*"]}).then((e=>{var t;return null===(t=null==e?void 0:e.records)||void 0===t?void 0:t[0]}));if(!d)return;if(t||!this.edit||(null===(s=this.edit)||void 0===s?void 0:s.destroyed))this.renderFeatureForm(h,d,i);else{null===(a=document.getElementById(`edit-container-${u}`))||void 0===a||a.classList.remove("esri-hidden"),this.createOrUpdateheader(h,null==d?void 0:d.feature);const e=this.edit;if(!e)return;const t=yield r.dataSourceUtils.changeToJSAPIGraphic(null==d?void 0:d.feature);e.feature=t}}else(f>1||0===f)&&(null===(n=document.getElementById(`edit-container-${u}`))||void 0===n||n.classList.add("esri-hidden"))})),this.getDsAccessibleInfo=e=>e?(0,r.esri.restRequest.request)(`${e}?f=json`).then((e=>!Object.keys(e).includes("error"))).catch((e=>{console.error(e)})):Promise.resolve(!1),this.getPrivilege=()=>r.privilegeUtils.checkExbAccess(r.privilegeUtils.CheckTarget.Experience).then((e=>{var t;return null===(t=null==e?void 0:e.capabilities)||void 0===t?void 0:t.canEditFeature})),this.getIsAdvancedPermission=(e,t)=>R(this,void 0,void 0,(function*(){var i;const{dataSources:o}=this.state,s=t||o[Object.keys(o).find((t=>t.includes(e.id)))];if(!s)return!1;const a=yield null==s?void 0:s.fetchItemInfo().then((e=>e)).catch((e=>{console.error(e)}));if(!a)return!1;const n=null===(i=r.ServiceManager.getInstance().getServerInfoByServiceUrl(a.url))||void 0===i?void 0:i.owningSystemUrl;if(!n)return!1;const l=r.SessionManager.getInstance().getSessionByUrl(n);if(!l)return!1;const d=yield l.getUser(),u="org_admin"===(null==d?void 0:d.role)&&(null==a?void 0:a.isOrgItem),c=a.owner===(null==d?void 0:d.username),p=yield r.privilegeUtils.isItemInTheUpdatedGroup(a.id,l);return u||c||p})),this.sendSparkMsg=(e,t)=>{var i,o,s;const r=null===(s=null===(o=null===(i=null===window||void 0===window?void 0:window.Capacitor)||void 0===i?void 0:i.Plugins)||void 0===o?void 0:o.Spark)||void 0===s?void 0:s.sendDiscussionAsync;r&&r({title:`${e} data to ${t}`,content:window.location.href})},this.getTimezone=e=>r.dataSourceUtils.getTimezoneAPIFromRuntime(e.getTimezone()),this.renderFeatureForm=(o,s,a)=>{this.setState({loading:!0});const{activeId:n}=this.state,{config:l,id:d}=this.props,{editMode:u,layersConfig:c}=l,p=c.asMutable({deep:!0}).find((e=>e.id===n));this.destoryEdit(),this.getFeatureLayer(o).then((n=>R(this,void 0,void 0,(function*(){var l,c;if(a&&a!==this.currentRequestId)return void this.setState({loading:!1});if(this.removeLayerOnce=!1,!n)return void this.setState({loading:!1});const h=document&&document.createElement("div");let v;h.id=`edit-container-${d}`,h.className=`edit-container-${d}`,this.refs.editContainer.appendChild(h),v=n.layer?n.layer:n;const f=yield this.getDsAccessibleInfo(null==v?void 0:v.url),m=yield this.getPrivilege(),g=yield this.getIsAdvancedPermission(v,o),b=null==v?void 0:v.userHasFullEditingPrivileges,S=null===(l=null==v?void 0:v.editingEnabled)||void 0===l||l,x=f||m;let j;if(j=g||b&&S?"full":b&&!S?"none":"normal",this.setState({formPrivileges:j,formEditable:x}),"none"!==j&&("normal"!==j||p.updateRecords||p.deleteRecords)){if(u===e.Attribute){const e=this.constructFormElements(o.id),a=new w.default({elements:e}),n=((null==s?void 0:s.feature)?yield r.dataSourceUtils.changeToJSAPIGraphic(null==s?void 0:s.feature):void 0)||new I.default({layer:v}),l=p.layerHonorMode===t.Webmap&&(null===(c=null==o?void 0:o.layer)||void 0===c?void 0:c.formTemplate)||a;this.edit=new y.default({container:h,feature:n,layer:v,formTemplate:l,timeZone:this.getTimezone(o)}),this.createOrUpdateheader(o,n),s&&this.setState({featureFormStep:"form"});const d=this.edit;d.on("submit",(()=>{const e=(null==d?void 0:d.feature)||n;if(e){(null==e?void 0:e.geometry)&&(e.geometry=null);const t=d.getValues();Object.keys(t).forEach((i=>{e.attributes[i]=t[i]}));const i={updateFeatures:[e]};this.applyAttributeUpdates(i)}})),d.on("value-change",(e=>{var t,i;const s=o.getIdField(),{feature:r,fieldName:a,value:n}=e;if(a===s)return;const l=null===(t=this.edit.viewModel)||void 0===t?void 0:t.submittable;this.setState({formSubmittable:l}),n!==(null===(i=null==r?void 0:r.attributes)||void 0===i?void 0:i[a])?this.setState({formChange:!0}):this.setState({formChange:!1})}));const u=v.isTable;v.on("edits",(e=>{var t,s,r,a,n,l,d,c;const{addedFeatures:p,updatedFeatures:h,deletedFeatures:f}=e,m=p&&p.length>0,g=h&&h.length>0,y=f&&f.length>0;let b=i.Added;if(m){b=i.Added;const n=null===(s=null===(t=null==e?void 0:e.edits)||void 0===t?void 0:t.addFeatures)||void 0===s?void 0:s[0];if(n){const e=o.getIdField(),t=o.buildRecord(n,o),i=(null==t?void 0:t.getData())||{};t.setData(Object.assign(Object.assign({},i),{[e]:null===(a=null===(r=p[0])||void 0===r?void 0:r.objectId)||void 0===a?void 0:a.toString()})),o.afterAddRecord(t),u&&o.selectRecordById(t.getId(),t)}}if(g){b=i.Updated;const t=null===(l=null===(n=null==e?void 0:e.edits)||void 0===n?void 0:n.updateFeatures)||void 0===l?void 0:l[0];if(t){const e=o.buildRecord(t,o);o.afterUpdateRecord(e)}}if(y){b=i.Deleted;const t=null===(c=null===(d=null==e?void 0:e.edits)||void 0===d?void 0:d.deleteFeatures)||void 0===c?void 0:c[0];if(t){const e=o.buildRecord(t,o);o.afterDeleteRecordById(e.getId())}}(m||g||y)&&this.sendSparkMsg(b,v.title)})),this.setState({loading:!1})}}else this.setState({loading:!1,featureFormStep:"empty"})})))).catch((e=>{this.setState({loading:!1}),this.removeLayerOnce=!1,console.error(e)}))},this.createOrUpdateheader=(e,t)=>{var i,o;const{id:s}=this.props,{featureFormStep:a}=this.state,n=this.getLayerDisplayField(e),l="new"===a?this.formatMessage("addFeature"):null===(i=null==t?void 0:t.attributes)||void 0===i?void 0:i[n];if(null===document||void 0===document?void 0:document.getElementById(`form_heading_${s}`))document.getElementById(`form_heading_${s}`).innerText=l;else{const e=document&&document.createElement("div");e.className="d-flex",e.innerHTML=`\n        <button id='back_home_${s}' class='back-button surface-1 ${(0,r.classNames)("esri-editor__back-button")}' title='${this.formatMessage("back")}'><</button>\n        <header class='${(0,r.classNames)("esri-editor__header")}'>\n          <h4 id='form_heading_${s}' class='text-truncate ${(0,r.classNames)(U)}' title='${l}'>${l}</h4>\n        </header>\n      `,this.refs.formHeaderContainer.appendChild(e),null===(o=document.getElementById(`back_home_${s}`))||void 0===o||o.addEventListener("click",this.handleBack)}},this.deleteChangeDataSource=e=>{const{config:t}=this.props,{layersConfig:i}=t,{activeId:o,editFeatures:s}=this.state,r=Object.assign({},s);r[o]=e;const a=this.getInLayersConfigFeatures(r,i),n=this.flatMapArray(a).length,l=n>1?"list":1===n?"form":"empty";this.setState({editFeatures:r,featureFormStep:l},(()=>{this.createEditForm(o,!1)}))},this.applyAttributeUpdates=e=>{const{dataSources:t,editFeatures:i,activeId:o}=this.state,s=this.edit,r=t[o],a=r.getGDBVersion();s.layer.applyEdits(e,{gdbVersion:a}).then((t=>{if(null==e?void 0:e.deleteFeatures){const t=(null==r?void 0:r.getSelectedRecords()).filter((t=>t.feature.attributes!==(null==e?void 0:e.deleteFeatures[0].attributes)));if(t.length>0)this.deleteChangeDataSource(t);else{const e=Object.assign({},i);delete e[o];const t=this.refs.formHeaderContainer;(null==t?void 0:t.innerHTML)&&(t.innerHTML=""),this.destoryEdit(),this.setState({editFeatures:e,featureFormStep:"empty",activeId:""})}}else(null==e?void 0:e.updateFeatures)&&this.setState({attrUpdating:!1});this.setState({formChange:!1,formSubmittable:!0})})).catch((t=>{(null==e?void 0:e.updateFeatures)&&this.setState({attrUpdating:!1}),console.error(t)}))},this.constructFormElements=e=>{let{activeId:t}=this.state;e&&(t=e);const{config:i}=this.props,{layersConfig:o}=i,s=o.asMutable({deep:!0}).find((e=>e.id===t));if(!s)return[];const{groupedFields:r}=s;return r.map((e=>(null==e?void 0:e.children)?new j.default({label:e.name,description:e.subDescription||(null==e?void 0:e.description),elements:null==e?void 0:e.children.map((e=>new x.default({fieldName:e.jimuName,label:(null==e?void 0:e.alias)||(null==e?void 0:e.name),description:e.subDescription||(null==e?void 0:e.description),editableExpression:e.editAuthority?"true":"false"})))}):new x.default({fieldName:e.jimuName,label:(null==e?void 0:e.alias)||(null==e?void 0:e.name),description:e.subDescription||(null==e?void 0:e.description),editableExpression:e.editAuthority?"true":"false"})))},this.onFilterChange=e=>{this.setState({filterText:e.target.value})},this.renderListItems=e=>{var t,i,o;const{filterText:s}=this.state,{config:a}=this.props,{layersConfig:n}=a,l=[];for(const r in e){const a=e[r],n=null===(t=null==a?void 0:a[0])||void 0===t?void 0:t.dataSource,d=null==n?void 0:n.belongToDataSource,u=null==d?void 0:d.jimuChildId,c=(null===(i=null==d?void 0:d.layerDefinition)||void 0===i?void 0:i.name)||(null===(o=null==d?void 0:d.layerDefinition)||void 0===o?void 0:o.description),p=this.getLayerDisplayField(n),h=this.getLayerObjectIdField(n),v={id:u,label:c,dsId:r,items:a.filter((e=>{var t,i,o,r;const a=(null===(t=e.feature.attributes)||void 0===t?void 0:t[p])||(null===(i=e.feature.attributes)||void 0===i?void 0:i[h])||(null===(o=e.feature.attributes)||void 0===o?void 0:o.objectid),n=s.toLowerCase();return!n||(null===(r=null==a?void 0:a.toString())||void 0===r?void 0:r.toLowerCase().indexOf(n))>-1})).map((e=>{var t,i,o;const s=(null===(t=e.feature.attributes)||void 0===t?void 0:t[p])||(null===(i=e.feature.attributes)||void 0===i?void 0:i[h])||(null===(o=e.feature.attributes)||void 0===o?void 0:o.objectid);return{id:s,dsId:r,label:s,data:e.feature}}))};l.push(v)}let d=0;return l.forEach((e=>{d+=e.items.length})),l.sort(((e,t)=>{const i=n.findIndex((t=>t.layerId===e.id)),o=n.findIndex((e=>e.layerId===t.id));return i-o})),0===d?(0,r.jsx)("div",{className:"esri-item-list__no-matches-message",key:"no-matches"},"No items found"):(0,r.jsx)("div",{key:"item-container"},l.map((e=>this.renderGroup(e))))},this.renderGroup=e=>{if(0!==e.items.length)return(0,r.jsx)("div",{role:"group","aria-label":e.label,className:"esri-item-list__group",key:e.id},(0,r.jsx)("h4",{className:(0,r.classNames)("esri-item-list__group-header",U)},(0,r.jsx)("span",{className:W},e.label)),(0,r.jsx)("div",{className:"esri-item-list__list",role:"listbox"},e.items.map((e=>this.renderItem(e)))))},this.renderItem=e=>{const t=`${e.dsId}__${e.label}`,{dataSources:i}=this.state;return(0,r.jsx)(n.Button,{role:"option",className:(0,r.classNames)("w-100 border-0 esri-item-list__list-item"),key:t,onClick:()=>{clearTimeout(this.timerFn),this.timerFn=setTimeout((()=>{this.renderFeatureForm(i[e.dsId],{feature:e.data})}),200)},onDoubleClick:()=>{clearTimeout(this.timerFn)}},(0,r.jsx)("div",{className:"esri-item-list__list-item-container"},(0,r.jsx)("span",{className:W},e.label)))},this.getLayerDisplayField=e=>{var t,i,o,s,r,a,n,l;return(null===(t=null==e?void 0:e.layer)||void 0===t?void 0:t.displayField)||(null===(i=null==e?void 0:e.layerDefinition)||void 0===i?void 0:i.displayField)||(null===(s=null===(o=null==e?void 0:e.belongToDataSource)||void 0===o?void 0:o.layerDefinition)||void 0===s?void 0:s.displayField)||(null===(r=null==e?void 0:e.layer)||void 0===r?void 0:r.objectIdField)||(null===(a=null==e?void 0:e.layerDefinition)||void 0===a?void 0:a.objectIdField)||(null===(l=null===(n=null==e?void 0:e.belongToDataSource)||void 0===n?void 0:n.layerDefinition)||void 0===l?void 0:l.objectIdField)||"OBJECTID"},this.getLayerObjectIdField=e=>{var t,i,o;return(null===(t=null==e?void 0:e.layer)||void 0===t?void 0:t.objectIdField)||(null===(o=null===(i=null==e?void 0:e.belongToDataSource)||void 0===i?void 0:i.layerDefinition)||void 0===o?void 0:o.objectIdField)||"OBJECTID"},this.renderFeatureList=(e,t)=>{const{id:i,label:o,theme:s}=this.props,{filterText:a}=this.state,l=`${i}-placeholder`,d=this.refs.formHeaderContainer;return(null==d?void 0:d.innerHTML)&&(d.innerHTML=""),(0,r.jsx)("div",{className:"surface-1 border-0 h-100"},(0,r.jsx)("div",{className:V},(0,r.jsx)("div",{className:P},(0,r.jsx)("h2",{className:U},o),(0,r.jsx)("p",{className:(0,r.classNames)(`text-truncate ${B}`),key:"description",title:t},t))),(0,r.jsx)("div",{className:(0,r.classNames)(`feature-list esri-editor__content ${H}`)},(0,r.jsx)("div",{className:(0,r.classNames)("esri-item-list","esri-widget")},(0,r.jsx)("div",{className:"d-flex align-items-center m-2"},(0,r.jsx)(n.TextInput,{"aria-labelledby":l,className:"w-100",placeholder:this.formatMessage("search"),onChange:this.onFilterChange,value:a,prefix:(0,r.jsx)(T,{color:s.colors.palette.light[800]}),allowClear:!0,title:a})),(0,r.jsx)("div",{key:"content",className:(0,r.classNames)(H)},this.renderListItems(e)))))},this.renderFormEmpty=t=>{const{id:i,label:o,config:s}=this.props,{noDataMessage:a,layersConfig:n,editMode:l}=s,d=this.refs.formHeaderContainer;(null==d?void 0:d.innerHTML)&&(d.innerHTML="");const u=n.length>0,c=l===e.Attribute?this.formatMessage("initAttEmptyMessage"):this.formatMessage("initGeoEmptyMessage"),p=u?a||this.formatMessage("noRecordTips"):c,h=document.getElementById(`edit-container-${i}`);return h&&(null==h||h.classList.add("esri-hidden")),(0,r.jsx)("div",{className:"surface-1 border-0 h-100"},(0,r.jsx)("div",{className:(0,r.classNames)(`editor-white-bg ${V}`)},(0,r.jsx)("div",{className:P},(0,r.jsx)("h2",{className:U},o),u&&(0,r.jsx)("p",{className:(0,r.classNames)(`text-truncate ${B}`),key:"description",title:t},t))),(0,r.jsx)("div",{className:"w-100 text-center edit-blank"},(0,r.jsx)("div",{className:"position-absolute edit-blank-content w-100"},(0,r.jsx)(g,{size:32,className:"placeholder-icon"}),(0,r.jsx)("p",null,p))))},this.renderControlButtons=e=>(0,r.jsx)("div",{className:(0,r.classNames)("flex-row justify-content-between esri-editor__controls"),key:"controls"},e.map((({disabled:t=!1,label:i,type:o,clickHandler:s},a)=>this.renderButton({label:i,class:(0,r.classNames)({"single-buttons":1===e.length},{"multi-buttons":e.length>1},t?"esri-button--disabled":null),type:o,disabled:t,clickHandler:s,key:a})))),this.handleNew=()=>{var e,t;const{dataSources:i,formPrivileges:o}=this.state,{config:s}=this.props,{layersConfig:r}=s,a="normal"===o;let n;if("full"===o?n=null===(e=r.find((e=>null==e?void 0:e.isTable)))||void 0===e?void 0:e.id:a&&(n=null===(t=r.find((e=>null==e?void 0:e.addRecords)))||void 0===t?void 0:t.id),n){const e=null==i?void 0:i[n];if(!e)return;this.setState({featureFormStep:"new",activeId:n},(()=>{this.renderFeatureForm(e)}))}},this.handleAdd=()=>{var e;const t=null===(e=this.edit.viewModel)||void 0===e?void 0:e.feature;if(t){const e=this.edit.getValues();t.attributes=e;const i={addFeatures:[t]};this.applyAttributeUpdates(i)}},this.handleSave=()=>{var e,t;null===(t=null===(e=this.edit)||void 0===e?void 0:e.viewModel)||void 0===t||t.submit(),this.setState({attrUpdating:!0})},this.handleDeleteConfirm=()=>{this.setState({delConfirm:!0})},this.cancleDelete=()=>{this.setState({delConfirm:!1})},this.handleDelete=()=>{const e=this.edit.viewModel.feature;if(e){const t={deleteFeatures:[e]};this.applyAttributeUpdates(t)}this.setState({delConfirm:!1})},this.renderButton=e=>(0,r.jsx)(n.Button,{className:e.class,disabled:e.disabled,key:e.key,onClick:e.clickHandler,type:e.type},e.label),this.constructFieldConfig=e=>(null==e?void 0:e.asMutable({deep:!0})).map((e=>(null==e?void 0:e.children)?new j.default({label:e.name,description:e.subDescription||(null==e?void 0:e.description),elements:null==e?void 0:e.children.map((e=>new x.default({fieldName:e.jimuName,label:null==e?void 0:e.alias,description:e.subDescription||(null==e?void 0:e.description),editableExpression:e.editAuthority?"true":"false"})))}):new x.default({fieldName:e.jimuName,label:null==e?void 0:e.alias,description:e.subDescription||(null==e?void 0:e.description),editableExpression:e.editAuthority?"true":"false"}))),this.editorLayerWatcher=(e,t,o,s)=>{var r,a,n,l,d,u,c,p,h,v;const{dataSources:f,activeId:m}=this.state,g=f[t],{addedFeatures:y,updatedFeatures:b,deletedFeatures:S}=e,w=y&&y.length>0,x=b&&b.length>0,j=S&&S.length>0;let I=i.Added;if(w){I=i.Added;const t=null===(a=null===(r=null==e?void 0:e.edits)||void 0===r?void 0:r.addFeatures)||void 0===a?void 0:a[0];if(t){const e=g.buildRecord(t);g.afterAddRecord(e)}}if(x){I=i.Updated;const t=null===(l=null===(n=null==e?void 0:e.edits)||void 0===n?void 0:n.updateFeatures)||void 0===l?void 0:l[0],s=(null===(u=null===(d=this.edit.viewModel)||void 0===d?void 0:d.featureFormViewModel)||void 0===u?void 0:u.feature)||(null===(p=null===(c=this.edit)||void 0===c?void 0:c._featureForm)||void 0===p?void 0:p.feature),r=(null==s?void 0:s.attributes)||{},a=(null==s?void 0:s.geometry)||null,h=(null==s?void 0:s.layer)||o,v=Object.assign(r,null==t?void 0:t.attributes);if(t.attributes=v,t.layer=h,t.geometry||(t.geometry=a),t){const e=g.buildRecord(t);g.afterUpdateRecord(e);const i={};if(!m)return;i[m]=[e],this.startWorkFlowWhenAwait(i)}}if(j){I=i.Deleted;const t=null===(v=null===(h=null==e?void 0:e.edits)||void 0===h?void 0:h.deleteFeatures)||void 0===v?void 0:v[0];if(t){const e=g.buildRecord(t);g.afterDeleteRecordById(e.getId())}}(w||x||j)&&this.sendSparkMsg(I,s)},this.isLayerInfoChange=(e,t)=>{let i=!1;return(null==e?void 0:e.length)!==(null==t?void 0:t.length)||(e.forEach((e=>{const o=t.find((t=>t.layer.id===e.layer.id));if(o){const t=["enabled","addEnabled","updateEnabled","deleteEnabled"];for(const s of t)if(o[s]!==e[s]){i=!0;break}}else i=!0})),i)},this.clearAllDsSelect=()=>{const{dataSources:e}=this.state;Object.keys(e).forEach((t=>{var i;null===(i=e[t])||void 0===i||i.clearSelection()}))},this.newOrUpdateEditor=(e,i)=>R(this,void 0,void 0,(function*(){var o,r;const a=e===q.new,{jimuMapView:n}=this.state,{id:l,config:d}=this.props,{layersConfig:u,selfSnapping:c,featureSnapping:p,defaultSelfEnabled:h,defaultFeatureEnabled:v,defaultSnapLayers:f,snapSettingMode:m}=d,g=[];let y,S=n;if(i&&(S=i),!S)return;let x=0;if(a){const{useMapWidgetIds:e}=this.props;if(!e||0===e.length)return;if(0===(null==u?void 0:u.length))return;if(void 0!==this.edit&&!i&&this.edit&&!this.edit.destroyed)return void this.newOrUpdateEditor(q.update,S);this.destoryEdit();let t=null;const o=document.getElementById(`edit-container-${l}`);o&&o.remove(),t=document&&document.createElement("div"),t.id=`edit-container-${l}`,t.className=`h-100 edit-container-${l}`,this.refs.editContainer.appendChild(t);const r=m===s.Flexible,a=c||p,n=yield this.getDefaultSnapSources(S,f);y=()=>{this.edit=new b.default({container:t,view:S.view,layerInfos:g,snappingOptions:{enabled:h||v,selfEnabled:h,featureEnabled:v,featureSources:n},visibleElements:{snappingControls:r&&a,snappingControlsElements:{enabledToggle:!0,selfEnabledToggle:c,featureEnabledToggle:p}}});const e=this;k.default.watch((()=>this.edit.viewModel.state),((t,i)=>{var o,s,r;"ready"!==t&&setTimeout((()=>{var e;const t=null===(e=document.querySelector("calcite-flow-item:not([hidden])"))||void 0===e?void 0:e.shadowRoot,i=null==t?void 0:t.querySelector(".back-button"),o=()=>{this.setState({editFeatures:{}},(()=>{this.clearAllDsSelect()}))};null==i||i.removeEventListener("click",o),null==i||i.addEventListener("click",o)}),500);const a=null===(o=e.edit.viewModel)||void 0===o?void 0:o.featureFormViewModel,n=null==a?void 0:a.feature;if(!n)return;const{dataSources:l,selectionStartWorkflow:d}=e.state,c=(null===(s=null==n?void 0:n.layer)||void 0===s?void 0:s.id)||(null===(r=null==a?void 0:a.layer)||void 0===r?void 0:r.id),p=u.find((e=>e.layerId===c));if(!p)return;const h=l[p.id];if(this.editorNotBackButton||"ready"!==t||h.clearSelection(),"editing-attributes"===t){const t=h.buildRecord(n);d?e.setState({selectionStartWorkflow:!1}):(this.editorSelectFeature=!0,h.selectRecordById(t.getId(),t))}}))}}const j=(null===(r=null===(o=S.view)||void 0===o?void 0:o.map)||void 0===r?void 0:r.allLayers)||[],I=j.filter((e=>"feature"===e.type)),F=[];j.forEach((e=>{(null==e?void 0:e.id.includes("jimu-draw-measurements-layer"))&&F.push(e)})),F.length>0&&F.forEach((e=>{g.push({layer:e,enabled:!1,addEnabled:!1,updateEnabled:!1,deleteEnabled:!1})}));const _=[];I.forEach((e=>R(this,void 0,void 0,(function*(){var i;const o=u.find((t=>t.layerId===e.id)),s=e;if(s)if(o){const{groupedFields:r,addRecords:n,deleteRecords:l,updateRecords:d,updateAttributes:u,updateGeometries:c,layerHonorMode:p,id:h}=o,v=p===t.Webmap,f=yield this.getDsAccessibleInfo(null==e?void 0:e.url),m=yield this.getPrivilege(),g=yield this.getIsAdvancedPermission(s),y=null==s?void 0:s.userHasFullEditingPrivileges,b=null===(i=null==s?void 0:s.editingEnabled)||void 0===i||i,S=f||m,x=new w.default({elements:this.constructFieldConfig(r)});g||y&&b?_.push(Object.assign(Object.assign({layer:s},v?{}:{formTemplate:x}),{enabled:!0,addEnabled:!0,updateEnabled:!0,deleteEnabled:!0,attributeUpdatesEnabled:!0,geometryUpdatesEnabled:!0})):y&&!b?_.push({layer:s,enabled:!1,addEnabled:!1,updateEnabled:!1,deleteEnabled:!1}):_.push(Object.assign(Object.assign({layer:s},v?{}:{formTemplate:x}),{enabled:S&&(n||d||l),addEnabled:n,updateEnabled:d,deleteEnabled:l,attributeUpdatesEnabled:u,geometryUpdatesEnabled:c}));const j=s;!a&&j.hasEventListener("edits")||j.on("edits",(e=>{this.editorLayerWatcher(e,h,j,j.title)}))}else g.push({layer:s,enabled:!1,addEnabled:!1,updateEnabled:!1,deleteEnabled:!1});if(x++,x===I.length)if(_.sort(((e,t)=>{const i=u.findIndex((t=>t.layerId===e.layer.id)),o=u.findIndex((e=>e.layerId===t.layer.id));return i-o})),g.unshift(..._),a)y();else{const e=this.edit;this.isLayerInfoChange(g,e.layerInfos)&&(e.layerInfos=g)}}))))})),this.getDefaultSnapSources=(e,t)=>R(this,void 0,void 0,(function*(){return e?(yield e.whenAllJimuLayerViewLoaded(),(null==e?void 0:e.jimuLayerViews)?Object.keys(e.jimuLayerViews).filter((i=>null==t?void 0:t.includes(e.jimuLayerViews[i].layerDataSourceId))).map((t=>({layer:e.jimuLayerViews[t].layer,enabled:!0}))):[]):[]})),this.getFeatureLayer=e=>{var t;const{id:i}=this.props,o=e,s=null===(t=null==e?void 0:e.getDataSourceJson())||void 0===t?void 0:t.isDataInDataSourceInstance;let a;const n=e&&e.getCurrentQueryParams();if(s)return o.load({returnGeometry:!0},{widgetId:i}).then((e=>R(this,void 0,void 0,(function*(){const t=yield Promise.resolve(e);return r.dataSourceUtils.createFeatureLayerByRecords(o,t)})))).catch((e=>{console.error(e)}));if(!S.default)return Promise.resolve(a);if(null==o?void 0:o.itemId){const e=parseInt(o.layerId),t={portalItem:{id:o.itemId,portal:{url:o.portalUrl}},definitionExpression:n.where,layerId:e||void 0};o.url&&(t.url=o.url),a=new S.default(t)}else{if(!o.url)return o.layer?o.load({returnGeometry:!0},{widgetId:i}).then((e=>R(this,void 0,void 0,(function*(){const t=yield Promise.resolve(e);return r.dataSourceUtils.createFeatureLayerByRecords(o,t)})))).catch((e=>{console.error(e)})):Promise.resolve(a);a=new S.default({definitionExpression:n.where,url:o.url})}return s?Promise.resolve(a):a.load().then((()=>R(this,void 0,void 0,(function*(){return yield Promise.resolve(a)})))).catch((e=>{console.error(e)}))},this.getCurrentEditLayer=e=>{if(!e)return;const{activeId:t,jimuMapView:i}=this.state,{config:o}=this.props,{layersConfig:s}=o,r=i.view.map.layers,a=s.asMutable({deep:!0}).find((e=>e.id===t)),{id:n}=a;let l=r.find((t=>t.id===e));return l||r.forEach((t=>{const i=null==t?void 0:t.layers;i&&((null==n?void 0:n.includes(t.id))||(null==n?void 0:n.includes(e)))&&(l=i.find((t=>{var i;return(null===(i=t.layerId)||void 0===i?void 0:i.toString())===e||t.id===e})))})),l},this.startWorkFlowWhenAwait=(e,t)=>R(this,void 0,void 0,(function*(){var i,o,s;const{activeId:r,dataSources:a,editFeatures:n,jimuMapView:l}=this.state,d=this.edit,u=e||n,c=this.flatMapArrayWithView(u,l).length;if(1===c){const e=t||r,n=this.getLayerObjectIdField(a[e]),l=null===(o=null===(i=null==u?void 0:u[e])||void 0===i?void 0:i[0])||void 0===o?void 0:o.feature,c=this.getCurrentEditLayer(null===(s=null==l?void 0:l.layer)||void 0===s?void 0:s.id);if(!c)return;const p=new F.default({where:`${n} = ${l.attributes[n]}`,outFields:["*"],returnGeometry:!0});c.queryFeatures(p).then((e=>{const t=null==e?void 0:e.features[0];null==d||d.startUpdateWorkflowAtFeatureEdit(t)})).catch((e=>{console.error(e)}))}else if(c>1){const e=()=>R(this,void 0,void 0,(function*(){var e,t;let i=[];const o=[];for(const i in u){const s=this.getLayerObjectIdField(a[i]),r=null==u?void 0:u[i];if((null==r?void 0:r.length)>0){const a=`${s} IN (${u[i].map((e=>(null==e?void 0:e.feature).attributes[s])).join()})`,n=null===(e=r[0])||void 0===e?void 0:e.feature,l=this.getCurrentEditLayer(null===(t=null==n?void 0:n.layer)||void 0===t?void 0:t.id),d=new F.default({where:a,outFields:["*"],returnGeometry:!0});o.push(l.queryFeatures(d))}}const s=yield Promise.all(o);return Object.keys(u).forEach(((e,t)=>{var o;i=i.concat((null===(o=s[t])||void 0===o?void 0:o.features)||[])})),i})),t=yield e();null==d||d.startUpdateWorkflowAtMultipleFeatureSelection(t)}else(null==d?void 0:d.activeWorkflow)&&(null==d||d.cancelWorkflow())})),this.idsArrayEquals=(e,t)=>{var i,o;if(!t)return!1;if((null===(i=this.selectedIds[e])||void 0===i?void 0:i.length)!==t.length)return!1;let s=!0;return null===(o=this.selectedIds[e])||void 0===o||o.forEach(((e,i)=>{e!==t[i]&&(s=!1)})),s},this.onDataSourceSelectedChange=(t,i)=>R(this,void 0,void 0,(function*(){var o,s;if(this.idsArrayEquals(t,i))return;const r=this.currentRequestId+1;this.currentRequestId++,this.selectedIds[t]=i;const{config:a}=this.props,{editMode:n,layersConfig:l}=a,{activeId:d,dataSources:u,editFeatures:c,jimuMapView:p}=this.state,h=n===e.Geometry;h||this.setState({formChange:!1});let v=t;const f=Object.assign({},c);if(!u[v]){const e=this.dsManager.getDataSource(v);e&&(u[v]=e)}const m=null===(o=u[v])||void 0===o?void 0:o.getSelectedRecords();if(h){const e=this.edit,t=null==e?void 0:e.layerInfos.find((e=>v.includes(e.layer.id)));((null==t?void 0:t.updateEnabled)||(null==t?void 0:t.deleteEnabled))&&(f[v]=m)}else f[v]=m;const g=this.getInLayersConfigFeatures(f,l),y=this.flatMapArray(g).length,b=y>1?"list":1===y?"form":"empty";if(this.setState({editFeatures:f}),h&&0===y){const e=this.edit;(null==e?void 0:e.activeWorkflow)&&(null==e||e.cancelWorkflow())}if(this.editorSelectFeature)return this.setState({activeId:t}),void(this.editorSelectFeature=!1);if(0===(null==m?void 0:m.length)&&1===y){let e;for(const t in f)1===(null===(s=null==f?void 0:f[t])||void 0===s?void 0:s.length)&&(e=t);v=e}if(h&&0===(null==m?void 0:m.length)){const e=this.edit;(null==e?void 0:e.activeWorkflow)&&(null==e||e.cancelWorkflow())}const S=d!==t;if(h||this.setState({activeId:v,featureFormStep:b},(()=>{this.createEditForm(v,S,r)})),h&&0!==y){if(!p)return;this.setState({activeId:t,selectionStartWorkflow:!0},(()=>{this.startWorkFlowWhenAwait(f,v)}))}})),this.onIsDataSourceNotReady=(e,t)=>{this.setState((i=>{var o;if(!(null===(o=i.dataSources[e])||void 0===o?void 0:o.getDataSourceJson().isOutputFromWidget))return;const s=Object.assign({},i.outputDataSourceIsNotReady);return s[e]=t===r.DataSourceStatus.NotReady,{outputDataSourceIsNotReady:s}}))},this.onCreateDataSourceCreatedOrFailed=(e,t)=>{this.setState((i=>{const o=Object.assign({},i.dataSources);return o[e]=t,{dataSources:o}}))},this.onDataSourceVersionChange=t=>{const{config:i}=this.props,{editMode:o}=i;o===e.Attribute&&this.setState({activeId:t,formChange:!1},(()=>{this.createEditForm(t,!0)}))},this.onLayerChange=e=>{var t;const{dataSources:i}=this.state,o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;this.setState({activeId:o},(()=>{this.renderFeatureForm(i[o])}))},this.handleBack=()=>{const{id:e,config:t}=this.props,{layersConfig:i}=t,{editFeatures:o}=this.state,s=this.getInLayersConfigFeatures(o,i),r=this.flatMapArray(s).length;r<=1?this.setState({featureFormStep:"empty"}):r>1&&this.setState({featureFormStep:"list"}),document.getElementById(`edit-container-${e}`).classList.add("esri-hidden")},this.getInLayersConfigFeatures=(e,t)=>{const i=Object.assign({},e);return Object.keys(e).forEach((e=>{t.some((t=>e.includes(t.id)))||delete i[e]})),i},this.state={jimuMapView:void 0,dataSources:{},outputDataSourceIsNotReady:{},editFeatures:{},activeId:void 0,featureFormStep:"empty",filterText:"",formPrivileges:"normal",formEditable:!1,delConfirm:!1,attrUpdating:!1,formChange:!1,formSubmittable:!0,loading:!1,selectionStartWorkflow:!1},this.dsManager=r.DataSourceManager.getInstance(),this.removeLayerOnce=!1,this.selectedIds={},this.currentRequestId=0,this.timerFn=null,this.editorSelectFeature=!1,this.editorNotBackButton=!1}componentDidUpdate(i,o){var a,n,l,d,u,c,p,h,v,f,m,g,y;return R(this,void 0,void 0,(function*(){const{id:b,config:S}=this.props,{editFeatures:x,dataSources:j,activeId:I,jimuMapView:F}=this.state,{editMode:_,layersConfig:E,selfSnapping:M,featureSnapping:C,defaultSelfEnabled:N,defaultFeatureEnabled:D,defaultSnapLayers:O,snapSettingMode:k}=S,{editFeatures:A}=o,{config:L}=i,{editMode:T,layersConfig:R,selfSnapping:$,featureSnapping:P,defaultSelfEnabled:B,defaultFeatureEnabled:U,defaultSnapLayers:V,snapSettingMode:H}=L,W=this.getInLayersConfigFeatures(x,E),G=this.flatMapArray(W),z=this.getInLayersConfigFeatures(A,R),J=this.flatMapArray(z),K=G.length,Q=J.length;0===K||0===Q||this.getWhetherArrayIsShallowEqual(G,J)?this.editorNotBackButton=!1:this.editorNotBackButton=!0;const Y=!r.lodash.isDeepEqual(R,E);if(0===E.length&&this.destoryEdit(),T!==_&&this.destoryEdit(),Y)if(_===e.Geometry)this.newOrUpdateEditor(q.new);else{const e=this.edit,i=Object.keys(x),o=E.some((e=>i.includes(e.id))),s=this.getInLayersConfigFeatures(x,E),r=this.flatMapArray(s).length;if((null==e?void 0:e.formTemplate)&&0!==E.length){const i=E.asMutable({deep:!0}).find((e=>e.id===I));if((null==i?void 0:i.layerHonorMode)===t.Webmap){const t=j[I];e.formTemplate=null===(a=null==t?void 0:t.layer)||void 0===a?void 0:a.formTemplate}else if(null==e?void 0:e.formTemplate){const t=this.constructFormElements(),i=new w.default({elements:t});e.formTemplate=i}const o=null===(n=null==e?void 0:e.formTemplate)||void 0===n?void 0:n.elements;0===(null==o?void 0:o.length)?null===(l=document.getElementById(`edit-container-${b}`))||void 0===l||l.classList.add("esri-hidden"):0!==r&&(null===(d=document.getElementById(`edit-container-${b}`))||void 0===d||d.classList.remove("esri-hidden"))}else if(0!==E.length&&o)if(1===r){const e=null==j?void 0:j[i[0]],t=null===(u=e.getSelectedRecords())||void 0===u?void 0:u[0];if(!t)return;this.renderFeatureForm(e,t)}else(r>1||0===r)&&(null===(c=document.getElementById(`edit-container-${b}`))||void 0===c||c.classList.add("esri-hidden"))}if(M!==$||C!==P||N!==B||D!==U||O!==V||k!==H){const t=k===s.Flexible,i=M||C,o=yield this.getDefaultSnapSources(F,O);if(this.edit&&_===e.Geometry){const e=this.edit,s=e.visibleElements,r=Object.assign(Object.assign({},s),{snappingControls:t&&i,snappingControlsElements:{enabledToggle:!0,selfEnabledToggle:M,featureEnabledToggle:C}}),a=e.snappingOptions,n=Object.assign(Object.assign({},a),{enabled:N||D,selfEnabled:N,featureEnabled:D,featureSources:o});e.visibleElements=r,e.snappingOptions=n}}if((null===(h=null===(p=this.props)||void 0===p?void 0:p.stateProps)||void 0===h?void 0:h.removeLayerFlag)&&!this.removeLayerOnce){this.props.dispatch(r.appActions.widgetStatePropChange(b,"removeLayerFlag",!1));const e=Object.assign({},x);Object.keys(e).forEach((t=>{E.find((e=>e.id===t))||delete e[t]}));const t=this.getInLayersConfigFeatures(e,E),i=this.flatMapArray(t),o=i.length,s=o>1?"list":1===o?"form":"empty";if("form"===s){this.removeLayerOnce=!0;const e=null===(m=null===(f=null===(v=i[0])||void 0===v?void 0:v.dataSource)||void 0===f?void 0:f.belongToDataSource)||void 0===m?void 0:m.id;null===(g=document.getElementById(`edit-container-${b}`))||void 0===g||g.classList.remove("esri-hidden"),this.renderFeatureForm(j[e],i[0])}else"list"===s&&(null===(y=document.getElementById(`edit-container-${b}`))||void 0===y||y.classList.add("esri-hidden"));this.setState({editFeatures:e,featureFormStep:s})}}))}componentWillUnmount(){const{config:t}=this.props,{editMode:i}=t,o=i===e.Geometry;if(this.edit&&!this.edit.destroyed&&o){const e=this.edit;(null==e?void 0:e.cancelWorkflow)&&e.cancelWorkflow()}}render(){var t,i,o;const{activeId:s,editFeatures:u,featureFormStep:c,formPrivileges:h,formEditable:v,delConfirm:f,attrUpdating:m,formChange:g,formSubmittable:y,loading:b}=this.state,{id:S,theme:w,config:x,useDataSources:j,useMapWidgetIds:I}=this.props,{editMode:F,description:_,layersConfig:E}=x,M=E.asMutable({deep:!0}).find((e=>e.id===s)),C=null!==(t=null==M?void 0:M.updateRecords)&&void 0!==t&&t,N=null!==(i=null==M?void 0:M.deleteRecords)&&void 0!==i&&i,D=this.getInLayersConfigFeatures(u,E),k=this.flatMapArray(D).length,A=null!==(o=null==M?void 0:M.isTable)&&void 0!==o&&o,L=E.some((e=>null==e?void 0:e.addRecords)),T="full"===h,R="normal"===h,P=[];(T||R&&C)&&P.push({label:this.formatMessage("update"),type:"primary",disabled:!(g&&y),clickHandler:this.handleSave}),(T||R&&N)&&P.push({label:this.formatMessage("delete"),type:"default",clickHandler:this.handleDeleteConfirm});const B=[],U=T&&A||R&&L;U&&B.push({label:this.formatMessage("add"),type:"primary",disabled:!1,clickHandler:this.handleAdd});const V=F===e.Attribute,H=V&&("form"===c||"new"===c)||!V&&0!==E.length,W=V&&"list"!==c&&"empty"!==c||!V&&0!==E.length,z=V&&"list"!==c&&"empty"!==c;let q;return T?q=E.filter((e=>e.isTable)):R&&(q=E.filter((e=>e.addRecords))),V||I&&0!==I.length?(0,r.jsx)("div",{className:(0,r.classNames)(`jimu-widget widget-edit esri-widget edit-widget-${S}`),css:l(w,S,c,k,V)},V&&m&&(0,r.jsx)("div",{className:"esri-editor__progress-bar"}),(0,r.jsx)("div",{className:(0,r.classNames)("edit-con",{"surface-1 border-0":H,"h-100":W})},(0,r.jsx)("div",{ref:"formHeaderContainer",className:(0,r.classNames)({"form-header-container":z})}),(0,r.jsx)("div",{ref:"editContainer",className:(0,r.classNames)({"h-100":!V,"attr-height":V&&W})},V&&"new"===c&&(0,r.jsx)("div",{className:"layer-selector"},(0,r.jsx)("label",{className:"esri-feature-form__label"},this.formatMessage("selectLayer")),(0,r.jsx)(n.Select,{value:s,onChange:this.onLayerChange},q.map((e=>(0,r.jsx)("option",{key:e.id,value:e.id},e.name)))))),V&&k>0&&"form"===c&&v&&(null==P?void 0:P.length)>0&&this.renderControlButtons(P),V&&"new"===c&&this.renderControlButtons(B)),!V&&(0,r.jsx)(a.JimuMapViewComponent,{useMapWidgetId:null==I?void 0:I[0],onActiveViewChange:this.handleActiveViewChange}),V&&k>1&&"list"===c&&this.renderFeatureList(D,_),b&&(0,r.jsx)("div",{className:"esri-feature-table__loader-container"},(0,r.jsx)("div",{className:"esri-feature-table__loader",key:"loader"})),V&&("empty"===c||0===E.length)&&this.renderFormEmpty(_),!V&&0===E.length&&this.renderFormEmpty(),V&&f&&(0,r.jsx)(r.React.Fragment,null,(0,r.jsx)("div",{className:"confirm-scrim"}),(0,r.jsx)("div",{className:"esri-editor__prompt--danger"},(0,r.jsx)("div",{className:"esri-editor__prompt__header"},(0,r.jsx)(O,null),(0,r.jsx)("h4",{className:(0,r.classNames)("esri-widget__heading","esri-editor__prompt__header__heading")},this.formatMessage("deleteRecord"))),(0,r.jsx)("div",{className:"esri-editor__prompt__message"},this.formatMessage("deleteRecordTips")),(0,r.jsx)("div",{className:"esri-editor__prompt__divider"}),(0,r.jsx)("div",{className:"esri-editor__prompt__actions"},(0,r.jsx)(n.Button,{className:(0,r.classNames)(G,"esri-editor__warning-option--primary"),onClick:this.cancleDelete},this.formatMessage("keepRecord")),(0,r.jsx)(n.Button,{className:(0,r.classNames)(G,"esri-editor__warning-option--positive"),onClick:this.handleDelete},this.formatMessage("delete"))))),V&&U&&"form"!==c&&"new"!==c&&(0,r.jsx)(n.Button,{size:"sm",icon:!0,type:"tertiary",className:"add-feature-btn",onClick:this.handleNew,title:this.formatMessage("addFeature"),"aria-label":this.formatMessage("addFeature")},(0,r.jsx)(p,{className:"mr-1"}),this.formatMessage("add")),(0,r.jsx)("div",{className:"ds-container"},null==j?void 0:j.map(((e,t)=>(0,r.jsx)(d,{key:t,useDataSource:e,onIsDataSourceNotReady:this.onIsDataSourceNotReady,onDataSourceSelectedChange:this.onDataSourceSelectedChange,onCreateDataSourceCreatedOrFailed:this.onCreateDataSourceCreatedOrFailed,onDataSourceVersionChange:this.onDataSourceVersionChange}))))):(0,r.jsx)(n.WidgetPlaceholder,{widgetId:S,autoFlip:!0,iconSize:"large",style:{position:"absolute",left:0,top:0},icon:$,"data-testid":"editPlaceholder"})}}J.mapExtraStateProps=(e,t)=>{var i;return{appMode:null===(i=null==e?void 0:e.appRuntimeInfo)||void 0===i?void 0:i.appMode}},J.versionManager=C;const K=J;function Q(e){v.p=e}})(),f})())}}}));